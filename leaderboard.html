<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Leaderboard - Golf Cove</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .leaderboard-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .leaderboard-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .leaderboard-header h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
        }
        .leaderboard-header .event-info {
            color: #666;
            font-size: 16px;
        }
        .leaderboard-header .live-badge {
            display: inline-block;
            background: #37b24a;
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 15px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .leaderboard-table {
            width: 100%;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-collapse: collapse;
        }
        .leaderboard-table th {
            background: #333;
            color: #fff;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        .leaderboard-table th:first-child {
            width: 60px;
            text-align: center;
        }
        .leaderboard-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 15px;
        }
        .leaderboard-table tr:hover {
            background: #f9f9f9;
        }
        .position {
            text-align: center;
            font-weight: 700;
            font-size: 18px;
        }
        .position-1 { color: #ffd700; }
        .position-2 { color: #c0c0c0; }
        .position-3 { color: #cd7f32; }
        .player-name {
            font-weight: 600;
            color: #333;
        }
        .player-handicap {
            color: #888;
            font-size: 13px;
            margin-left: 10px;
        }
        .score-cell {
            font-weight: 700;
            font-size: 18px;
        }
        .score-under {
            color: #37b24a;
        }
        .score-over {
            color: #f44336;
        }
        .score-even {
            color: #333;
        }
        .thru-cell {
            color: #666;
            font-size: 14px;
        }
        .status-cell {
            font-size: 13px;
        }
        .status-playing {
            color: #37b24a;
        }
        .status-finished {
            color: #666;
        }
        .hole-by-hole {
            display: none;
            background: #f9f9f9;
        }
        .hole-by-hole.expanded {
            display: table-row;
        }
        .hole-by-hole td {
            padding: 20px;
        }
        .hole-scores {
            display: grid;
            grid-template-columns: repeat(9, 1fr) auto;
            gap: 5px;
            text-align: center;
            font-size: 12px;
            max-width: 600px;
        }
        .hole-scores .hole-header {
            background: #e0e0e0;
            padding: 8px 5px;
            font-weight: 600;
        }
        .hole-scores .par-row {
            background: #f5f5f5;
            padding: 8px 5px;
            color: #666;
        }
        .hole-scores .score-row {
            padding: 8px 5px;
            font-weight: 600;
        }
        .hole-scores .out-cell,
        .hole-scores .in-cell,
        .hole-scores .total-cell {
            background: #333;
            color: #fff;
            padding: 8px 5px;
        }
        .expand-btn {
            cursor: pointer;
            color: #37b24a;
        }
        .expand-btn:hover {
            text-decoration: underline;
        }
        .flight-header {
            background: #37b24a;
            color: #fff;
            padding: 12px 15px;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .refresh-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f5f5f5;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .refresh-bar span {
            color: #666;
            font-size: 14px;
        }
        .refresh-btn {
            padding: 8px 20px;
            background: #37b24a;
            color: #fff;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
        }
        .refresh-btn:hover {
            background: #2d9440;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #37b24a;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: #fff;
            border: 1px solid #e0e0e0;
        }
        .empty-state i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 15px;
        }
        .empty-state h3 {
            color: #333;
            margin-bottom: 10px;
        }
        .empty-state p {
            color: #666;
        }
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .auto-refresh input {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <a href="tel:2033905994"><i class="fas fa-phone"></i> 203.390.5994</a>
                <a href="https://maps.google.com/?q=336+State+Street,+North+Haven,+CT+06473" target="_blank"><i class="fas fa-map-marker-alt"></i> 336 STATE STREET, NORTH HAVEN, CT 06473</a>
            </div>
            <div class="top-bar-right">
                <div class="social-links">
                    <a href="https://www.facebook.com/golfcove/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.instagram.com/golfcovect/" target="_blank"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-main">
            <div class="logo">
                <a href="index.html">
                    <img src="images/golfcovelogo.png" alt="Golf Cove Logo">
                </a>
            </div>
            <nav class="main-nav" id="mainNav">
                <ul class="nav-menu">
                    <li><a href="pricing.html">Pricing</a></li>
                    <li><a href="memberships.html">Memberships</a></li>
                    <li class="dropdown">
                        <a href="lessons-leagues.html">Lessons & Leagues <i class="fas fa-chevron-down"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="lessons-leagues.html">Lessons & Leagues</a></li>
                            <li><a href="pinseeker.html">PinSeeker at Golf Cove</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="private-events.html">Private Events <i class="fas fa-chevron-down"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="private-events.html">Private Events</a></li>
                            <li><a href="concierge.html">The Cove Concierge</a></li>
                        </ul>
                    </li>
                    <li><a href="multisport.html">MultiSport Arcade</a></li>
                    <li><a href="gift-cards.html">Gift Cards</a></li>
                    <li><a href="tournaments.html" class="active">Tournaments</a></li>
                    <li><a href="menu.html">Menu</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="https://golfcove.globalitllc.com/booking#" class="btn-book" target="_blank">RESERVE A ROOM</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-toggle" id="mobileMenuToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Leaderboard Content -->
    <div class="leaderboard-container">
        <a href="tournaments.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Tournaments</a>

        <div class="leaderboard-header">
            <h1 id="tournamentName">Loading...</h1>
            <p class="event-info" id="eventInfo"></p>
            <span class="live-badge" id="liveBadge" style="display: none;">
                <i class="fas fa-circle"></i> LIVE
            </span>
        </div>

        <div class="refresh-bar">
            <span id="lastUpdate">Last updated: --</span>
            <div style="display: flex; gap: 20px; align-items: center;">
                <div class="auto-refresh">
                    <input type="checkbox" id="autoRefresh" checked>
                    <label for="autoRefresh">Auto-refresh</label>
                </div>
                <button class="refresh-btn" onclick="leaderboard.refresh()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
        </div>

        <div id="leaderboardContent">
            <!-- Leaderboard will be rendered here -->
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-simple">
            <div class="footer-social-center">
                <a href="https://www.facebook.com/golfcove/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.instagram.com/golfcovect/" target="_blank"><i class="fab fa-instagram"></i></a>
            </div>
            <p class="footer-social-text">Please visit our facebook and instagram pages frequently for events, updates and promotions!</p>
            <p class="footer-address"><a href="https://maps.google.com/?q=336+State+Street,+North+Haven,+CT+06473" target="_blank">336 State Street, North Haven, CT 06473</a> | Phone: <a href="tel:2033905994">203.390.5994</a></p>
            <p class="footer-copyright">© 2025 Golf Cove | <a href="contact.html">Contact Us</a> | <a href="sitemap.html">Site Map</a></p>
            <p class="footer-powered">Powered by <a href="https://www.foreupgolf.com/" target="_blank">foreUP</a></p>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        const leaderboard = {
            tournamentId: null,
            leagueId: null,
            tournament: null,
            league: null,
            refreshInterval: null,
            viewMode: 'standings', // 'standings' for league cumulative, 'round' for single tournament

            init() {
                const params = new URLSearchParams(window.location.search);
                this.tournamentId = params.get('t');
                this.leagueId = params.get('league');

                if (!this.tournamentId && !this.leagueId) {
                    this.showError();
                    return;
                }

                this.loadData();
                this.startAutoRefresh();
            },

            loadData() {
                const tournaments = JSON.parse(localStorage.getItem('golfcove_tournaments') || '[]');
                const leagues = JSON.parse(localStorage.getItem('golfcove_leagues') || '[]');

                if (this.leagueId) {
                    // League mode - show cumulative standings
                    this.league = leagues.find(l => l.id === this.leagueId);
                    if (!this.league) {
                        this.showError('League not found');
                        return;
                    }
                    this.renderLeagueStandings();
                } else if (this.tournamentId) {
                    // Tournament mode
                    this.tournament = tournaments.find(t => t.id === this.tournamentId);
                    if (!this.tournament) {
                        this.showError('Tournament not found');
                        return;
                    }
                    
                    // Check if tournament is part of a league
                    if (this.tournament.leagueId) {
                        this.league = leagues.find(l => l.id === this.tournament.leagueId);
                    }
                    
                    this.render();
                }
            },

            showError(msg = 'Tournament not found') {
                document.getElementById('tournamentName').textContent = 'Not Found';
                document.getElementById('leaderboardContent').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <h3>${msg}</h3>
                        <p>This may have been deleted or the link is invalid.</p>
                    </div>
                `;
            },

            getCourse(courseId) {
                const courses = JSON.parse(localStorage.getItem('golfcove_courses') || '[]');
                return courses.find(c => c.id === (courseId || this.tournament?.courseId));
            },

            getScores(tournamentId) {
                const allScores = JSON.parse(localStorage.getItem('golfcove_scores') || '{}');
                return allScores[tournamentId || this.tournamentId] || {};
            },

            calculateLeagueStandings() {
                if (!this.league) return [];
                
                const tournaments = JSON.parse(localStorage.getItem('golfcove_tournaments') || '[]')
                    .filter(t => t.leagueId === this.league.id);
                const allScores = JSON.parse(localStorage.getItem('golfcove_scores') || '{}');

                const standings = this.league.players.map(player => {
                    let totalGross = 0;
                    let totalNet = 0;
                    let roundsPlayed = 0;
                    const rounds = [];

                    tournaments.forEach(tournament => {
                        const course = this.getCourse(tournament.courseId);
                        const tournamentScores = allScores[tournament.id] || {};
                        const tournamentPlayer = tournament.players.find(p => p.name === player.name);
                        
                        if (!tournamentPlayer) return;

                        const playerScores = tournamentScores[tournamentPlayer.id];
                        if (playerScores && playerScores.submitted) {
                            const gross = Object.keys(playerScores)
                                .filter(k => k !== 'submitted' && k !== 'submittedAt')
                                .reduce((sum, h) => sum + (playerScores[h] || 0), 0);
                            const net = gross - (tournamentPlayer.handicap || 0);
                            
                            // Calculate to par
                            let totalPar = 0;
                            const holes = course ? course.holes : 18;
                            for (let i = 1; i <= holes; i++) {
                                totalPar += course?.pars?.[i-1] || 4;
                            }
                            
                            totalGross += gross;
                            totalNet += net;
                            roundsPlayed++;
                            rounds.push({ 
                                tournamentId: tournament.id, 
                                name: tournament.name,
                                date: tournament.date,
                                gross, 
                                net,
                                toPar: gross - totalPar
                            });
                        }
                    });

                    return {
                        id: player.id,
                        name: player.name,
                        handicap: player.handicap,
                        totalGross,
                        totalNet,
                        roundsPlayed,
                        rounds
                    };
                });

                // Sort by total net (lower is better)
                standings.sort((a, b) => {
                    if (a.roundsPlayed === 0 && b.roundsPlayed === 0) return 0;
                    if (a.roundsPlayed === 0) return 1;
                    if (b.roundsPlayed === 0) return -1;
                    return a.totalNet - b.totalNet;
                });

                return standings;
            },

            renderLeagueStandings() {
                const l = this.league;
                const tournaments = JSON.parse(localStorage.getItem('golfcove_tournaments') || '[]')
                    .filter(t => t.leagueId === l.id);
                
                document.getElementById('tournamentName').textContent = l.name;
                document.getElementById('eventInfo').innerHTML = `<strong>${l.season}</strong> • ${tournaments.length} rounds played`;
                document.getElementById('liveBadge').style.display = 'none';
                document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;

                const standings = this.calculateLeagueStandings();

                let html = `
                    <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        ${tournaments.map(t => `
                            <a href="leaderboard.html?t=${t.id}" style="padding: 8px 16px; background: #f5f5f5; border-radius: 5px; text-decoration: none; color: #333; font-size: 13px;">
                                ${t.name} <span style="color: #666;">(${new Date(t.date).toLocaleDateString()})</span>
                            </a>
                        `).join('')}
                    </div>

                    <h3 style="margin-bottom: 15px; color: #333;"><i class="fas fa-trophy" style="color: #ffd700;"></i> Season Standings</h3>
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th>Pos</th>
                                <th>Player</th>
                                <th>Rounds</th>
                                <th>Total Gross</th>
                                <th>Total Net</th>
                                <th>Avg</th>
                            </tr>
                        </thead>
                        <tbody>`;

                standings.forEach((s, index) => {
                    const pos = index + 1;
                    const posClass = pos <= 3 ? `position-${pos}` : '';
                    const avg = s.roundsPlayed > 0 ? (s.totalGross / s.roundsPlayed).toFixed(1) : '-';

                    html += `
                        <tr onclick="leaderboard.toggleRoundHistory('${s.id}')" style="cursor: pointer;">
                            <td class="position ${posClass}">${s.roundsPlayed > 0 ? pos : '-'}</td>
                            <td>
                                <span class="player-name">${s.name}</span>
                                <span class="player-handicap">HCP: ${s.handicap || 0}</span>
                            </td>
                            <td>${s.roundsPlayed}</td>
                            <td class="score-cell">${s.totalGross || '-'}</td>
                            <td class="score-cell" style="color: #37b24a; font-weight: 700;">${s.totalNet || '-'}</td>
                            <td class="thru-cell">${avg}</td>
                        </tr>
                        <tr class="hole-by-hole" id="rounds-${s.id}">
                            <td colspan="6">
                                <div style="padding: 10px;">
                                    <strong>Round History:</strong>
                                    ${s.rounds.length === 0 ? '<p style="color: #666; margin-top: 10px;">No rounds completed yet.</p>' : `
                                        <table style="width: 100%; margin-top: 10px; font-size: 13px;">
                                            <tr style="background: #f5f5f5;">
                                                <th style="padding: 8px; text-align: left;">Round</th>
                                                <th style="padding: 8px; text-align: left;">Date</th>
                                                <th style="padding: 8px;">Gross</th>
                                                <th style="padding: 8px;">Net</th>
                                                <th style="padding: 8px;">To Par</th>
                                            </tr>
                                            ${s.rounds.map(r => `
                                                <tr>
                                                    <td style="padding: 8px;"><a href="leaderboard.html?t=${r.tournamentId}" style="color: #37b24a;">${r.name}</a></td>
                                                    <td style="padding: 8px; color: #666;">${new Date(r.date).toLocaleDateString()}</td>
                                                    <td style="padding: 8px; text-align: center;">${r.gross}</td>
                                                    <td style="padding: 8px; text-align: center; font-weight: 600;">${r.net}</td>
                                                    <td style="padding: 8px; text-align: center; color: ${r.toPar < 0 ? '#37b24a' : r.toPar > 0 ? '#f44336' : '#333'};">
                                                        ${r.toPar === 0 ? 'E' : (r.toPar > 0 ? '+' : '') + r.toPar}
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </table>
                                    `}
                                </div>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                document.getElementById('leaderboardContent').innerHTML = html;
            },

            toggleRoundHistory(playerId) {
                const row = document.getElementById('rounds-' + playerId);
                row.classList.toggle('expanded');
            },

            calculatePlayerStats(player) {
                const scores = this.getScores();
                const playerScores = scores[player.id] || {};
                const course = this.getCourse();
                const holes = course ? course.holes : 18;

                let gross = 0;
                let holesPlayed = 0;
                let totalPar = 0;

                for (let i = 1; i <= holes; i++) {
                    if (playerScores[i]) {
                        gross += playerScores[i];
                        holesPlayed++;
                        totalPar += this.getParForHole(i);
                    }
                }

                const net = gross - (player.handicap || 0);
                const toPar = gross - totalPar;
                const submitted = playerScores.submitted || false;

                return {
                    gross,
                    net,
                    holesPlayed,
                    toPar,
                    submitted,
                    scores: playerScores
                };
            },

            getParForHole(hole) {
                const course = this.getCourse();
                if (course && course.pars && course.pars[hole - 1]) {
                    return course.pars[hole - 1];
                }
                return 4;
            },

            formatToPar(toPar) {
                if (toPar === 0) return 'E';
                if (toPar > 0) return '+' + toPar;
                return toPar.toString();
            },

            render() {
                const t = this.tournament;
                const course = this.getCourse();

                document.getElementById('tournamentName').textContent = t.name;
                
                let eventInfoHtml = `${course ? course.name : 'Unknown Course'} • ${new Date(t.date).toLocaleDateString()}`;
                if (this.league) {
                    eventInfoHtml += ` <a href="leaderboard.html?league=${this.league.id}" style="color: #37b24a; margin-left: 15px;"><i class="fas fa-trophy"></i> View Season Standings</a>`;
                }
                document.getElementById('eventInfo').innerHTML = eventInfoHtml;

                // Check if any players are still playing
                const scores = this.getScores();
                const hasActivePlayers = t.players.some(p => {
                    const ps = scores[p.id] || {};
                    return Object.keys(ps).filter(k => k !== 'submitted' && k !== 'submittedAt').length > 0 && !ps.submitted;
                });

                document.getElementById('liveBadge').style.display = hasActivePlayers ? 'inline-block' : 'none';
                document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;

                // Calculate standings
                const standings = t.players.map(player => ({
                    player,
                    stats: this.calculatePlayerStats(player)
                })).sort((a, b) => {
                    if (a.stats.holesPlayed === 0 && b.stats.holesPlayed === 0) return 0;
                    if (a.stats.holesPlayed === 0) return 1;
                    if (b.stats.holesPlayed === 0) return -1;
                    return a.stats.gross - b.stats.gross;
                });

                if (standings.length === 0) {
                    document.getElementById('leaderboardContent').innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>No players yet</h3>
                            <p>Add players to this tournament to see the leaderboard.</p>
                        </div>
                    `;
                    return;
                }

                // Show season context if part of league
                let seasonHtml = '';
                if (this.league) {
                    const leagueStandings = this.calculateLeagueStandings();
                    seasonHtml = `
                        <div style="background: linear-gradient(135deg, #37b24a, #2d9940); color: #fff; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                            <h3 style="margin-bottom: 15px;"><i class="fas fa-trophy"></i> ${this.league.name} - Season Standings</h3>
                            <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                                ${leagueStandings.slice(0, 5).map((s, i) => `
                                    <div style="text-align: center;">
                                        <div style="font-size: 24px; font-weight: 700;">${i + 1}</div>
                                        <div style="font-size: 14px;">${s.name}</div>
                                        <div style="font-size: 12px; opacity: 0.8;">Net: ${s.totalNet} (${s.roundsPlayed} rds)</div>
                                    </div>
                                `).join('')}
                            </div>
                            <a href="leaderboard.html?league=${this.league.id}" style="display: inline-block; margin-top: 15px; color: #fff; text-decoration: underline;">View Full Standings →</a>
                        </div>
                    `;
                }

                let html = seasonHtml + `
                    <h3 style="margin-bottom: 15px; color: #333;">Current Round</h3>
                    <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Player</th>
                            <th>To Par</th>
                            <th>Gross</th>
                            <th>Net</th>
                            <th>Thru</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>`;

                standings.forEach((s, index) => {
                    const pos = index + 1;
                    const posClass = pos <= 3 ? `position-${pos}` : '';
                    const holes = course ? course.holes : 18;

                    html += `
                        <tr onclick="leaderboard.toggleHoleByHole('${s.player.id}')" style="cursor: pointer;">
                            <td class="position ${posClass}">${s.stats.holesPlayed > 0 ? pos : '-'}</td>
                            <td>
                                <span class="player-name">${s.player.name}</span>
                                <span class="player-handicap">HCP: ${s.player.handicap || 0}</span>
                            </td>
                            <td class="score-cell ${s.stats.toPar < 0 ? 'score-under' : s.stats.toPar > 0 ? 'score-over' : 'score-even'}">
                                ${s.stats.holesPlayed > 0 ? this.formatToPar(s.stats.toPar) : '-'}
                            </td>
                            <td class="score-cell">${s.stats.gross || '-'}</td>
                            <td class="score-cell">${s.stats.holesPlayed > 0 ? s.stats.net : '-'}</td>
                            <td class="thru-cell">${s.stats.holesPlayed > 0 ? (s.stats.holesPlayed === holes ? 'F' : s.stats.holesPlayed) : '-'}</td>
                            <td class="status-cell ${s.stats.submitted ? 'status-finished' : 'status-playing'}">
                                ${s.stats.submitted ? '<i class="fas fa-check"></i> Finished' : s.stats.holesPlayed > 0 ? '<i class="fas fa-golf-ball"></i> Playing' : 'Not started'}
                            </td>
                        </tr>
                        <tr class="hole-by-hole" id="hbh-${s.player.id}">
                            <td colspan="7">
                                ${this.renderHoleByHole(s.stats.scores, holes)}
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                document.getElementById('leaderboardContent').innerHTML = html;
            },

            renderHoleByHole(scores, holes) {
                let html = '<div class="hole-scores">';
                
                // Front 9 headers
                for (let i = 1; i <= 9; i++) {
                    html += `<div class="hole-header">${i}</div>`;
                }
                html += '<div class="hole-header out-cell">OUT</div>';
                
                // Front 9 par
                let frontPar = 0;
                for (let i = 1; i <= 9; i++) {
                    const par = this.getParForHole(i);
                    frontPar += par;
                    html += `<div class="par-row">${par}</div>`;
                }
                html += `<div class="par-row">${frontPar}</div>`;
                
                // Front 9 scores
                let frontScore = 0;
                for (let i = 1; i <= 9; i++) {
                    const score = scores[i] || '-';
                    if (scores[i]) frontScore += scores[i];
                    html += `<div class="score-row">${score}</div>`;
                }
                html += `<div class="score-row out-cell">${frontScore || '-'}</div>`;

                html += '</div>';

                if (holes === 18) {
                    html += '<div class="hole-scores" style="margin-top: 10px;">';
                    
                    // Back 9 headers
                    for (let i = 10; i <= 18; i++) {
                        html += `<div class="hole-header">${i}</div>`;
                    }
                    html += '<div class="hole-header in-cell">IN</div>';
                    
                    // Back 9 par
                    let backPar = 0;
                    for (let i = 10; i <= 18; i++) {
                        const par = this.getParForHole(i);
                        backPar += par;
                        html += `<div class="par-row">${par}</div>`;
                    }
                    html += `<div class="par-row">${backPar}</div>`;
                    
                    // Back 9 scores
                    let backScore = 0;
                    for (let i = 10; i <= 18; i++) {
                        const score = scores[i] || '-';
                        if (scores[i]) backScore += scores[i];
                        html += `<div class="score-row">${score}</div>`;
                    }
                    html += `<div class="score-row in-cell">${backScore || '-'}</div>`;

                    html += '</div>';
                    
                    // Total
                    html += `<div style="text-align: right; margin-top: 10px; font-weight: 600;">Total: ${(frontScore + backScore) || '-'}</div>`;
                }

                return html;
            },

            toggleHoleByHole(playerId) {
                const row = document.getElementById('hbh-' + playerId);
                row.classList.toggle('expanded');
            },

            refresh() {
                this.loadData();
            },

            startAutoRefresh() {
                this.refreshInterval = setInterval(() => {
                    if (document.getElementById('autoRefresh').checked) {
                        this.refresh();
                    }
                }, 10000);
            }
        };

        document.addEventListener('DOMContentLoaded', () => leaderboard.init());
    </script>
</body>
</html>
