<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Golf Cove - Admin Panel</title>
    <link rel="icon" type="image/png" href="images/golfCoveLogo6.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/league-admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-main">
            <div class="logo">
                <a href="index.html">
                    <img src="images/golfcovelogo.png" alt="Golf Cove Logo">
                </a>
            </div>
            <nav class="main-nav" id="mainNav">
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="pricing.html">Pricing</a></li>
                    <li><a href="lessons-leagues.html">Lessons & Leagues</a></li>
                    <li><a href="tournaments.html">Standings</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle Menu">
                <span></span><span></span><span></span>
            </button>
        </div>
    </header>

    <!-- Admin Layout -->
    <div class="admin-wrapper" id="adminWrapper" style="display: none;">
        <!-- Sidebar -->
        <aside class="admin-sidebar" id="adminSidebar">
            <div class="league-info">
                <h2 id="sidebarLeagueName">Golf Cove League</h2>
                <div class="season" id="sidebarSeason"></div>
            </div>
            <div class="admin-nav">
                <div class="nav-item active" data-section="dashboard" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="nav-item" data-section="teams" onclick="showSection('teams')">
                    <i class="fas fa-users"></i> Teams & Players
                </div>
                <div class="nav-item" data-section="rounds" onclick="showSection('rounds')">
                    <i class="fas fa-flag"></i> Rounds
                </div>
                <div class="nav-item" data-section="print" onclick="showSection('print')">
                    <i class="fas fa-print"></i> Print & Documents
                </div>
                <div class="nav-item" data-section="customers" onclick="showSection('customers')">
                    <i class="fas fa-users"></i> Customers
                </div>
                <div class="nav-item" data-section="settings" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> Settings
                </div>
                <div class="nav-divider"></div>
                <div class="nav-item danger" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i> Sign Out
                </div>
            </div>
        </aside>
        
        <!-- Mobile overlay -->
        <div class="mobile-sidebar-overlay" id="mobileSidebarOverlay" onclick="toggleMobileSidebar()"></div>
        
        <!-- Main Content Area -->
        <main class="admin-main">
            <div class="main-content">
        
                <!-- Dashboard Section -->
                <div class="page-section active" id="section-dashboard">
                    <h1 class="page-title"><i class="fas fa-home"></i> Dashboard</h1>
            
            <div id="currentRoundStatus"></div>
            
            <div class="card">
                <h3><i class="fas fa-chart-bar"></i> Quick Stats</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #37b24a;" id="statTeams">0</div>
                        <div style="font-size: 13px; color: #888;">Teams</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #37b24a;" id="statPlayers">0</div>
                        <div style="font-size: 13px; color: #888;">Players</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #37b24a;" id="statRounds">0</div>
                        <div style="font-size: 13px; color: #888;">Rounds</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Common tasks for league management</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                    <button class="btn" onclick="showSection('teams'); openAddTeamModal()" style="justify-content: center;">
                        <i class="fas fa-users"></i> Add Team
                    </button>
                    <button class="btn" onclick="showSection('rounds')" style="justify-content: center;">
                        <i class="fas fa-flag"></i> Add Round
                    </button>
                    <button class="btn btn-secondary" onclick="showSection('print')" style="justify-content: center;">
                        <i class="fas fa-print"></i> Print Scorecards
                    </button>
                    <button class="btn btn-secondary" onclick="exportData()" style="justify-content: center;">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Teams & Players Section -->
        <div class="page-section" id="section-teams">
            <h1 class="page-title"><i class="fas fa-users"></i> Teams & Players</h1>
            
            <!-- Quick Actions -->
            <div class="card" style="margin-bottom: 20px;">
                <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                    <button class="btn btn-sm" style="background: #37b24a;" onclick="openAddTeamModal()"><i class="fas fa-plus"></i> New Team</button>
                    <button class="btn btn-secondary btn-sm" onclick="syncMemberStatus()" title="Refresh member status from Stripe"><i class="fas fa-sync-alt"></i> Sync Members</button>
                    <button class="btn btn-secondary btn-sm" onclick="generatePinsForAll()"><i class="fas fa-magic"></i> Generate PINs</button>
                    <button class="btn btn-secondary btn-sm" onclick="printPinSheet()"><i class="fas fa-print"></i> Print PINs</button>
                    <button class="btn btn-secondary btn-sm" onclick="exportTeamsCSV(); document.getElementById('exportModal')?.remove();"><i class="fas fa-download"></i> Export Teams</button>
                    <button class="btn btn-secondary btn-sm" onclick="cleanupOrphanedPlayers()" title="Remove players without a team"><i class="fas fa-broom"></i> Cleanup</button>
                    <div id="pinStats" style="font-size: 13px; margin-left: auto; color: #666;"></div>
                </div>
                <div id="playerSyncStatus" style="display: none; background: #f0f9ff; padding: 10px; margin-top: 12px; font-size: 13px; color: #0369a1; border-radius: 6px;">
                    <i class="fas fa-info-circle"></i> <span id="playerSyncMessage"></span>
                </div>
            </div>
            
            <!-- Teams Grid -->
            <div class="card">
                <h3><i class="fas fa-user-friends"></i> Teams</h3>
                <p style="color: #666; font-size: 13px; margin-bottom: 15px;">Each team has a 4-digit PIN. Players use this PIN to access their scorecard. Click any field to edit inline.</p>
                <div class="team-grid" id="teamGrid"></div>
            </div>
        </div>
        
        <!-- Rounds Section -->
        <div class="page-section" id="section-rounds">
            <h1 class="page-title"><i class="fas fa-flag"></i> Rounds</h1>
            
            <div class="card">
                <h3><i class="fas fa-plus-circle"></i> Add New Round</h3>
                <form onsubmit="addRound(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Round Name</label>
                            <input type="text" id="roundName" required placeholder="Week 1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" id="roundStartDate" required>
                        </div>
                        <div class="form-group">
                            <label>End Date</label>
                            <input type="date" id="roundEndDate" required>
                        </div>
                    </div>
                    <button type="submit" class="btn"><i class="fas fa-plus"></i> Add Round</button>
                </form>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-list"></i> All Rounds</h3>
                <div id="roundsList"></div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-calendar-alt"></i> Import Winter 2025 Schedule</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">One-click import of the full Winter 2025 league schedule (15 rounds including playoffs).</p>
                <button type="button" class="btn" onclick="importWinter2025Schedule()" style="background: #37b24a;">
                    <i class="fas fa-file-import"></i> Import Schedule
                </button>
            </div>
        </div>
        
        <!-- Print Section -->
        <div class="page-section" id="section-print">
            <h1 class="page-title"><i class="fas fa-print"></i> Print & Documents</h1>
            
            <!-- Print Blank Scorecards -->
            <div class="card">
                <h3><i class="fas fa-id-card"></i> Print Blank Scorecards</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Print blank scorecards for teams or generic use.</p>
                <div class="print-grid">
                    <select id="printTeamSelect" onchange="updatePrintPreview()">
                        <option value="">Select a Team</option>
                    </select>
                </div>
                <div id="printPreview" style="display:none; margin: 20px 0;">
                    <p style="font-size: 13px; color: #666; margin-bottom: 15px; text-align: center; font-weight: 600;">Scorecard Preview:</p>
                    <div id="scorecardPreviewContainer"></div>
                    <div id="teamQRPreview" style="display: none;"></div>
                </div>
                <button class="btn" onclick="printScorecards()" id="printBtn" disabled><i class="fas fa-print"></i> Print Scorecards</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="card">
                    <h3><i class="fas fa-qrcode"></i> General Scoring Link</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">A general link for anyone to enter scores (useful for posting online).</p>
                    <div id="generalQRCode" style="text-align: center; margin: 15px 0;"></div>
                    <p style="text-align: center; font-size: 12px; color: #888; word-break: break-all;" id="generalQRUrl"></p>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                        <button class="btn btn-sm" onclick="copyGeneralUrl()"><i class="fas fa-copy"></i> Copy Link</button>
                        <a href="qr-poster.html" target="_blank" class="btn btn-sm" style="text-decoration: none;"><i class="fas fa-print"></i> Print QR Poster</a>
                    </div>
                    
                    <!-- QR Poster Preview -->
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <p style="font-size: 13px; font-weight: 600; color: #333; margin-bottom: 10px; text-align: center;">Poster Preview (for golf rooms)</p>
                        <div style="background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%); border-radius: 8px; padding: 15px; max-width: 200px; margin: 0 auto; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                            <img src="images/golfcovelogo.png" alt="Golf Cove" style="width: 60px; display: block; margin: 0 auto 8px;">
                            <p style="color: #37b24a; font-size: 10px; font-weight: 700; text-align: center; margin-bottom: 5px; text-transform: uppercase;">Enter Your Score</p>
                            <div style="background: #fff; border-radius: 4px; padding: 8px; margin-bottom: 8px;">
                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://golfcove.web.app/score.html&color=1a1a1a&bgcolor=ffffff" alt="QR" style="width: 100%; display: block;">
                            </div>
                            <p style="color: #fff; font-size: 7px; text-align: center; opacity: 0.8;">1. Scan  2. Enter PIN  3. Submit</p>
                        </div>
                        <p style="font-size: 11px; color: #888; text-align: center; margin-top: 10px;">Click "Print QR Poster" to get a full-size 8.5x11" version</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i class="fas fa-key"></i> Print Player PINs</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Print a sheet with each player's personal PIN for score entry.</p>
                    <button class="btn" onclick="printPinSheet()" style="width: 100%;"><i class="fas fa-print"></i> Print PIN Sheet</button>
                    <div style="margin-top: 15px;"></div>
                    <h3 style="margin-top: 10px;"><i class="fas fa-download"></i> Export Data</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Download all league data as a JSON file.</p>
                    <button class="btn btn-secondary" onclick="exportData()" style="width: 100%;"><i class="fas fa-download"></i> Export JSON</button>
                </div>
            </div>
        </div>
        
        <!-- Score Document Print View (Hidden by default) -->
        <div id="scoreDocPrintView" style="display: none;">
            <div id="scoreDocPrintContent"></div>
        </div>
        
        <!-- Membership Management Section -->
        <div class="page-section" id="section-customers">
            <h1 class="page-title"><i class="fas fa-users"></i> Customers</h1>
            
            <!-- Customer & Membership Stats -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 20px;">
                <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: 700; color: #1a1a2e;" id="statTotalCustomers">0</div>
                            <div style="font-size: 12px; color: #888;">Total Customers</div>
                        </div>
                        <i class="fas fa-users" style="font-size: 20px; color: #1a1a2e; opacity: 0.5;"></i>
                    </div>
                </div>
                <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: 700; color: #9b59b6;" id="statEagleMembers">0</div>
                            <div style="font-size: 12px; color: #888;">Eagle</div>
                        </div>
                        <i class="fas fa-crown" style="font-size: 20px; color: #9b59b6; opacity: 0.5;"></i>
                    </div>
                </div>
                <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: 700; color: #f39c12;" id="statBirdieMembers">0</div>
                            <div style="font-size: 12px; color: #888;">Birdie</div>
                        </div>
                        <i class="fas fa-star" style="font-size: 20px; color: #f39c12; opacity: 0.5;"></i>
                    </div>
                </div>
                <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: 700; color: #27ae60;" id="statParMembers">0</div>
                            <div style="font-size: 12px; color: #888;">Par</div>
                        </div>
                        <i class="fas fa-golf-ball" style="font-size: 20px; color: #27ae60; opacity: 0.5;"></i>
                    </div>
                </div>
                <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: 700; color: #3498db;" id="statTotalMembers">0</div>
                            <div style="font-size: 12px; color: #888;">Active Members</div>
                        </div>
                        <i class="fas fa-id-card" style="font-size: 20px; color: #3498db; opacity: 0.5;"></i>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="card" style="margin-bottom: 20px;">
                <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                    <button class="btn btn-sm" onclick="syncStripeCustomers()"><i class="fas fa-sync-alt"></i> Sync Stripe</button>
                    <a href="membership-signup.html" target="_blank" class="btn btn-sm btn-secondary" style="text-decoration: none;"><i class="fas fa-user-plus"></i> New Member</a>
                    <button class="btn btn-sm btn-secondary" onclick="exportCustomersCSV()"><i class="fas fa-download"></i> Export</button>
                    <a href="https://dashboard.stripe.com/subscriptions" target="_blank" class="btn btn-sm btn-secondary" style="text-decoration: none;"><i class="fab fa-stripe-s"></i> Subscriptions</a>
                    <div id="customerStats" style="font-size: 13px; margin-left: auto; color: #666;"></div>
                </div>
                <div id="customerSyncStatus" style="display: none; background: #f0f9ff; padding: 10px; margin-top: 12px; font-size: 13px; color: #0369a1; border-radius: 6px;">
                    <i class="fas fa-info-circle"></i> <span id="customerSyncMessage"></span>
                </div>
            </div>
            
            <!-- Customers List -->
            <div class="card" style="padding: 0; overflow: hidden;">
                <!-- Tabs -->
                <div style="display: flex; border-bottom: 1px solid #e5e7eb;">
                    <button class="customer-tab" onclick="setCustomerTab('all')" id="tabAll" style="flex: 1; padding: 12px; border: none; background: none; font-weight: 600; cursor: pointer; border-bottom: 2px solid #1a1a2e; color: #1a1a2e; font-size: 13px;">
                        All Customers <span id="tabCountAll" style="background:#1a1a2e;color:#fff;padding:2px 6px;border-radius:8px;font-size:10px;margin-left:4px;">0</span>
                    </button>
                    <button class="customer-tab" onclick="setCustomerTab('members')" id="tabMembers" style="flex: 1; padding: 12px; border: none; background: none; font-weight: 500; cursor: pointer; color: #888; font-size: 13px; border-bottom: 2px solid transparent;">
                        Members <span id="tabCountMembers" style="background:#e5e7eb;color:#666;padding:2px 6px;border-radius:8px;font-size:10px;margin-left:4px;">0</span>
                    </button>
                    <button class="customer-tab" onclick="setCustomerTab('league')" id="tabLeague" style="flex: 1; padding: 12px; border: none; background: none; font-weight: 500; cursor: pointer; color: #888; font-size: 13px; border-bottom: 2px solid transparent;">
                        League <span id="tabCountLeague" style="background:#e5e7eb;color:#666;padding:2px 6px;border-radius:8px;font-size:10px;margin-left:4px;">0</span>
                    </button>
                    <button class="customer-tab" onclick="setCustomerTab('inactive')" id="tabInactive" style="flex: 1; padding: 12px; border: none; background: none; font-weight: 500; cursor: pointer; color: #888; font-size: 13px; border-bottom: 2px solid transparent;">
                        Non-Members <span id="tabCountInactive" style="background:#e5e7eb;color:#666;padding:2px 6px;border-radius:8px;font-size:10px;margin-left:4px;">0</span>
                    </button>
                </div>
                
                <div style="padding: 15px 20px;">
                    <!-- Search & Filter -->
                    <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                        <input type="text" id="customerSearch" placeholder="Search by name, email, or phone..." 
                            oninput="renderCustomers()"
                            style="flex: 1; min-width: 200px; padding: 10px 15px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
                        <select id="memberTypeFilter" onchange="renderCustomers()" style="padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 13px;">
                            <option value="all">All Tiers</option>
                            <option value="eagle">Eagle</option>
                            <option value="birdie">Birdie</option>
                            <option value="par">Par</option>
                        </select>
                    </div>
                    
                    <!-- Bulk Selection Bar -->
                    <div id="bulkSelectionBar" style="display: none; background: #f8f9fa; border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px 15px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="selectAllCustomers" onchange="toggleSelectAll(this.checked)">
                                <span style="font-weight: 600; color: #333;">Select All</span>
                            </label>
                            <span id="selectedCount" style="color: #666;">0 selected</span>
                            <div style="margin-left: auto; display: flex; gap: 8px;">
                                <button class="btn btn-sm btn-secondary" onclick="bulkExport()"><i class="fas fa-download"></i></button>
                                <button class="btn btn-sm btn-danger" onclick="bulkDelete()"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Member List -->
                    <div id="customerGrid" style="display: grid; gap: 6px;">
                        <div style="padding: 60px; text-align: center;">
                            <i class="fas fa-users" style="font-size: 48px; color: #ccc; margin-bottom: 15px; display: block;"></i>
                            <p style="color: #888; font-size: 14px;">Loading customers...</p>
                        </div>
                    </div>
                    
                    <!-- Pagination -->
                    <div id="customerPagination" style="display: flex; justify-content: center; gap: 6px; margin-top: 15px;"></div>
                </div>
            </div>
        </div>
        
        <!-- Settings Section -->
        <div class="page-section" id="section-settings">
            <h1 class="page-title"><i class="fas fa-cog"></i> Settings</h1>
            
            <!-- Business Details -->
            <div class="card" style="border-left:4px solid #4a90a4;">
                <h3><i class="fas fa-building" style="color:#4a90a4;"></i> Business Details</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Core business information used on receipts and communications.</p>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                    <div>
                        <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Business Name</label>
                        <input type="text" id="settingBusinessName" placeholder="Golf Cove" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                    </div>
                    <div>
                        <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Phone Number</label>
                        <input type="tel" id="settingBusinessPhone" placeholder="(203) 390-5994" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                    </div>
                    <div>
                        <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Email Address</label>
                        <input type="email" id="settingBusinessEmail" placeholder="info@golfcovect.com" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                    </div>
                    <div>
                        <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Tax Rate (%)</label>
                        <input type="number" id="settingTaxRate" step="0.01" placeholder="6.35" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                    </div>
                    <div style="grid-column:span 2;">
                        <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Address</label>
                        <input type="text" id="settingBusinessAddress" placeholder="336 State Street, North Haven, CT 06473" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                    </div>
                </div>
                <button class="btn" onclick="saveBusinessSettings()" style="margin-top:15px;"><i class="fas fa-save"></i> Save Business Details</button>
            </div>
            
            <!-- Stripe Payment Settings -->
            <div class="card" style="border-left:4px solid #7b1fa2;">
                <h3><i class="fab fa-stripe" style="color:#7b1fa2;"></i> Stripe Payment Settings</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Configure Stripe for online gift card purchases and website payments.</p>
                <div style="display:grid;gap:15px;">
                    <div>
                        <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Publishable Key <span style="font-weight:400;color:#999;">(starts with pk_)</span></label>
                        <input type="text" id="settingStripePK" placeholder="pk_live_... or pk_test_..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-family:monospace;font-size:12px;">
                    </div>
                    <div>
                        <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Secret Key <span style="font-weight:400;color:#999;">(starts with sk_ - keep private!)</span></label>
                        <input type="password" id="settingStripeSK" placeholder="sk_live_... or sk_test_..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-family:monospace;font-size:12px;">
                        <p style="font-size:11px;color:#e74c3c;margin-top:5px;"><i class="fas fa-exclamation-triangle"></i> Never share your secret key.</p>
                    </div>
                </div>
                <div style="margin-top:15px;padding:12px;background:#f8f9fa;border-radius:6px;">
                    <div style="font-size:12px;color:#666;">
                        <strong>Where to find your keys:</strong><br>
                        <a href="https://dashboard.stripe.com/apikeys" target="_blank" style="color:#7b1fa2;">Stripe Dashboard → Developers → API Keys</a>
                    </div>
                </div>
                <button class="btn" onclick="saveStripeSettings()" style="margin-top:15px;"><i class="fas fa-save"></i> Save Stripe Settings</button>
            </div>
            
            <!-- Cloud Sync -->
            <div class="card" style="border-left:4px solid #3498db;">
                <h3><i class="fas fa-cloud" style="color:#3498db;"></i> Cloud Sync</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Sync data with Firebase cloud storage for backup and cross-device access.</p>
                <div style="display:flex;gap:10px;flex-wrap:wrap;">
                    <button class="btn" onclick="syncToCloud()"><i class="fas fa-cloud-upload-alt"></i> Push to Cloud</button>
                    <button class="btn btn-secondary" onclick="pullFromCloud()"><i class="fas fa-cloud-download-alt"></i> Pull from Cloud</button>
                </div>
                <p style="font-size:11px;color:#888;margin-top:10px;"><i class="fas fa-info-circle"></i> Push uploads local data to cloud. Pull downloads cloud data to local storage.</p>
            </div>
            
            <!-- Data Management -->
            <div class="card" style="border-left:4px solid #e74c3c;">
                <h3><i class="fas fa-database" style="color:#e74c3c;"></i> Data Management</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Import, export, or reset system data. <strong style="color:#e74c3c;">Use caution!</strong></p>
                <div style="display:flex;gap:10px;flex-wrap:wrap;">
                    <button class="btn" onclick="exportAllPOSData()"><i class="fas fa-download"></i> Export All Data</button>
                    <button class="btn btn-secondary" onclick="importPOSData()"><i class="fas fa-upload"></i> Import Data</button>
                    <button class="btn" style="background:#e74c3c;" onclick="resetAllPOSData()"><i class="fas fa-redo"></i> Reset All Data</button>
                </div>
                <input type="file" id="importDataFile" accept=".json" style="display:none;" onchange="handleDataImport(event)">
            </div>
            
            <!-- League Reset -->
            <div class="card" style="border-left:4px solid #c0392b;">
                <h3><i class="fas fa-trophy" style="color:#c0392b;"></i> League Management</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Reset the entire league including teams, players, rounds, and scores. <strong style="color:#e74c3c;">This cannot be undone!</strong></p>
                <button class="btn" style="background:#c0392b;" onclick="resetLeague()"><i class="fas fa-trash-alt"></i> Reset League</button>
            </div>
        </div>

        <!-- Staff Management Section -->
        <div class="page-section" id="section-staff">
            <h1 class="page-title"><i class="fas fa-id-badge"></i> Staff Management</h1>
            
            <div class="card">
                <h3><i class="fas fa-users-cog"></i> Staff Members</h3>
                <div id="staffList"></div>
                <button class="btn" onclick="showAddStaffModal()" style="margin-top: 15px;"><i class="fas fa-plus"></i> Add Staff Member</button>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-shield-alt"></i> Role Permissions</h3>
                <table style="width:100%;border-collapse:collapse;font-size:14px;">
                    <thead>
                        <tr style="background:#f5f6f8;">
                            <th style="padding:12px;text-align:left;">Permission</th>
                            <th style="padding:12px;text-align:center;">Manager</th>
                            <th style="padding:12px;text-align:center;">Bartender</th>
                            <th style="padding:12px;text-align:center;">Server</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td style="padding:10px;border-bottom:1px solid #eee;">Apply Discounts</td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-check" style="color:#27ae60;"></i> 100%</td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-check" style="color:#f39c12;"></i> 20%</td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-times" style="color:#e74c3c;"></i></td></tr>
                        <tr><td style="padding:10px;border-bottom:1px solid #eee;">Void Sales</td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-check" style="color:#27ae60;"></i></td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-check" style="color:#27ae60;"></i></td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-times" style="color:#e74c3c;"></i></td></tr>
                        <tr><td style="padding:10px;border-bottom:1px solid #eee;">Process Refunds</td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-check" style="color:#27ae60;"></i></td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-times" style="color:#e74c3c;"></i></td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-times" style="color:#e74c3c;"></i></td></tr>
                        <tr><td style="padding:10px;border-bottom:1px solid #eee;">Open Cash Drawer</td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-check" style="color:#27ae60;"></i></td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-check" style="color:#27ae60;"></i></td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-times" style="color:#e74c3c;"></i></td></tr>
                        <tr><td style="padding:10px;border-bottom:1px solid #eee;">View Reports</td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-check" style="color:#27ae60;"></i></td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-times" style="color:#e74c3c;"></i></td><td style="text-align:center;border-bottom:1px solid #eee;"><i class="fas fa-times" style="color:#e74c3c;"></i></td></tr>
                        <tr><td style="padding:10px;">Manage Staff</td><td style="text-align:center;"><i class="fas fa-check" style="color:#27ae60;"></i></td><td style="text-align:center;"><i class="fas fa-times" style="color:#e74c3c;"></i></td><td style="text-align:center;"><i class="fas fa-times" style="color:#e74c3c;"></i></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Time Clock Section -->
        <div class="page-section" id="section-timeclock">
            <h1 class="page-title"><i class="fas fa-clock"></i> Time Clock</h1>
            
            <div class="card">
                <h3><i class="fas fa-calendar-day"></i> Today's Activity</h3>
                <div id="todayTimeclock"></div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-history"></i> Time Clock History</h3>
                <div style="display:flex;gap:10px;margin-bottom:15px;">
                    <input type="date" id="timeclockStartDate" style="padding:8px;border:1px solid #ddd;border-radius:6px;">
                    <input type="date" id="timeclockEndDate" style="padding:8px;border:1px solid #ddd;border-radius:6px;">
                    <button class="btn btn-sm" onclick="filterTimeclock()"><i class="fas fa-filter"></i> Filter</button>
                    <button class="btn btn-sm btn-secondary" onclick="exportTimeclock()"><i class="fas fa-download"></i> Export</button>
                </div>
                <div id="timeclockHistory"></div>
            </div>
        </div>

        <!-- Sales Reports Section -->
        <div class="page-section" id="section-reports">
            <h1 class="page-title"><i class="fas fa-chart-bar"></i> Sales Reports</h1>
            
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:15px;margin-bottom:25px;">
                <div class="card" style="text-align:center;margin-bottom:0;">
                    <div style="font-size:28px;font-weight:700;color:#27ae60;" id="reportTodaySales">$0.00</div>
                    <div style="font-size:12px;color:#888;">Today's Sales</div>
                </div>
                <div class="card" style="text-align:center;margin-bottom:0;">
                    <div style="font-size:28px;font-weight:700;color:#3498db;" id="reportWeekSales">$0.00</div>
                    <div style="font-size:12px;color:#888;">This Week</div>
                </div>
                <div class="card" style="text-align:center;margin-bottom:0;">
                    <div style="font-size:28px;font-weight:700;color:#9b59b6;" id="reportMonthSales">$0.00</div>
                    <div style="font-size:12px;color:#888;">This Month</div>
                </div>
                <div class="card" style="text-align:center;margin-bottom:0;">
                    <div style="font-size:28px;font-weight:700;color:#e67e22;" id="reportTransCount">0</div>
                    <div style="font-size:12px;color:#888;">Transactions</div>
                </div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-list"></i> Recent Transactions</h3>
                <div id="recentTransactionsReport"></div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-chart-pie"></i> Sales by Category</h3>
                <div id="salesByCategory"></div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-user-tie"></i> Sales by Employee</h3>
                <div id="salesByEmployee"></div>
            </div>
        </div>

        <!-- Inventory Section -->
        <div class="page-section" id="section-inventory">
            <h1 class="page-title"><i class="fas fa-boxes"></i> Inventory Management</h1>
            
            <div class="card">
                <h3><i class="fas fa-exclamation-triangle" style="color:#e74c3c;"></i> Low Stock Alerts</h3>
                <div id="lowStockAlerts"></div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-warehouse"></i> All Inventory</h3>
                <div style="display:flex;gap:10px;margin-bottom:15px;">
                    <input type="text" id="inventorySearch" placeholder="Search items..." style="flex:1;padding:10px;border:1px solid #ddd;border-radius:6px;">
                    <select id="inventoryCategory" style="padding:10px;border:1px solid #ddd;border-radius:6px;">
                        <option value="">All Categories</option>
                        <option value="food">Food</option>
                        <option value="beer">Beer</option>
                        <option value="wine">Wine</option>
                        <option value="cocktails">Cocktails</option>
                        <option value="beverage">Beverages</option>
                        <option value="merch">Merchandise</option>
                    </select>
                </div>
                <div id="inventoryList"></div>
            </div>
        </div>
        
            </div><!-- end main-content -->
        </main>
    </div><!-- end admin-wrapper -->
    
    <!-- Mobile FAB for sidebar -->
    <button class="mobile-admin-toggle" id="mobileAdminToggle" onclick="toggleMobileSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Login Screen -->
    <div class="setup-container active" id="loginContainer">
        <div class="setup-card" style="max-width: 400px;">
            <div style="text-align: center; margin-bottom: 25px;">
                <img src="images/golfcovelogo.png" alt="Golf Cove" style="height: 50px; margin-bottom: 15px;">
                <h1 style="font-size: 22px;"><i class="fas fa-shield-alt"></i> Secure Admin Access</h1>
                <p style="color: #666; font-size: 14px; margin-top: 8px;">Sign in with your admin account</p>
            </div>
            <form id="loginForm" onsubmit="return handleLogin(event);">
                <div class="form-group" style="margin-bottom: 15px;">
                    <input type="email" id="adminEmail" required placeholder="Email Address" 
                           style="text-align: center; font-size: 16px;" autocomplete="email">
                </div>
                <div class="form-group">
                    <input type="password" id="adminPassword" required placeholder="Password" 
                           style="text-align: center; font-size: 16px; letter-spacing: 2px;" autocomplete="current-password">
                </div>
                <div id="loginError" style="color: #e53935; text-align: center; margin-bottom: 15px; display: none;">
                    <i class="fas fa-exclamation-circle"></i> <span id="loginErrorText">Invalid credentials</span>
                </div>
                <button type="submit" id="loginButton" class="btn btn-block">
                    <i class="fas fa-sign-in-alt"></i> Sign In Securely
                </button>
            </form>
            <a href="tournaments.html" class="back-link" style="display: block; text-align: center; margin-top: 20px; color: #37b24a; text-decoration: none;">
                <i class="fas fa-arrow-left"></i> Back to Standings
            </a>
        </div>
    </div>

    <!-- Setup Form (shown when no league exists) -->
    <div class="setup-container" id="setupContainer">
        <div class="setup-card">
            <h1><i class="fas fa-trophy"></i> Create League</h1>
            <form onsubmit="createLeague(event)">
                <div class="form-group">
                    <label>League Name</label>
                    <input type="text" id="leagueName" required placeholder="Golf Cove Fall League">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Holes</label>
                        <select id="holes">
                            <option value="9" selected>9 Holes</option>
                            <option value="18">18 Holes</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-block" style="margin-top: 10px;">
                    <i class="fas fa-check"></i> Create League
                </button>
            </form>
        </div>
    </div>

    <!-- Add Player Modal -->
    <div class="modal" id="addPlayerModal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3>Add Player to <span id="modalTeamName"></span></h3>
                <button class="close" onclick="closeModal('addPlayerModal')">&times;</button>
            </div>
            <form onsubmit="addPlayerToTeam(event)">
                <input type="hidden" id="addPlayerTeamId">
                <input type="hidden" id="addPlayerStripeId" required>
                
                <!-- Info Banner -->
                <div style="background: #e3f2fd; border: 1px solid #90caf9; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="font-size: 13px; color: #1565c0;">
                        <i class="fas fa-info-circle"></i> League players must be registered customers. Search below to find them.
                    </div>
                </div>
                
                <!-- Customer Search (Required) -->
                <div class="form-group" style="position: relative;">
                    <label><i class="fas fa-search"></i> Search Customers <span style="color: #e53935;">*</span></label>
                    <input type="text" id="playerCustomerSearch" placeholder="Type name or email to find customer..." autocomplete="off" style="margin-bottom: 0;" required>
                    <div id="playerCustomerResults" style="display:none; position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #ddd; border-top: none; border-radius: 0 0 8px 8px; max-height: 250px; overflow-y: auto; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>
                </div>
                
                <!-- Selected Customer Display -->
                <div id="selectedPlayerInfo" style="display: none; background: linear-gradient(135deg, #f5f5f5, #fff); border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 15px 0;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div id="selectedPlayerAvatar" style="width: 45px; height: 45px; border-radius: 50%; background: #4a90a4; color: #fff; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px;"></div>
                        <div style="flex: 1;">
                            <div style="font-weight: 700; font-size: 15px;" id="selectedPlayerName"></div>
                            <div style="font-size: 12px; color: #666;" id="selectedPlayerEmail"></div>
                            <div id="selectedPlayerBadges" style="margin-top: 4px;"></div>
                        </div>
                        <button type="button" onclick="clearSelectedPlayer()" style="background: none; border: none; color: #999; cursor: pointer; font-size: 18px;" title="Clear selection">&times;</button>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-block" id="addPlayerBtn" disabled style="opacity: 0.5;">
                    <i class="fas fa-plus"></i> Add Player to Team
                </button>
                
                <div style="text-align: center; margin-top: 12px;">
                    <a href="customers.html" target="_blank" style="font-size: 12px; color: #1976d2;">
                        <i class="fas fa-external-link-alt"></i> Need to add a new customer first?
                    </a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Team Modal -->
    <div class="modal" id="addTeamModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-users" style="color: #37b24a;"></i> Create New Team</h3>
                <button class="close" onclick="closeModal('addTeamModal')">&times;</button>
            </div>
            <form onsubmit="addTeam(event)">
                <div class="form-group">
                    <label>Team Name</label>
                    <input type="text" id="newTeamName" required placeholder="The Eagles">
                </div>
                
                <!-- Player 1 (Required) -->
                <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 10px; padding: 16px; margin-bottom: 16px;">
                    <div style="font-weight: 600; color: #37b24a; margin-bottom: 12px; font-size: 14px;">
                        <i class="fas fa-user"></i> Player 1 (Required)
                    </div>
                    <div class="form-group" style="position: relative; margin-bottom: 10px;">
                        <label>Search Customer</label>
                        <input type="text" id="teamPlayer1Search" placeholder="Search by name or email..." autocomplete="off">
                        <input type="hidden" id="teamPlayer1StripeId">
                        <div id="teamPlayer1Results" style="display:none; position:absolute; top:100%; left:0; right:0; background:#fff; border:1px solid #ddd; border-radius:8px; max-height:200px; overflow-y:auto; z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.15);"></div>
                    </div>
                    <div id="teamPlayer1Info" style="display: none; background: #fff; border: 1px solid #bbf7d0; border-radius: 8px; padding: 12px; margin-bottom: 10px;"></div>
                </div>
                
                <!-- Player 2 (Required) -->
                <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 10px; padding: 16px; margin-bottom: 16px;">
                    <div style="font-weight: 600; color: #0ea5e9; margin-bottom: 12px; font-size: 14px;">
                        <i class="fas fa-user"></i> Player 2 (Required)
                    </div>
                    <div class="form-group" style="position: relative; margin-bottom: 10px;">
                        <label>Search Customer</label>
                        <input type="text" id="teamPlayer2Search" placeholder="Search by name or email..." autocomplete="off">
                        <input type="hidden" id="teamPlayer2StripeId">
                        <div id="teamPlayer2Results" style="display:none; position:absolute; top:100%; left:0; right:0; background:#fff; border:1px solid #ddd; border-radius:8px; max-height:200px; overflow-y:auto; z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.15);"></div>
                    </div>
                    <div id="teamPlayer2Info" style="display: none; background: #fff; border: 1px solid #bae6fd; border-radius: 8px; padding: 12px; margin-bottom: 10px;"></div>
                </div>
                
                <div style="background: #fff3e0; border: 1px solid #ffcc02; border-radius: 10px; padding: 12px; margin-bottom: 16px;">
                    <div style="font-size: 12px; color: #e65100; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-info-circle"></i>
                        <span>Players must be existing customers. <a href="customers.html" target="_blank" style="color: #e65100; font-weight: 600;">Add new customer</a> if needed.</span>
                    </div>
                </div>
                
                <div style="background: #fefce8; border: 1px solid #fef08a; border-radius: 10px; padding: 16px; margin-bottom: 20px;">
                    <div style="font-weight: 600; color: #ca8a04; margin-bottom: 8px; font-size: 14px;"><i class="fas fa-key"></i> Team PIN</div>
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">This 4-digit PIN is required to access the team scorecard.</p>
                    <div class="form-group" style="margin-bottom: 0;">
                        <input type="text" id="newTeamPin" required placeholder="1234" maxlength="4" pattern="[0-9]{4}" inputmode="numeric" style="text-align: center; font-size: 20px; letter-spacing: 8px; font-weight: 700;">
                    </div>
                </div>
                
                <button type="submit" id="createTeamBtn" class="btn btn-block" disabled style="opacity: 0.5;"><i class="fas fa-plus"></i> Create Team</button>
            </form>
        </div>
    </div>

    <!-- Link Player Modal (for legacy unlinked players) -->
    <div class="modal" id="linkPlayerModal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3><i class="fas fa-link" style="color: #1976d2;"></i> Link Player to Customer</h3>
                <button class="close" onclick="closeModal('linkPlayerModal')">&times;</button>
            </div>
            <form onsubmit="linkPlayerToCustomer(event)">
                <input type="hidden" id="linkPlayerId">
                
                <div style="background: #fff3e0; border: 1px solid #ffcc02; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="font-size: 13px; color: #e65100;">
                        <i class="fas fa-exclamation-triangle"></i> This player was added before customer linking was required.
                        Link them to an existing Stripe customer to enable member benefits and sync.
                    </div>
                </div>
                
                <div style="background: #f5f5f5; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="font-weight: 600; font-size: 14px;"><i class="fas fa-user"></i> Player: <span id="linkPlayerName"></span></div>
                </div>
                
                <div class="form-group" style="position: relative;">
                    <label><i class="fas fa-search"></i> Search Customers</label>
                    <input type="text" id="linkCustomerSearch" placeholder="Type name or email..." autocomplete="off">
                    <div id="linkCustomerResults" style="display:none; position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #ddd; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>
                    <input type="hidden" id="linkCustomerStripeId">
                </div>
                
                <div id="linkSelectedCustomer" style="display: none; background: #e8f5e9; border: 1px solid #a5d6a7; border-radius: 8px; padding: 12px; margin-bottom: 15px;"></div>
                
                <button type="submit" class="btn btn-block" id="linkPlayerBtn" disabled style="opacity: 0.5;">
                    <i class="fas fa-link"></i> Link Player to Customer
                </button>
            </form>
        </div>
    </div>

    <!-- View Scores Modal -->
    <div class="modal" id="scoresModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="scoresModalTitle">Round Scores</h3>
                <button class="close" onclick="closeModal('scoresModal')">&times;</button>
            </div>
            <div id="scoresModalContent"></div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/league-admin.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
