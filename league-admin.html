<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>League Admin - Golf Cove</title>
    <link rel="icon" type="image/png" href="images/golfcovelogo.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        /* Admin Layout */
        .admin-wrapper {
            display: flex;
            min-height: calc(100vh - 120px);
        }
        
        /* Sidebar */
        .admin-sidebar {
            width: 260px;
            background: #fff;
            border-right: 1px solid #e0e0e0;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            height: calc(100vh - 120px);
            overflow-y: auto;
        }
        .admin-sidebar.mobile-open {
            display: block;
        }
        
        /* League Info in Sidebar */
        .league-info {
            padding: 25px 20px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, #37b24a 0%, #2d9440 100%);
            color: #fff;
        }
        .league-info h2 {
            font-size: 18px;
            margin-bottom: 4px;
        }
        .league-info .season {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Admin Sidebar Nav Menu */
        .admin-sidebar .admin-nav {
            padding: 15px 0;
        }
        .admin-sidebar .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
            border-left: 3px solid transparent;
        }
        .admin-sidebar .nav-item:hover {
            background: #f5f5f5;
            color: #333;
        }
        .admin-sidebar .nav-item.active {
            background: #e8f5e9;
            color: #37b24a;
            border-left-color: #37b24a;
        }
        .admin-sidebar .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 16px;
        }
        .admin-sidebar .nav-divider {
            height: 1px;
            background: #eee;
            margin: 10px 20px;
        }
        .nav-item.danger {
            color: #dc3545;
        }
        .nav-item.danger:hover {
            background: #fff5f5;
        }
        .nav-item.back-link {
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            color: #37b24a;
            font-weight: 600;
        }
        .nav-item.back-link:hover {
            background: #e8f5e9;
        }
        
        /* Main Content */
        .admin-main {
            flex: 1;
            background: #f5f5f5;
            min-height: calc(100vh - 120px);
        }
        .main-content {
            padding: 30px;
            max-width: 900px;
            margin: 0 auto;
        }
        
        /* Mobile sidebar toggle */
        .mobile-admin-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: #37b24a;
            color: #fff;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(55,178,74,0.4);
            z-index: 100;
        }
        .mobile-sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 150;
        }
        .mobile-sidebar-overlay.open {
            display: block;
        }
        
        /* Page Sections */
        .page-section {
            display: none;
            max-width: 800px;
            margin: 0 auto;
        }
        .page-section.active {
            display: block;
        }
        .page-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .page-title i {
            color: #37b24a;
        }
        
        /* Cards */
        .card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            padding: 20px;
            margin-bottom: 20px;
        }
        .card h3 {
            font-size: 15px;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .card h3 i {
            color: #37b24a;
        }
        
        /* Team Cards */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }
        .team-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #37b24a;
        }
        .team-card .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .team-card .team-name {
            font-weight: 700;
            font-size: 15px;
        }
        .team-card .delete-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 5px;
        }
        .team-card .delete-btn:hover {
            color: #dc3545;
        }
        .team-card .player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        .team-card .player:last-child {
            border-bottom: none;
        }
        .team-card .player-name {
            color: #333;
        }
        .team-card .player-meta {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .team-card .hcp {
            color: #888;
            font-size: 12px;
        }
        .team-card .pin {
            font-family: monospace;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
        }
        .team-card .add-player-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #fff;
            border: 2px dashed #ddd;
            border-radius: 8px;
            color: #666;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .team-card .add-player-btn:hover {
            border-color: #37b24a;
            color: #37b24a;
        }
        
        /* Add Team */
        .add-team-card {
            background: #fff;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
        }
        .add-team-card:hover {
            border-color: #37b24a;
            background: #f8fff9;
        }
        .add-team-card i {
            font-size: 32px;
            color: #ccc;
            margin-bottom: 10px;
        }
        .add-team-card:hover i {
            color: #37b24a;
        }
        
        /* QR Section */
        .qr-display {
            text-align: center;
            padding: 20px;
        }
        .qr-display #qrcode {
            display: inline-block;
            padding: 15px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        .qr-display #qrcode img {
            display: block;
        }
        .qr-display .url {
            font-family: monospace;
            font-size: 12px;
            color: #666;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 6px;
            word-break: break-all;
            margin: 15px 0;
        }
        
        /* Round Status */
        .round-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: linear-gradient(135deg, #37b24a, #2d9440);
            border-radius: 10px;
            color: #fff;
            margin-bottom: 20px;
        }
        .round-status h3 {
            font-size: 18px;
            margin-bottom: 4px;
            color: #fff;
        }
        .round-status p {
            opacity: 0.9;
            font-size: 14px;
        }
        .round-status .score-count {
            text-align: right;
        }
        .round-status .big {
            font-size: 32px;
            font-weight: 700;
        }
        .round-status .label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* Rounds List */
        .round-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .round-item h4 {
            font-size: 15px;
            margin-bottom: 2px;
        }
        .round-item p {
            font-size: 13px;
            color: #888;
        }
        .round-item .actions {
            display: flex;
            gap: 8px;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            background: #37b24a;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:hover { background: #2d9440; }
        .btn-sm { padding: 8px 14px; font-size: 13px; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .btn-outline {
            background: transparent;
            border: 2px solid #37b24a;
            color: #37b24a;
        }
        .btn-outline:hover {
            background: #37b24a;
            color: #fff;
        }
        .btn-block {
            width: 100%;
            justify-content: center;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin-bottom: 6px;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #37b24a;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        /* Print Options */
        .print-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .print-grid select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        /* Par Grid */
        .par-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 8px;
        }
        .par-grid .hole {
            text-align: center;
        }
        .par-grid label {
            display: block;
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
        }
        .par-grid input {
            width: 100%;
            padding: 10px 5px;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
        }
        .par-grid input:focus {
            outline: none;
            border-color: #37b24a;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        .modal.open { display: flex; }
        .modal-content {
            background: #fff;
            border-radius: 16px;
            padding: 25px;
            width: 90%;
            max-width: 450px;
            max-height: 85vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-header h3 {
            font-size: 18px;
        }
        .modal-header .close {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }
        .empty-state i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        /* Setup Form */
        .setup-container {
            max-width: 500px;
            margin: 60px auto;
            padding: 20px;
        }
        .setup-card {
            background: #fff;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .setup-card h1 {
            text-align: center;
            color: #37b24a;
            margin-bottom: 25px;
            font-size: 24px;
        }
        
        /* Desktop/Mobile */
        @media (min-width: 768px) {
            .admin-sidebar {
                display: block !important;
            }
            .mobile-admin-toggle {
                display: none !important;
            }
        }
        @media (max-width: 767px) {
            .admin-sidebar {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                z-index: 200;
                box-shadow: 4px 0 20px rgba(0,0,0,0.2);
            }
            .admin-sidebar.mobile-open {
                display: block;
            }
            .mobile-admin-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <a href="tel:2033905994"><i class="fas fa-phone"></i> 203.390.5994</a>
                <a href="https://maps.google.com/?q=336+State+Street,+North+Haven,+CT+06473" target="_blank"><i class="fas fa-map-marker-alt"></i> 336 STATE STREET, NORTH HAVEN, CT</a>
            </div>
            <div class="top-bar-right">
                <div class="social-links">
                    <a href="https://www.facebook.com/golfcove/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.instagram.com/golfcovect/" target="_blank"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-main">
            <div class="logo">
                <a href="index.html">
                    <img src="images/golfcovelogo.png" alt="Golf Cove Logo">
                </a>
            </div>
            <nav class="main-nav" id="mainNav">
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="pricing.html">Pricing</a></li>
                    <li><a href="lessons-leagues.html">Lessons & Leagues</a></li>
                    <li><a href="tournaments.html">Standings</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle Menu">
                <span></span><span></span><span></span>
            </button>
        </div>
    </header>

    <!-- Admin Layout -->
    <div class="admin-wrapper" id="adminWrapper" style="display: none;">
        <!-- Sidebar -->
        <aside class="admin-sidebar" id="adminSidebar">
            <div class="league-info">
                <h2 id="sidebarLeagueName">Golf Cove League</h2>
                <div class="season" id="sidebarSeason">Fall 2025</div>
            </div>
            <div class="admin-nav">
                <a href="tournaments.html" class="nav-item back-link">
                    <i class="fas fa-arrow-left"></i> View Leaderboard
                </a>
                <div class="nav-item active" data-section="dashboard" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="nav-item" data-section="teams" onclick="showSection('teams')">
                    <i class="fas fa-users"></i> Teams
                </div>
                <div class="nav-item" data-section="rounds" onclick="showSection('rounds')">
                    <i class="fas fa-flag"></i> Rounds
                </div>
                <div class="nav-item" data-section="print" onclick="showSection('print')">
                    <i class="fas fa-print"></i> Print
                </div>
                <div class="nav-divider"></div>
                <div class="nav-item" data-section="settings" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> Settings
                </div>
                <div class="nav-item danger" onclick="resetLeague()">
                    <i class="fas fa-trash"></i> Reset League
                </div>
            </div>
        </aside>
        
        <!-- Mobile overlay -->
        <div class="mobile-sidebar-overlay" id="mobileSidebarOverlay" onclick="toggleMobileSidebar()"></div>
        
        <!-- Main Content Area -->
        <main class="admin-main">
            <div class="main-content">
        
                <!-- Dashboard Section -->
                <div class="page-section active" id="section-dashboard">
                    <h1 class="page-title"><i class="fas fa-home"></i> Dashboard</h1>
            
            <div id="currentRoundStatus"></div>
            
            <div class="card">
                <h3><i class="fas fa-chart-bar"></i> Quick Stats</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #37b24a;" id="statTeams">0</div>
                        <div style="font-size: 13px; color: #888;">Teams</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #37b24a;" id="statPlayers">0</div>
                        <div style="font-size: 13px; color: #888;">Players</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #37b24a;" id="statRounds">0</div>
                        <div style="font-size: 13px; color: #888;">Rounds</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Teams Section -->
        <div class="page-section" id="section-teams">
            <h1 class="page-title"><i class="fas fa-users"></i> Teams</h1>
            <div class="team-grid" id="teamGrid"></div>
        </div>
        
        <!-- Rounds Section -->
        <div class="page-section" id="section-rounds">
            <h1 class="page-title"><i class="fas fa-flag"></i> Rounds</h1>
            
            <div class="card">
                <h3><i class="fas fa-plus-circle"></i> Add New Round</h3>
                <form onsubmit="addRound(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Round Name</label>
                            <input type="text" id="roundName" required placeholder="Week 1">
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="roundDate" required>
                        </div>
                    </div>
                    <button type="submit" class="btn"><i class="fas fa-plus"></i> Add Round</button>
                </form>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-list"></i> All Rounds</h3>
                <div id="roundsList"></div>
            </div>
        </div>
        
        <!-- Print Section -->
        <div class="page-section" id="section-print">
            <h1 class="page-title"><i class="fas fa-print"></i> Print</h1>
            
            <div class="card">
                <h3><i class="fas fa-id-card"></i> Print Scorecards</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Print blank scorecards for teams or generic use.</p>
                <div class="print-grid">
                    <select id="printTeamSelect" onchange="updatePrintPreview()">
                        <option value="">Select a Team</option>
                    </select>
                </div>
                <div id="printPreview" style="display:none; margin: 20px 0;">
                    <p style="font-size: 13px; color: #666; margin-bottom: 15px; text-align: center; font-weight: 600;">Scorecard Preview:</p>
                    <div id="scorecardPreviewContainer"></div>
                    <div id="teamQRPreview" style="display: none;"></div>
                </div>
                <button class="btn" onclick="printScorecards()" id="printBtn" disabled><i class="fas fa-print"></i> Print Scorecards</button>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-qrcode"></i> General Scoring Link</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">A general link for anyone to enter scores (useful for posting online).</p>
                <div id="generalQRCode" style="text-align: center; margin: 15px 0;"></div>
                <p style="text-align: center; font-size: 12px; color: #888; word-break: break-all;" id="generalQRUrl"></p>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                    <button class="btn btn-sm" onclick="copyGeneralUrl()"><i class="fas fa-copy"></i> Copy Link</button>
                </div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-key"></i> Print Player PINs</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Print a sheet with each player's personal PIN for score entry.</p>
                <button class="btn" onclick="printPinSheet()"><i class="fas fa-print"></i> Print PIN Sheet</button>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-download"></i> Export Data</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Download all league data as a JSON file.</p>
                <button class="btn btn-secondary" onclick="exportData()"><i class="fas fa-download"></i> Export JSON</button>
            </div>
        </div>
        
        <!-- Settings Section -->
        <div class="page-section" id="section-settings">
            <h1 class="page-title"><i class="fas fa-cog"></i> Settings</h1>
            
            <div class="card">
                <h3><i class="fas fa-golf-ball"></i> Course Pars</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Set the par for each hole.</p>
                <div id="parInputsContainer"></div>
                <button class="btn" onclick="savePars()" style="margin-top: 15px;"><i class="fas fa-check"></i> Save Pars</button>
            </div>
        </div>
        
            </div><!-- end main-content -->
        </main>
    </div><!-- end admin-wrapper -->
    
    <!-- Mobile FAB for sidebar -->
    <button class="mobile-admin-toggle" id="mobileAdminToggle" onclick="toggleMobileSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Password Screen -->
    <div class="setup-container" id="loginContainer">
        <div class="setup-card" style="max-width: 360px;">
            <div style="text-align: center; margin-bottom: 25px;">
                <img src="images/golfcovelogo.png" alt="Golf Cove" style="height: 50px; margin-bottom: 15px;">
                <h1 style="font-size: 22px;"><i class="fas fa-lock"></i> Admin Access</h1>
                <p style="color: #666; font-size: 14px; margin-top: 8px;">Enter password to continue</p>
            </div>
            <form onsubmit="checkPassword(event)">
                <div class="form-group">
                    <input type="password" id="adminPassword" required placeholder="Password" 
                           style="text-align: center; font-size: 18px; letter-spacing: 2px;">
                </div>
                <div id="loginError" style="color: #e53935; text-align: center; margin-bottom: 15px; display: none;">
                    <i class="fas fa-exclamation-circle"></i> Incorrect password
                </div>
                <button type="submit" class="btn btn-block">
                    <i class="fas fa-sign-in-alt"></i> Enter
                </button>
            </form>
            <a href="tournaments.html" class="back-link" style="display: block; text-align: center; margin-top: 20px; color: #37b24a; text-decoration: none;">
                <i class="fas fa-arrow-left"></i> Back to Standings
            </a>
        </div>
    </div>

    <!-- Setup Form (shown when no league exists) -->
    <div class="setup-container" id="setupContainer" style="display: none;">
        <div class="setup-card">
            <h1><i class="fas fa-trophy"></i> Create League</h1>
            <form onsubmit="createLeague(event)">
                <div class="form-group">
                    <label>League Name</label>
                    <input type="text" id="leagueName" required placeholder="Golf Cove Fall League">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Season</label>
                        <input type="text" id="season" required placeholder="Fall 2025">
                    </div>
                    <div class="form-group">
                        <label>Holes</label>
                        <select id="holes">
                            <option value="9">9 Holes</option>
                            <option value="18" selected>18 Holes</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Course Name</label>
                    <input type="text" id="courseName" required placeholder="Golf Cove">
                </div>
                <button type="submit" class="btn btn-block" style="margin-top: 10px;">
                    <i class="fas fa-check"></i> Create League
                </button>
            </form>
        </div>
    </div>

    <!-- Add Player Modal -->
    <div class="modal" id="addPlayerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Player to <span id="modalTeamName"></span></h3>
                <button class="close" onclick="closeModal('addPlayerModal')">&times;</button>
            </div>
            <form onsubmit="addPlayerToTeam(event)">
                <input type="hidden" id="addPlayerTeamId">
                <div class="form-group">
                    <label>Player Name</label>
                    <input type="text" id="addPlayerName" required placeholder="John Smith">
                </div>
                <div class="form-group">
                    <label>Handicap</label>
                    <input type="number" id="addPlayerHcp" value="0" min="0" max="54">
                </div>
                <button type="submit" class="btn btn-block"><i class="fas fa-plus"></i> Add Player</button>
            </form>
        </div>
    </div>
    
    <!-- Add Team Modal -->
    <div class="modal" id="addTeamModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Team</h3>
                <button class="close" onclick="closeModal('addTeamModal')">&times;</button>
            </div>
            <form onsubmit="addTeam(event)">
                <div class="form-group">
                    <label>Team Name</label>
                    <input type="text" id="newTeamName" required placeholder="Team Alpha">
                </div>
                <button type="submit" class="btn btn-block"><i class="fas fa-plus"></i> Create Team</button>
            </form>
        </div>
    </div>

    <!-- View Scores Modal -->
    <div class="modal" id="scoresModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="scoresModalTitle">Round Scores</h3>
                <button class="close" onclick="closeModal('scoresModal')">&times;</button>
            </div>
            <div id="scoresModalContent"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB8SH5Eh7OhIFLUkL2hjZS23uXkCsDJXGc",
            authDomain: "golfcove.firebaseapp.com",
            databaseURL: "https://golfcove-default-rtdb.firebaseio.com",
            projectId: "golfcove",
            storageBucket: "golfcove.firebasestorage.app",
            messagingSenderId: "284762891644",
            appId: "1:284762891644:web:424223b102f08a230f70f9"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const leagueRef = db.ref('league');
        
        let league = null;
        const ADMIN_PASSWORD = 'EJ';
        
        function generatePin() {
            // Generate unique 4-digit PIN
            const existingPins = new Set((league?.players || []).map(p => p.pin).filter(Boolean));
            let pin;
            let attempts = 0;
            do {
                pin = String(Math.floor(1000 + Math.random() * 9000));
                attempts++;
            } while (existingPins.has(pin) && attempts < 100);
            return pin;
        }
        
        function checkPassword(e) {
            e.preventDefault();
            const input = document.getElementById('adminPassword').value;
            if (input === ADMIN_PASSWORD) {
                sessionStorage.setItem('golfcove_admin_auth', 'true');
                document.getElementById('loginContainer').style.display = 'none';
                initAdmin();
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }
        
        function init() {
            // Check if already authenticated this session
            if (sessionStorage.getItem('golfcove_admin_auth') === 'true') {
                document.getElementById('loginContainer').style.display = 'none';
                initAdmin();
            } else {
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('adminPassword').focus();
            }
        }
        
        function initAdmin() {
            // Listen for real-time updates from Firebase
            leagueRef.on('value', (snapshot) => {
                league = snapshot.val();
                
                // Ensure arrays exist (Firebase returns undefined for empty arrays)
                if (league) {
                    league.teams = league.teams || [];
                    league.players = league.players || [];
                    league.rounds = league.rounds || [];
                    league.scores = league.scores || {};
                }
                
                // Migration for old data
                if (league && league.teams.length === 0) {
                    const teamNames = [...new Set(league.players.filter(p => p.team).map(p => p.team))];
                    teamNames.forEach(name => {
                        const teamId = 't' + Date.now() + Math.random().toString(36).substr(2, 5);
                        league.teams.push({ id: teamId, name });
                        league.players.forEach(p => {
                            if (p.team === name) p.teamId = teamId;
                        });
                    });
                    league.players.forEach(p => {
                        if (!p.pin) p.pin = generatePin();
                    });
                    save();
                }
                
                if (league) {
                    document.getElementById('setupContainer').style.display = 'none';
                    document.getElementById('adminWrapper').style.display = 'flex';
                    document.getElementById('mobileAdminToggle').style.display = '';
                    renderAll();
                } else {
                    document.getElementById('setupContainer').style.display = 'block';
                    document.getElementById('adminWrapper').style.display = 'none';
                    document.getElementById('mobileAdminToggle').style.display = 'none';
                }
            });
        }
        
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('adminSidebar');
            const overlay = document.getElementById('mobileSidebarOverlay');
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('open');
        }
        
        function createLeague(e) {
            e.preventDefault();
            const name = document.getElementById('leagueName').value.trim();
            const season = document.getElementById('season').value.trim();
            const courseName = document.getElementById('courseName').value.trim();
            const holes = parseInt(document.getElementById('holes').value);
            
            league = {
                id: 'league_' + Date.now(),
                name, season,
                course: { name: courseName, holes, pars: Array(holes).fill(4) },
                teams: [], players: [], rounds: [], scores: {},
                createdAt: new Date().toISOString()
            };
            save();
            initAdmin();
        }
        
        function renderAll() {
            document.getElementById('sidebarLeagueName').textContent = league.name;
            document.getElementById('sidebarSeason').textContent = league.season;
            document.getElementById('statTeams').textContent = league.teams.length;
            document.getElementById('statPlayers').textContent = league.players.length;
            document.getElementById('statRounds').textContent = league.rounds.length;
            
            document.getElementById('roundName').value = 'Week ' + (league.rounds.length + 1);
            document.getElementById('roundDate').valueAsDate = new Date();
            
            renderCurrentRound();
            renderTeams();
            renderRounds();
            renderPrintOptions();
            renderParInputs();
        }
        
        function renderCurrentRound() {
            const container = document.getElementById('currentRoundStatus');
            
            if (league.rounds.length === 0) {
                container.innerHTML = `
                    <div class="card">
                        <div class="empty-state">
                            <i class="fas fa-flag"></i>
                            <p>No rounds yet. Create your first round to get started.</p>
                            <button class="btn" onclick="showSection('rounds')" style="margin-top: 15px;">
                                <i class="fas fa-plus"></i> Add Round
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('qrCard').style.display = 'none';
                return;
            }
            
            const round = league.rounds[league.rounds.length - 1];
            const scored = league.players.filter(p => (league.scores || {})[round.id]?.[p.id]?.submitted).length;
            const total = league.players.length;
            
            container.innerHTML = `
                <div class="round-status">
                    <div>
                        <h3>${round.name}</h3>
                        <p>${new Date(round.date).toLocaleDateString()}</p>
                    </div>
                    <div class="score-count">
                        <div class="big">${scored}/${total}</div>
                        <div class="label">scores submitted</div>
                    </div>
                </div>
            `;
            
            // Update general QR code
            updateGeneralQR();
        }
        
        function updateGeneralQR() {
            const round = league.rounds[league.rounds.length - 1];
            if (!round) return;
            
            const url = window.location.origin + window.location.pathname.replace('league-admin.html', '') + 'score.html?r=' + round.id;
            document.getElementById('generalQRUrl').textContent = url;
            
            const qrContainer = document.getElementById('generalQRCode');
            qrContainer.innerHTML = '';
            new QRCode(qrContainer, {
                text: url,
                width: 120,
                height: 120,
                colorDark: '#333333',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.H
            });
        }
        
        function updatePrintPreview() {
            const teamId = document.getElementById('printTeamSelect').value;
            const preview = document.getElementById('printPreview');
            const btn = document.getElementById('printBtn');
            const previewContainer = document.getElementById('scorecardPreviewContainer');
            
            const round = league.rounds[league.rounds.length - 1];
            if (!round) {
                if (teamId) {
                    alert('Create a round first');
                    preview.style.display = 'none';
                    btn.disabled = true;
                }
                return;
            }
            
            // Show preview even when no team selected (blank preview)
            const isBlank = !teamId || teamId === 'blank';
            const team = (teamId && teamId !== 'blank') ? league.teams.find(t => t.id === teamId) : null;
            const holes = league.course?.holes || 18;
            const pars = league.course?.pars || Array(holes).fill(4);
            const frontNine = Math.min(9, holes);
            const has18 = holes >= 18;
            
            // Generate QR code for team (hidden, just for print function to access)
            let qrImg = '';
            if (!isBlank) {
                const url = window.location.origin + window.location.pathname.replace('league-admin.html', '') + 'score.html?r=' + round.id + '&t=' + teamId;
                const qrContainer = document.getElementById('teamQRPreview');
                qrContainer.innerHTML = '';
                new QRCode(qrContainer, {
                    text: url,
                    width: 100,
                    height: 100,
                    colorDark: '#333333',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                });
                // Wait a moment for QR to render, then get the image
                setTimeout(() => {
                    qrImg = document.querySelector('#teamQRPreview img')?.src || '';
                }, 100);
            }
            
            // Build scorecard preview HTML
            let frontPars = '', backPars = '', frontTotal = 0, backTotal = 0;
            
            if (isBlank) {
                // For blank scorecards, show empty par cells
                for (let h = 0; h < frontNine; h++) { 
                    frontPars += `<td></td>`; 
                }
                if (has18) {
                    for (let h = 9; h < holes; h++) { 
                        backPars += `<td></td>`; 
                    }
                }
                frontTotal = '';
                backTotal = '';
            } else {
                // For team scorecards, show actual pars
                for (let h = 0; h < frontNine; h++) { 
                    frontPars += `<td>${pars[h]}</td>`; 
                    frontTotal += pars[h]; 
                }
                if (has18) {
                    for (let h = 9; h < holes; h++) { 
                        backPars += `<td>${pars[h]}</td>`; 
                        backTotal += pars[h]; 
                    }
                }
            }
            
            const headerText = isBlank 
                ? `<h1>⛳ ${league.course?.name || 'Golf Cove'}</h1><h2>${league.name}</h2><p>Round • Date</p>`
                : `<h1>⛳ ${league.course?.name || 'Golf Cove'}</h1><h2>${league.name} - ${team.name}</h2><p>${round.name} • ${new Date(round.date).toLocaleDateString()}</p>`;
            
            const qrSection = !isBlank ? `<div class="qr"><div style="width: 90px; height: 90px; background: #e0e0e0; border: 2px solid #ddd; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #999;">QR Code</div><span>Scan to enter score</span></div>` : '';
            
            const totalPar = isBlank ? '' : (frontTotal + backTotal);
            
            previewContainer.innerHTML = `
                <style>
                    #scorecardPreviewContainer .scorecard {
                        background: #fff;
                        border-radius: 12px;
                        padding: 30px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        max-width: 800px;
                        margin: 0 auto;
                    }
                    #scorecardPreviewContainer .header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding-bottom: 20px;
                        margin-bottom: 20px;
                        border-bottom: 4px solid #37b24a;
                    }
                    #scorecardPreviewContainer .header .left h1 {
                        color: #37b24a;
                        font-size: 24px;
                        font-weight: 700;
                        margin: 0 0 4px 0;
                    }
                    #scorecardPreviewContainer .header .left h2 {
                        font-size: 16px;
                        font-weight: 600;
                        color: #333;
                        margin: 0 0 4px 0;
                    }
                    #scorecardPreviewContainer .header .left p {
                        color: #666;
                        font-size: 13px;
                        margin: 0;
                    }
                    #scorecardPreviewContainer .header .qr {
                        text-align: center;
                        background: #f8f8f8;
                        padding: 12px;
                        border-radius: 8px;
                    }
                    #scorecardPreviewContainer .header .qr span {
                        display: block;
                        font-size: 10px;
                        color: #666;
                        margin-top: 6px;
                        font-weight: 600;
                    }
                    #scorecardPreviewContainer .info {
                        display: flex;
                        gap: 40px;
                        margin-bottom: 20px;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 8px;
                    }
                    #scorecardPreviewContainer .info .field {
                        font-size: 14px;
                        color: #333;
                    }
                    #scorecardPreviewContainer .info .field b {
                        color: #666;
                        font-weight: 600;
                        margin-right: 6px;
                    }
                    #scorecardPreviewContainer table {
                        width: 100%;
                        border-collapse: separate;
                        border-spacing: 0;
                        margin-bottom: 20px;
                        border-radius: 8px;
                        overflow: hidden;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                    }
                    #scorecardPreviewContainer th, #scorecardPreviewContainer td {
                        padding: 10px 6px;
                        text-align: center;
                        border: 1px solid #ddd;
                        font-size: 12px;
                    }
                    #scorecardPreviewContainer th {
                        background: linear-gradient(135deg, #37b24a 0%, #2d9440 100%);
                        color: #fff;
                        font-weight: 700;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    #scorecardPreviewContainer .label {
                        background: #1a1a2e !important;
                        color: #fff;
                        font-weight: 700;
                        width: 55px;
                    }
                    #scorecardPreviewContainer .sub {
                        background: #e3f2e6;
                        font-weight: 700;
                        color: #2d9440;
                    }
                    #scorecardPreviewContainer .tot {
                        background: #d4ecd8;
                        font-weight: 700;
                        color: #1a6b2e;
                    }
                    #scorecardPreviewContainer .net {
                        background: linear-gradient(135deg, #37b24a 0%, #2d9440 100%);
                        color: #fff;
                        font-weight: 700;
                    }
                    #scorecardPreviewContainer .par td {
                        background: #f8f9fa;
                        font-weight: 600;
                        color: #555;
                    }
                    #scorecardPreviewContainer .par .label {
                        background: #666 !important;
                        color: #fff;
                    }
                    #scorecardPreviewContainer .score td {
                        height: 35px;
                        background: #fff;
                        font-weight: 600;
                        color: #333;
                    }
                    #scorecardPreviewContainer .footer {
                        display: flex;
                        gap: 50px;
                        padding-top: 15px;
                        border-top: 2px solid #e0e0e0;
                        font-size: 12px;
                        color: #666;
                    }
                    #scorecardPreviewContainer .footer b {
                        color: #333;
                        margin-right: 8px;
                    }
                </style>
                <div class="scorecard">
                    <div class="header"><div class="left">${headerText}</div>${qrSection}</div>
                    <div class="info"><div class="field"><b>Player:</b> ________________________</div><div class="field"><b>HCP:</b> ______</div><div class="field"><b>PIN:</b> ______</div></div>
                    <table><thead><tr><th class="label">HOLE</th>${Array.from({length:frontNine},(_,i)=>`<th>${i+1}</th>`).join('')}<th class="sub">OUT</th>${has18?Array.from({length:holes-9},(_,i)=>`<th>${i+10}</th>`).join(''):''}${has18?'<th class="sub">IN</th>':''}<th class="tot">TOT</th><th class="tot">HCP</th><th class="net">NET</th></tr></thead>
                    <tbody><tr class="par"><td class="label">PAR</td>${frontPars}<td class="sub">${frontTotal}</td>${has18?backPars:''}${has18?`<td class="sub">${backTotal}</td>`:''}<td class="tot">${totalPar}</td><td class="tot"></td><td class="net"></td></tr>
                    <tr class="score"><td class="label">SCORE</td>${Array.from({length:frontNine},()=>'<td></td>').join('')}<td class="sub"></td>${has18?Array.from({length:holes-9},()=>'<td></td>').join(''):''}${has18?'<td class="sub"></td>':''}<td class="tot"></td><td class="tot"></td><td class="net"></td></tr></tbody></table>
                    <div class="footer"><div><b>Scorer:</b> ____________</div><div><b>Attest:</b> ____________</div><div><b>Date:</b> ________</div></div>
                </div>
            `;
            
            preview.style.display = 'block';
            btn.disabled = false; // Enable button for both blank and team scorecards
        }
        
        function copyGeneralUrl() {
            const url = document.getElementById('generalQRUrl').textContent;
            navigator.clipboard.writeText(url);
            alert('Link copied!');
        }
        
        function renderTeams() {
            const container = document.getElementById('teamGrid');
            
            let html = league.teams.map(team => {
                const players = league.players.filter(p => p.teamId === team.id);
                return `
                    <div class="team-card">
                        <div class="team-header">
                            <span class="team-name">${team.name}</span>
                            <button class="delete-btn" onclick="deleteTeam('${team.id}')"><i class="fas fa-times"></i></button>
                        </div>
                        ${players.length === 0 ? '<p style="color: #999; font-size: 13px;">No players yet</p>' : 
                            players.map(p => `
                                <div class="player">
                                    <span class="player-name">${p.name}</span>
                                    <div class="player-meta">
                                        <span class="hcp">HCP ${p.handicap}</span>
                                        <span class="pin">${p.pin}</span>
                                        <button class="delete-btn" onclick="deletePlayer('${p.id}')"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            `).join('')
                        }
                        <button class="add-player-btn" onclick="openAddPlayerModal('${team.id}', '${team.name.replace(/'/g, "\\'")}')">
                            <i class="fas fa-plus"></i> Add Player
                        </button>
                    </div>
                `;
            }).join('');
            
            html += `
                <div class="add-team-card" onclick="openModal('addTeamModal')">
                    <i class="fas fa-plus"></i>
                    <span style="color: #888;">Add Team</span>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function renderRounds() {
            const container = document.getElementById('roundsList');
            
            if (league.rounds.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-flag"></i><p>No rounds yet</p></div>';
                return;
            }
            
            container.innerHTML = league.rounds.slice().reverse().map(r => {
                const scored = league.players.filter(p => (league.scores || {})[r.id]?.[p.id]?.submitted).length;
                return `
                    <div class="round-item">
                        <div>
                            <h4>${r.name}</h4>
                            <p>${new Date(r.date).toLocaleDateString()} • ${scored}/${league.players.length} scores</p>
                        </div>
                        <div class="actions">
                            <button class="btn btn-sm btn-secondary" onclick="viewRoundScores('${r.id}')"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-sm btn-danger" onclick="deleteRound('${r.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderPrintOptions() {
            const select = document.getElementById('printTeamSelect');
            select.innerHTML = '<option value="">Select a Team</option>' + 
                league.teams.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            
            // Show blank preview by default
            updatePrintPreview();
        }
        
        function renderParInputs() {
            const container = document.getElementById('parInputsContainer');
            const holes = league.course?.holes || 18;
            const pars = league.course?.pars || Array(holes).fill(4);
            
            let html = '<div class="par-grid">';
            for (let i = 0; i < Math.min(9, holes); i++) {
                html += `<div class="hole"><label>H${i + 1}</label><input type="number" min="3" max="6" value="${pars[i]}" id="par${i}"></div>`;
            }
            html += '</div>';
            
            if (holes > 9) {
                html += '<div class="par-grid" style="margin-top: 15px;">';
                for (let i = 9; i < holes; i++) {
                    html += `<div class="hole"><label>H${i + 1}</label><input type="number" min="3" max="6" value="${pars[i]}" id="par${i}"></div>`;
                }
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        // Navigation
        function toggleSidebar() {
            document.getElementById('adminSidebar').classList.toggle('mobile-open');
        }
        
        function showSection(section) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById('section-' + section).classList.add('active');
            document.querySelector(`[data-section="${section}"]`).classList.add('active');
            
            // Close sidebar on mobile
            document.getElementById('adminSidebar').classList.remove('mobile-open');
            document.getElementById('mobileSidebarOverlay').classList.remove('open');
        }
        
        // Teams
        function addTeam(e) {
            e.preventDefault();
            const name = document.getElementById('newTeamName').value.trim();
            if (!name) return;
            
            league.teams.push({ id: 't' + Date.now() + Math.random().toString(36).substr(2, 5), name });
            document.getElementById('newTeamName').value = '';
            save();
            closeModal('addTeamModal');
            renderAll();
        }
        
        function deleteTeam(id) {
            if (!confirm('Delete this team?')) return;
            league.players.forEach(p => { if (p.teamId === id) p.teamId = null; });
            league.teams = league.teams.filter(t => t.id !== id);
            save();
            renderAll();
        }
        
        // Players
        function openAddPlayerModal(teamId, teamName) {
            document.getElementById('addPlayerTeamId').value = teamId;
            document.getElementById('modalTeamName').textContent = teamName;
            document.getElementById('addPlayerName').value = '';
            document.getElementById('addPlayerHcp').value = '0';
            openModal('addPlayerModal');
        }
        
        function addPlayerToTeam(e) {
            e.preventDefault();
            const teamId = document.getElementById('addPlayerTeamId').value;
            const name = document.getElementById('addPlayerName').value.trim();
            const handicap = parseInt(document.getElementById('addPlayerHcp').value) || 0;
            
            if (!name) return;
            
            league.players.push({
                id: 'p' + Date.now() + Math.random().toString(36).substr(2, 5),
                name, teamId, handicap,
                pin: generatePin()
            });
            save();
            closeModal('addPlayerModal');
            renderAll();
        }
        
        function deletePlayer(id) {
            if (!confirm('Remove this player?')) return;
            league.players = league.players.filter(p => p.id !== id);
            save();
            renderAll();
        }
        
        // Rounds
        function addRound(e) {
            e.preventDefault();
            const name = document.getElementById('roundName').value.trim();
            const date = document.getElementById('roundDate').value;
            
            league.rounds.push({
                id: 'r' + Date.now() + Math.random().toString(36).substr(2, 5),
                name, date,
                createdAt: new Date().toISOString()
            });
            save();
            renderAll();
        }
        
        function deleteRound(id) {
            if (!confirm('Delete this round and all scores?')) return;
            league.rounds = league.rounds.filter(r => r.id !== id);
            if (league.scores) delete league.scores[id];
            save();
            renderAll();
        }
        
        function viewRoundScores(roundId) {
            const round = league.rounds.find(r => r.id === roundId);
            if (!round) return;
            
            document.getElementById('scoresModalTitle').textContent = round.name + ' Scores';
            
            const holes = league.course?.holes || 18;
            const scores = league.players.map(p => {
                const ps = (league.scores || {})[roundId]?.[p.id];
                const handicap = p.handicap || 0;
                if (!ps || !ps.submitted) return { name: p.name, handicap, gross: null };
                let gross = 0;
                let holesPlayed = 0;
                for (let h = 1; h <= holes; h++) {
                    if (ps[h] && ps[h] > 0) {
                        gross += ps[h];
                        holesPlayed++;
                    }
                }
                return { name: p.name, handicap, gross, net: gross - handicap, holesPlayed };
            }).sort((a, b) => {
                if (a.gross === null) return 1;
                if (b.gross === null) return -1;
                return a.net - b.net;
            });
            
            document.getElementById('scoresModalContent').innerHTML = scores.map(s => `
                <div class="round-item">
                    <div>
                        <h4>${s.name}</h4>
                        <p>HCP ${s.handicap}</p>
                    </div>
                    ${s.gross !== null ? `
                        <div style="text-align: right;">
                            <div style="font-size: 18px; font-weight: 700; color: #37b24a;">${s.gross}${s.holesPlayed < holes ? ` <span style="font-size:12px;color:#888">(${s.holesPlayed}h)</span>` : ''}</div>
                            <div style="font-size: 12px; color: #888;">Net: ${s.net}</div>
                        </div>
                    ` : '<span style="color: #999;">No score</span>'}
                </div>
            `).join('');
            
            openModal('scoresModal');
        }
        
        // Settings
        function savePars() {
            const holes = league.course?.holes || 18;
            const pars = [];
            for (let i = 0; i < holes; i++) {
                pars.push(parseInt(document.getElementById('par' + i).value) || 4);
            }
            league.course.pars = pars;
            save();
            alert('Pars saved!');
        }
        
        // QR & URLs
        function copyUrl() {
            navigator.clipboard.writeText(document.getElementById('scoringUrl').textContent);
            alert('Link copied!');
        }
        
        function printQR() {
            const round = league.rounds[league.rounds.length - 1];
            const url = document.getElementById('scoringUrl').textContent;
            const qrImg = document.querySelector('#qrcode img')?.src || '';
            
            const w = window.open('', '_blank');
            w.document.write(`
                <!DOCTYPE html><html><head><title>QR Code</title>
                <style>body{font-family:Arial;text-align:center;padding:40px;}h1{color:#37b24a;}</style>
                </head><body>
                <h1>⛳ ${league.name}</h1>
                <h2>${round.name} - ${new Date(round.date).toLocaleDateString()}</h2>
                <img src="${qrImg}" width="250" height="250" style="margin:30px;">
                <p>Scan to enter your score</p>
                <p style="font-family:monospace;background:#f5f5f5;padding:10px;border-radius:5px;">${url}</p>
                </body></html>
            `);
            w.document.close();
            setTimeout(() => w.print(), 250);
        }
        
        // Print Functions
        function printPinSheet() {
            if (league.players.length === 0) { alert('No players'); return; }
            const w = window.open('', '_blank');
            w.document.write(`
                <!DOCTYPE html><html><head><title>Player PINs</title>
                <style>body{font-family:Arial;padding:30px;}h1{color:#37b24a;}table{width:100%;border-collapse:collapse;}th,td{padding:10px 15px;text-align:left;border-bottom:1px solid #ddd;}th{background:#f5f5f5;}.pin{font-family:monospace;font-size:18px;font-weight:bold;}</style>
                </head><body>
                <h1>⛳ ${league.name}</h1>
                <h2>Player PINs</h2>
                <table><tr><th>Player</th><th>Team</th><th>PIN</th></tr>
                ${league.players.map(p => {
                    const team = league.teams.find(t => t.id === p.teamId);
                    return `<tr><td>${p.name}</td><td>${team?.name || '-'}</td><td class="pin">${p.pin}</td></tr>`;
                }).join('')}
                </table>
                </body></html>
            `);
            w.document.close();
            setTimeout(() => w.print(), 250);
        }
        
        function printScorecards() {
            const teamId = document.getElementById('printTeamSelect').value;
            
            if (league.rounds.length === 0) { alert('Create a round first'); return; }
            
            const round = league.rounds[league.rounds.length - 1];
            const isBlank = !teamId;
            const team = teamId ? league.teams.find(t => t.id === teamId) : null;
            const holes = league.course?.holes || 18;
            const pars = league.course?.pars || Array(holes).fill(4);
            const frontNine = Math.min(9, holes);
            const has18 = holes >= 18;
            
            // Get the team-specific QR code (empty for blank cards)
            const qrImg = isBlank ? '' : (document.querySelector('#teamQRPreview img')?.src || '');
            
            const players = isBlank ? [] : league.players.filter(p => p.teamId === teamId);
            
            // Print enough blank scorecards for the team (or 5 for blank option)
            const cardCount = isBlank ? 5 : Math.max(players.length, 5);
            
            const buildCard = () => {
                let frontPars = '', backPars = '', frontTotal = 0, backTotal = 0;
                for (let h = 0; h < frontNine; h++) { frontPars += `<td>${pars[h]}</td>`; frontTotal += pars[h]; }
                if (has18) for (let h = 9; h < holes; h++) { backPars += `<td>${pars[h]}</td>`; backTotal += pars[h]; }
                
                const headerText = isBlank 
                    ? `<h1>⛳ ${league.course?.name || 'Golf Cove'}</h1><h2>${league.name}</h2><p>${round.name} • ${new Date(round.date).toLocaleDateString()}</p>`
                    : `<h1>⛳ ${league.course?.name || 'Golf Cove'}</h1><h2>${league.name} - ${team.name}</h2><p>${round.name} • ${new Date(round.date).toLocaleDateString()}</p>`;
                
                const qrSection = qrImg ? `<div class="qr"><img src="${qrImg}"><span>Scan to enter score</span></div>` : '';
                
                return `
                    <div class="scorecard">
                        <div class="header"><div class="left">${headerText}</div>${qrSection}</div>
                        <div class="info"><div class="field"><b>Player:</b> ________________________</div><div class="field"><b>HCP:</b> ______</div><div class="field"><b>PIN:</b> ______</div></div>
                        <table><thead><tr><th class="label">HOLE</th>${Array.from({length:frontNine},(_,i)=>`<th>${i+1}</th>`).join('')}<th class="sub">OUT</th>${has18?Array.from({length:holes-9},(_,i)=>`<th>${i+10}</th>`).join(''):''}${has18?'<th class="sub">IN</th>':''}<th class="tot">TOT</th><th class="tot">HCP</th><th class="net">NET</th></tr></thead>
                        <tbody><tr class="par"><td class="label">PAR</td>${frontPars}<td class="sub">${frontTotal}</td>${has18?backPars:''}${has18?`<td class="sub">${backTotal}</td>`:''}<td class="tot">${frontTotal+backTotal}</td><td class="tot"></td><td class="net"></td></tr>
                        <tr class="score"><td class="label">SCORE</td>${Array.from({length:frontNine},()=>'<td></td>').join('')}<td class="sub"></td>${has18?Array.from({length:holes-9},()=>'<td></td>').join(''):''}${has18?'<td class="sub"></td>':''}<td class="tot"></td><td class="tot"></td><td class="net"></td></tr></tbody></table>
                        <div class="footer"><div><b>Scorer:</b> ____________</div><div><b>Attest:</b> ____________</div><div><b>Date:</b> ________</div></div>
                    </div>
                `;
            };
            
            const w = window.open('', '_blank');
            const title = isBlank ? 'Blank Scorecards' : `Blank Scorecards - ${team.name}`;
            w.document.write(`
                <!DOCTYPE html><html><head><title>${title}</title>
                <style>
                    * {
                        margin: 0;
                        padding: 0;
                        box-sizing: border-box;
                    }
                    body {
                        font-family: 'Arial', sans-serif;
                        padding: 20px;
                        background: #f5f5f5;
                    }
                    .scorecard {
                        background: #fff;
                        border: none;
                        border-radius: 12px;
                        padding: 30px;
                        margin-bottom: 30px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        page-break-inside: avoid;
                    }
                    .header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding-bottom: 20px;
                        margin-bottom: 20px;
                        border-bottom: 4px solid #37b24a;
                    }
                    .header .left h1 {
                        color: #37b24a;
                        font-size: 28px;
                        font-weight: 700;
                        margin-bottom: 4px;
                    }
                    .header .left h2 {
                        font-size: 18px;
                        font-weight: 600;
                        color: #333;
                        margin-bottom: 4px;
                    }
                    .header .left p {
                        color: #666;
                        font-size: 14px;
                    }
                    .header .qr {
                        text-align: center;
                        background: #f8f8f8;
                        padding: 12px;
                        border-radius: 8px;
                    }
                    .header .qr img {
                        width: 90px;
                        height: 90px;
                        border: 2px solid #ddd;
                        border-radius: 6px;
                    }
                    .header .qr span {
                        display: block;
                        font-size: 10px;
                        color: #666;
                        margin-top: 6px;
                        font-weight: 600;
                    }
                    .info {
                        display: flex;
                        gap: 40px;
                        margin-bottom: 20px;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 8px;
                    }
                    .info .field {
                        font-size: 14px;
                        color: #333;
                    }
                    .info .field b {
                        color: #666;
                        font-weight: 600;
                        margin-right: 6px;
                    }
                    table {
                        width: 100%;
                        border-collapse: separate;
                        border-spacing: 0;
                        margin-bottom: 20px;
                        border-radius: 8px;
                        overflow: hidden;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                    }
                    th, td {
                        padding: 10px 6px;
                        text-align: center;
                        border: 1px solid #ddd;
                        font-size: 12px;
                    }
                    th {
                        background: linear-gradient(135deg, #37b24a 0%, #2d9440 100%);
                        color: #fff;
                        font-weight: 700;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    .label {
                        background: #1a1a2e !important;
                        color: #fff;
                        font-weight: 700;
                        width: 55px;
                    }
                    .sub {
                        background: #e3f2e6;
                        font-weight: 700;
                        color: #2d9440;
                    }
                    .tot {
                        background: #d4ecd8;
                        font-weight: 700;
                        color: #1a6b2e;
                    }
                    .net {
                        background: linear-gradient(135deg, #37b24a 0%, #2d9440 100%);
                        color: #fff;
                        font-weight: 700;
                    }
                    .par td {
                        background: #f8f9fa;
                        font-weight: 600;
                        color: #555;
                    }
                    .par .label {
                        background: #666 !important;
                        color: #fff;
                    }
                    .score td {
                        height: 35px;
                        background: #fff;
                        font-weight: 600;
                        color: #333;
                    }
                    .footer {
                        display: flex;
                        gap: 50px;
                        padding-top: 15px;
                        border-top: 2px solid #e0e0e0;
                        font-size: 12px;
                        color: #666;
                    }
                    .footer b {
                        color: #333;
                        margin-right: 8px;
                    }
                    @media print {
                        body {
                            background: #fff;
                        }
                        .scorecard {
                            page-break-after: always;
                            box-shadow: none;
                        }
                        .scorecard:last-child {
                            page-break-after: auto;
                        }
                    }
                </style></head><body>${Array.from({length: cardCount}, () => buildCard()).join('')}</body></html>
            `);
            w.document.close();
            setTimeout(() => w.print(), 300);
        }
        
        function exportData() {
            const blob = new Blob([JSON.stringify(league, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = league.name.replace(/\s+/g, '_') + '_export.json';
            a.click();
        }
        
        function resetLeague() {
            if (!confirm('Delete the entire league? This cannot be undone!')) return;
            if (!confirm('Are you absolutely sure?')) return;
            leagueRef.remove();
            league = null;
        }
        
        // Modal helpers
        function openModal(id) { document.getElementById(id).classList.add('open'); }
        function closeModal(id) { document.getElementById(id).classList.remove('open'); }
        
        function save() { 
            leagueRef.set(league);
        }
        
        init();
    </script>
    <script src="js/main.js"></script>
</body>
</html>

