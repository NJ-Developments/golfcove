<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Cove - POS System</title>
    <link rel="icon" type="image/png" href="images/golfCoveLogo6.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://js.stripe.com/terminal/v1/"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f0f2f5; min-height: 100vh; }
        
        /* Header - foreUP style */
        .header { background: #4a90a4; color: #fff; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; }
        .header-left { display: flex; align-items: center; gap: 20px; }
        .header-logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 18px; }
        .header-logo img { height: 35px; }
        .header-nav { display: flex; gap: 5px; }
        .header-nav a { color: #fff; text-decoration: none; padding: 8px 16px; border-radius: 4px; font-size: 14px; transition: background 0.2s; }
        .header-nav a:hover, .header-nav a.active { background: rgba(255,255,255,0.2); }
        .header-stats { display: flex; gap: 25px; font-size: 13px; }
        .header-stat { text-align: center; }
        .header-stat .value { font-size: 18px; font-weight: 700; }
        .header-stat .label { opacity: 0.8; font-size: 11px; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .header-user { display: flex; align-items: center; gap: 8px; }

        /* Sub-header */
        .sub-header { background: #fff; border-bottom: 1px solid #ddd; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; }
        .sub-header-left { display: flex; align-items: center; gap: 15px; }
        .date-nav { display: flex; align-items: center; gap: 10px; }
        .date-nav button { background: #4a90a4; color: #fff; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 13px; }
        .date-nav button:hover { background: #3d7a8a; }
        .date-display { font-size: 18px; font-weight: 600; }
        .weather { display: flex; align-items: center; gap: 8px; color: #666; }
        .sub-header-right { display: flex; gap: 10px; }
        .sub-header-right button { background: #fff; border: 1px solid #ddd; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 13px; }
        .sub-header-right button:hover { background: #f5f5f5; }

        /* Main Layout */
        .main-layout { display: flex; height: calc(100vh - 110px); }
        
        /* Sidebar */
        .sidebar { width: 220px; background: #fff; border-right: 1px solid #ddd; padding: 15px; overflow-y: auto; }
        .sidebar-section { margin-bottom: 20px; }
        .sidebar-title { font-size: 12px; color: #666; text-transform: uppercase; margin-bottom: 10px; font-weight: 600; }
        .search-box { position: relative; margin-bottom: 15px; }
        .search-box input { width: 100%; padding: 10px 10px 10px 35px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; }
        .search-box i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999; }
        .sidebar-btn { display: flex; align-items: center; gap: 10px; width: 100%; padding: 10px 12px; background: #f8f9fa; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; margin-bottom: 5px; color: #333; transition: all 0.2s; }
        .sidebar-btn:hover { background: #e9ecef; }
        .sidebar-btn.active { background: #4a90a4; color: #fff; }
        .sidebar-btn i { width: 18px; }
        
        /* Calendar */
        .mini-calendar { background: #f8f9fa; border-radius: 8px; padding: 10px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: 600; font-size: 13px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; text-align: center; font-size: 11px; }
        .calendar-day { padding: 5px; border-radius: 4px; cursor: pointer; }
        .calendar-day:hover { background: #e9ecef; }
        .calendar-day.today { background: #4a90a4; color: #fff; }
        .calendar-day.header { font-weight: 600; color: #666; }

        /* Tee Sheet Content */
        .content { flex: 1; overflow: auto; padding: 20px; background: #f0f2f5; }
        
        /* Room/Bay Columns */
        .rooms-container { display: flex; gap: 15px; min-width: max-content; }
        .room-column { background: #fff; border-radius: 8px; width: 280px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .room-header { background: #2c3e50; color: #fff; padding: 12px 15px; border-radius: 8px 8px 0 0; display: flex; align-items: center; gap: 10px; }
        .room-header .status-dot { width: 10px; height: 10px; border-radius: 50%; background: #27ae60; }
        .room-header h3 { font-size: 15px; font-weight: 600; }
        .room-slots { padding: 10px; }
        
        /* Time Slots */
        .time-slot { display: flex; align-items: stretch; margin-bottom: 2px; min-height: 45px; }
        .time-label { width: 70px; padding: 8px 10px; font-size: 12px; color: #666; display: flex; align-items: center; }
        .slot-content { flex: 1; background: #f8f9fa; border-radius: 6px; margin: 2px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
        .slot-content:hover { border-color: #4a90a4; }
        .slot-content.booked { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: #fff; justify-content: flex-start; padding: 8px 12px; }
        .slot-content.booked.checked-in { background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%); }
        .slot-content.booked .booking-info { display: flex; flex-direction: column; }
        .slot-content.booked .customer-name { font-weight: 600; font-size: 13px; }
        .slot-content.booked .booking-details { font-size: 11px; opacity: 0.9; }
        .slot-content.available { background: #e8f5e9; border: 1px dashed #81c784; }
        .slot-content .player-count { background: rgba(255,255,255,0.3); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: auto; }

        /* Food & Beverage Floor Plan */
        .fnb-container { padding: 20px; }
        .fnb-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .fnb-tab { padding: 10px 20px; background: #fff; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .fnb-tab.active { background: #4a90a4; color: #fff; border-color: #4a90a4; }
        .floor-plan { background: #fff; border-radius: 8px; padding: 30px; min-height: 500px; position: relative; }
        .table-item { position: absolute; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .table-item:hover { transform: scale(1.05); }
        .table-item.circle { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #666; background: #fff; }
        .table-item.rectangle { width: 80px; height: 50px; border-radius: 8px; border: 2px solid #666; background: #fff; }
        .table-item.diamond { width: 60px; height: 60px; border: 2px solid #666; background: #fff; transform: rotate(45deg); }
        .table-item.diamond span { transform: rotate(-45deg); }
        .table-item.active { background: #3498db; border-color: #3498db; color: #fff; }
        .table-item span { font-size: 12px; font-weight: 600; }

        /* Tabs List */
        .tabs-list { background: #fff; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .tabs-list h3 { margin-bottom: 15px; font-size: 16px; display: flex; align-items: center; gap: 10px; }
        .tabs-table { width: 100%; border-collapse: collapse; }
        .tabs-table th, .tabs-table td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; font-size: 13px; }
        .tabs-table th { font-weight: 600; color: #666; }
        .tab-row { cursor: pointer; }
        .tab-row:hover { background: #f8f9fa; }

        /* Sales Panel */
        .sales-panel { width: 400px; background: #fff; border-left: 1px solid #ddd; display: flex; flex-direction: column; }
        .sales-header { padding: 15px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .sales-header h3 { font-size: 16px; }
        .sales-total { font-size: 24px; font-weight: 700; color: #27ae60; }
        
        /* Category Buttons */
        .category-buttons { padding: 10px; border-bottom: 1px solid #ddd; display: flex; flex-wrap: wrap; gap: 5px; }
        .cat-btn { padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; font-size: 12px; font-weight: 500; }
        .cat-btn.beverage { background: #e3f2fd; color: #1976d2; }
        .cat-btn.food { background: #fff3e0; color: #f57c00; }
        .cat-btn.merch { background: #f3e5f5; color: #7b1fa2; }
        .cat-btn.beer { background: #fff8e1; color: #ff8f00; }
        .cat-btn.wine { background: #fce4ec; color: #c2185b; }
        .cat-btn.cocktails { background: #e8f5e9; color: #388e3c; }
        .cat-btn.rental { background: #e0f2f1; color: #00796b; }
        .cat-btn.active { filter: brightness(0.9); box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        
        /* Mini Items Grid */
        .pos-items-mini { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 6px; 
            padding: 10px; 
            max-height: 180px; 
            overflow-y: auto; 
            border-bottom: 1px solid #eee;
        }
        .pos-items-mini .pos-item { 
            padding: 8px 5px; 
            font-size: 11px; 
            border-radius: 6px;
            background: #f8f9fa;
            border: 1px solid #eee;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .pos-items-mini .pos-item:hover { background: #e9ecef; border-color: #4a90a4; }
        .pos-items-mini .pos-item i { font-size: 16px; display: block; margin-bottom: 3px; }
        .pos-items-mini .item-name { font-size: 10px; line-height: 1.2; margin-bottom: 2px; }
        .pos-items-mini .item-price { font-size: 10px; font-weight: 600; color: #27ae60; }

        /* Cart Items */
        .cart-items { flex: 1; overflow-y: auto; padding: 15px; max-height: 200px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 6px; margin-bottom: 8px; }
        .cart-item-info { flex: 1; }
        .cart-item-name { font-weight: 500; font-size: 14px; }
        .cart-item-price { color: #666; font-size: 13px; }
        .cart-item-total { font-weight: 600; font-size: 14px; min-width: 60px; text-align: right; }
        .cart-item-remove { background: none; border: none; color: #e74c3c; cursor: pointer; padding: 5px; }
        .cart-empty { text-align: center; color: #999; padding: 40px; }
        
        /* Quantity Controls */
        .qty-controls { display: flex; align-items: center; gap: 5px; }
        .qty-btn { width: 24px; height: 24px; border-radius: 4px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; }
        .qty-btn:hover { background: #e9ecef; }
        .qty-value { width: 25px; text-align: center; font-weight: 600; }

        /* Cart Footer */
        .cart-footer { padding: 15px; border-top: 1px solid #ddd; }
        .cart-totals { margin-bottom: 15px; }
        .cart-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 14px; }
        .cart-row.total { font-size: 18px; font-weight: 700; border-top: 2px solid #ddd; padding-top: 10px; margin-top: 10px; }
        .payment-buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .pay-btn { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; }
        .pay-btn.pay-now { background: #27ae60; color: #fff; }
        .pay-btn.credit { background: #3498db; color: #fff; }
        .pay-btn.cash { background: #f39c12; color: #fff; }
        .pay-btn:hover { filter: brightness(0.9); }

        /* Recent Transactions */
        .recent-trans { padding: 15px; border-top: 1px solid #ddd; max-height: 200px; overflow-y: auto; }
        .recent-trans h4 { font-size: 13px; color: #666; margin-bottom: 10px; }
        .trans-item { display: flex; justify-content: space-between; padding: 8px; background: #f8f9fa; border-radius: 4px; margin-bottom: 5px; font-size: 12px; }
        .trans-time { color: #666; }
        .trans-amount { font-weight: 600; }

        /* Suspended Sales */
        .suspended-sales { padding: 15px; border-top: 1px solid #ddd; }
        .suspended-sales h4 { font-size: 13px; color: #666; margin-bottom: 10px; }
        .suspended-item { background: #e74c3c; color: #fff; padding: 10px; border-radius: 6px; margin-bottom: 5px; cursor: pointer; display: flex; justify-content: space-between; }
        .suspended-item:hover { filter: brightness(0.9); }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-overlay.active { display: flex; }
        .modal { background: #fff; border-radius: 12px; padding: 25px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal h3 { margin-bottom: 20px; font-size: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 13px; color: #666; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .modal-buttons button { flex: 1; padding: 12px; border-radius: 6px; font-weight: 600; cursor: pointer; }
        .btn-cancel { background: #f8f9fa; border: 1px solid #ddd; color: #666; }
        .btn-save { background: #4a90a4; border: none; color: #fff; }
        
        /* POS Items Grid */
        .pos-items-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .pos-item { background: #fff; border-radius: 10px; padding: 20px 15px; text-align: center; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 2px solid transparent; }
        .pos-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-color: #4a90a4; }
        .pos-item:active { transform: translateY(0); }
        .pos-item i { font-size: 28px; margin-bottom: 10px; display: block; }
        .pos-item .item-name { font-weight: 600; font-size: 14px; margin-bottom: 5px; }
        .pos-item .item-price { color: #27ae60; font-weight: 700; font-size: 16px; }
        .pos-item.rental { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); }
        .pos-item.rental i { color: #388e3c; }
        .pos-item.food { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); }
        .pos-item.food i { color: #f57c00; }
        .pos-item.beer { background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%); }
        .pos-item.beer i { color: #ff8f00; }
        .pos-item.wine { background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); }
        .pos-item.wine i { color: #c2185b; }
        .pos-item.cocktails { background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); }
        .pos-item.cocktails i { color: #00838f; }
        .pos-item.beverage { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); }
        .pos-item.beverage i { color: #1976d2; }
        .pos-item.merch { background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); }
        .pos-item.merch i { color: #7b1fa2; }
        
        /* Notification Toast */
        .toast { position: fixed; bottom: 30px; right: 30px; background: #2c3e50; color: #fff; padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 2000; transform: translateY(100px); opacity: 0; transition: all 0.3s; }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { background: #27ae60; }
        .toast.error { background: #e74c3c; }
        
        /* Delete Booking Button */
        .delete-booking-btn { background: #e74c3c; color: #fff; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-top: 10px; }
        .delete-booking-btn:hover { background: #c0392b; }
        
        /* Booking Detail Modal */
        .booking-detail { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .booking-detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        .booking-detail-row:last-child { border-bottom: none; }
        .booking-detail-label { color: #666; font-size: 13px; }
        .booking-detail-value { font-weight: 600; font-size: 14px; }
        
        /* Current Time Display */
        .current-time { font-size: 14px; font-weight: 600; color: #fff; opacity: 0.9; }
        
        /* Print Styles */
        @media print {
            .sidebar, .sales-panel, .sub-header-right, .header-nav { display: none !important; }
            .main-layout { display: block; height: auto; }
            .content { padding: 0; }
            .header { background: #333 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .room-column { break-inside: avoid; page-break-inside: avoid; margin-bottom: 20px; }
            .rooms-container { flex-wrap: wrap; }
        }
        
        /* Responsive Adjustments */
        @media (max-width: 1200px) {
            .header-stats { display: none; }
            .sidebar { width: 180px; }
            .sales-panel { width: 350px; }
        }
        @media (max-width: 900px) {
            .sidebar { display: none; }
            .sales-panel { width: 300px; }
        }
        
        /* Floor Plan Labels */
        .floor-label { position: absolute; font-size: 11px; color: #999; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Pulse Animation for Available Slots */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .slot-content.available:hover { animation: pulse 1s infinite; }
        
        /* Drag-and-drop prep styles */
        .slot-content.drag-over { background: #d4edda !important; border: 2px dashed #27ae60 !important; }
        .slot-content.booked { cursor: grab; }
        .slot-content.booked:active { cursor: grabbing; }
        
        /* Room status colors */
        .room-header .status-dot.available { background: #27ae60; }
        .room-header .status-dot.occupied { background: #e74c3c; }
        .room-header .status-dot.partial { background: #f39c12; }
        
        /* Better Table Active State */
        .table-item.has-tab { background: #e74c3c !important; border-color: #c0392b !important; color: #fff !important; }
        .table-item.has-tab.diamond { background: #e74c3c !important; }
        
        /* PIN Shake Animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }
        
        /* PIN Button Hover */
        .pin-btn:hover { background: #e9ecef !important; }
        .pin-btn:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <!-- PIN Lock Screen -->
    <div id="lockScreen" style="position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg, #2c3e50 0%, #4a90a4 100%);display:flex;align-items:center;justify-content:center;z-index:99999;">
        <div style="background:#fff;border-radius:16px;padding:40px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.3);max-width:400px;width:90%;">
            <img src="images/golfCoveLogo6.png" alt="Golf Cove" style="height:60px;margin-bottom:20px;">
            <h2 style="margin:0 0 5px;color:#2c3e50;">Golf Cove POS</h2>
            <p style="color:#666;margin:0 0 25px;font-size:14px;">Enter your PIN to unlock</p>
            
            <div id="pinDisplay" style="display:flex;justify-content:center;gap:10px;margin-bottom:20px;">
                <div class="pin-dot" style="width:16px;height:16px;border-radius:50%;border:2px solid #4a90a4;background:#fff;"></div>
                <div class="pin-dot" style="width:16px;height:16px;border-radius:50%;border:2px solid #4a90a4;background:#fff;"></div>
                <div class="pin-dot" style="width:16px;height:16px;border-radius:50%;border:2px solid #4a90a4;background:#fff;"></div>
                <div class="pin-dot" style="width:16px;height:16px;border-radius:50%;border:2px solid #4a90a4;background:#fff;"></div>
            </div>
            
            <div id="pinError" style="color:#e74c3c;font-size:13px;margin-bottom:15px;display:none;">Incorrect PIN. Try again.</div>
            
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:240px;margin:0 auto;">
                <button onclick="enterPin(1)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">1</button>
                <button onclick="enterPin(2)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">2</button>
                <button onclick="enterPin(3)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">3</button>
                <button onclick="enterPin(4)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">4</button>
                <button onclick="enterPin(5)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">5</button>
                <button onclick="enterPin(6)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">6</button>
                <button onclick="enterPin(7)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">7</button>
                <button onclick="enterPin(8)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">8</button>
                <button onclick="enterPin(9)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">9</button>
                <button onclick="clearPin()" class="pin-btn" style="padding:20px;font-size:16px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#fff3e0;cursor:pointer;color:#f57c00;"><i class="fas fa-backspace"></i></button>
                <button onclick="enterPin(0)" class="pin-btn" style="padding:20px;font-size:24px;font-weight:600;border:1px solid #ddd;border-radius:10px;background:#f8f9fa;cursor:pointer;">0</button>
                <button onclick="submitPin()" class="pin-btn" style="padding:20px;font-size:16px;font-weight:600;border:1px solid #27ae60;border-radius:10px;background:#27ae60;color:#fff;cursor:pointer;"><i class="fas fa-check"></i></button>
            </div>
            
            <p style="color:#999;font-size:11px;margin-top:20px;">Contact manager if you forgot your PIN</p>
        </div>
    </div>
    
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <a href="index.html" class="header-logo" style="text-decoration:none; color:#fff;">
                <img src="images/golfCoveLogo6.png" alt="Golf Cove">
                <span>Golf Cove</span>
            </a>
            <nav class="header-nav">
                <a href="#" class="active" onclick="showPage('teesheet', this); return false;"><i class="fas fa-calendar-alt"></i> Tee Sheet</a>
                <a href="#" onclick="showPage('fnb', this); return false;"><i class="fas fa-utensils"></i> Food & Beverage</a>
                <a href="sales.html"><i class="fas fa-cash-register"></i> Sales</a>
                <a href="customers.html"><i class="fas fa-users"></i> Customers</a>
            </nav>
        </div>
        <div class="header-stats">
            <div class="header-stat"><div class="value" id="statBookings">12</div><div class="label">Bookings</div></div>
            <div class="header-stat"><div class="value" id="statOccupancy">45%</div><div class="label">Occupancy</div></div>
            <div class="header-stat"><div class="value" id="statNoShows">0</div><div class="label">No Shows</div></div>
            <div class="header-stat"><div class="value" id="statCheckedIn">4</div><div class="label">Checked-In</div></div>
            <div class="header-stat"><div class="value" id="statRevenue">$485.00</div><div class="label">Revenue</div></div>
        </div>
        <div class="header-right">
            <button onclick="lockPOS()" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:12px;margin-right:5px;" title="Lock POS"><i class="fas fa-lock"></i></button>
            <button onclick="showReaderSetup()" id="readerStatusBtn" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:12px;margin-right:5px;" title="Card Reader"><i class="fas fa-credit-card"></i> <span id="readerStatusText">Reader</span></button>
            <button onclick="showSettings()" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:12px;margin-right:5px;" title="Settings"><i class="fas fa-cog"></i></button>
            <button onclick="showMigrationWizard()" style="background:none;border:1px solid rgba(255,255,255,0.3);color:#fff;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:12px;margin-right:10px;" title="Setup & Migration"><i class="fas fa-magic"></i> Setup</button>
            <div class="current-time" id="currentTime">--:-- --</div>
            <div class="header-user" id="currentUserDisplay">
                <i class="fas fa-user-circle" style="font-size: 24px;"></i>
                <span id="currentUserName">EJ Sattelberger</span>
            </div>
        </div>
    </header>

    <!-- Sub-header -->
    <div class="sub-header">
        <div class="sub-header-left">
            <div class="date-nav">
                <button onclick="changeDate(-1)"><i class="fas fa-chevron-left"></i></button>
                <button class="today-btn" onclick="goToToday()">Today</button>
                <button onclick="changeDate(1)"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="date-display" id="currentDateDisplay">Mon, Dec 8</div>
            <div class="weather">
                <i class="fas fa-cloud-sun"></i>
                <span>23°F</span>
            </div>
        </div>
        <div class="sub-header-right">
            <button onclick="showModal('booking')"><i class="fas fa-plus"></i> New Booking</button>
            <button onclick="showBulkBooking()" style="background:#e8f5e9;"><i class="fas fa-calendar-plus"></i> Bulk Book</button>
            <button onclick="showWaitlist()" style="background:#fff3e0;"><i class="fas fa-clock"></i> Waitlist</button>
            <button onclick="showAnalytics()" style="background:#e3f2fd;"><i class="fas fa-chart-bar"></i> Analytics</button>
            <button onclick="showDataImportModal()"><i class="fas fa-database"></i> Import</button>
            <button onclick="window.print()"><i class="fas fa-print"></i> Print</button>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search customers..." id="customerSearch">
            </div>

            <div class="sidebar-section">
                <button class="sidebar-btn" onclick="showModal('booking')"><i class="fas fa-plus"></i> New Booking</button>
                <button class="sidebar-btn"><i class="fas fa-list"></i> Standby List</button>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">Today's Summary</div>
                <div style="background:#f8f9fa;border-radius:8px;padding:12px;font-size:12px;">
                    <div style="display:flex;justify-content:space-between;padding:4px 0;"><span>Sales:</span><strong id="summaryTodaySales">$0.00</strong></div>
                    <div style="display:flex;justify-content:space-between;padding:4px 0;"><span>Transactions:</span><strong id="summaryTodayTrans">0</strong></div>
                    <div style="display:flex;justify-content:space-between;padding:4px 0;"><span>Open Tabs:</span><strong id="summaryOpenTabs">0</strong></div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Notes</div>
                <textarea style="width:100%; height:60px; border:1px solid #ddd; border-radius:6px; padding:8px; font-size:12px; resize:none;" placeholder="Daily notes..." id="dailyNotes" onblur="saveDailyNotes()"></textarea>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">December 2025</div>
                <div class="mini-calendar">
                    <div class="calendar-header">
                        <button onclick="changeMonth(-1)" style="background:none;border:none;cursor:pointer;"><i class="fas fa-chevron-left"></i></button>
                        <span id="calendarMonth">December 2025</span>
                        <button onclick="changeMonth(1)" style="background:none;border:none;cursor:pointer;"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Weather</div>
                <div style="display:flex; gap:10px; font-size:12px;">
                    <div style="text-align:center;"><div>Mon</div><i class="fas fa-cloud-sun"></i><div>23°</div></div>
                    <div style="text-align:center;"><div>Tue</div><i class="fas fa-cloud"></i><div>28°</div></div>
                    <div style="text-align:center;"><div>Wed</div><i class="fas fa-sun"></i><div>32°</div></div>
                    <div style="text-align:center;"><div>Thu</div><i class="fas fa-cloud-rain"></i><div>35°</div></div>
                    <div style="text-align:center;"><div>Fri</div><i class="fas fa-snowflake"></i><div>25°</div></div>
                </div>
            </div>
        </aside>

        <!-- Content Area -->
        <main class="content" id="mainContent">
            <!-- Tee Sheet Page -->
            <div id="page-teesheet" class="page-content">
                <div class="rooms-container" id="roomsContainer"></div>
            </div>

            <!-- Food & Beverage Page -->
            <div id="page-fnb" class="page-content" style="display:none;">
                <div class="fnb-container">
                    <div class="fnb-tabs">
                        <button class="fnb-tab active" onclick="switchFnbTab('lounge', this)">Golf Cove Lounge</button>
                        <button class="fnb-tab" onclick="switchFnbTab('rooms', this)">Golf Cove Rooms</button>
                    </div>
                    
                    <div class="tabs-list">
                        <h3><i class="fas fa-receipt"></i> Open Tabs <button onclick="showModal('newTab')" style="margin-left:auto;padding:5px 10px;background:#4a90a4;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:12px;">+ New Tab</button></h3>
                        <table class="tabs-table">
                            <thead>
                                <tr><th>TABLE</th><th>CUSTOMER NAME</th><th>EMPLOYEE</th><th>AMOUNT</th></tr>
                            </thead>
                            <tbody id="openTabsBody"></tbody>
                        </table>
                    </div>

                    <div class="floor-plan" id="floorPlan"></div>
                </div>
            </div>
        </main>

        <!-- Sales Panel (Right Side) - Quick Add for Tee Sheet/F&B -->
        <aside class="sales-panel" id="sidebarSalesPanel">
            <div class="sales-header">
                <h3><i class="fas fa-shopping-cart"></i> Quick Add</h3>
                <div class="sales-total">$<span id="totalAmount">0.00</span></div>
            </div>

            <div class="category-buttons">
                <button class="cat-btn beverage active" onclick="filterItems('all', this)">All</button>
                <button class="cat-btn rental" onclick="filterItems('rental', this)">Rentals</button>
                <button class="cat-btn food" onclick="filterItems('food', this)">Food</button>
                <button class="cat-btn beer" onclick="filterItems('beer', this)">Beer</button>
            </div>
            
            <div class="pos-items-mini" id="salesItems"></div>

            <div class="cart-items" id="cartItems">
                <div class="cart-empty"><i class="fas fa-shopping-cart" style="font-size:40px;margin-bottom:10px;"></i><p>No items in cart</p></div>
            </div>

            <div class="cart-footer">
                <div class="cart-totals">
                    <div class="cart-row"><span>Subtotal</span><span id="subtotal">$0.00</span></div>
                    <div class="cart-row" id="discountRow" style="display:none;color:#27ae60;"><span>Discount</span><span id="discountAmount">-$0.00</span></div>
                    <div class="cart-row"><span>Tax (6.35%)</span><span id="taxAmount">$0.00</span></div>
                    <div class="cart-row total"><span>Total:</span><span id="totalDue">$0.00</span></div>
                </div>
                <div class="payment-buttons" style="display:flex;gap:5px;flex-wrap:wrap;">
                    <button class="pay-btn" onclick="applyDiscount()" style="flex:1;min-width:45%;background:#f39c12;"><i class="fas fa-percent"></i> Discount</button>
                    <button class="pay-btn" onclick="clearCart()" style="flex:1;min-width:45%;background:#95a5a6;"><i class="fas fa-trash"></i> Clear</button>
                    <button class="pay-btn pay-now" onclick="processPayment('quick')" style="flex:1;min-width:100%;"><i class="fas fa-credit-card"></i> Pay Now</button>
                </div>
            </div>
            
            <div class="recent-trans">
                <h4>Recent Transactions</h4>
                <div id="recentTrans"></div>
            </div>
        </aside>
    </div>

    <!-- Booking Modal -->
    <div class="modal-overlay" id="modal-booking">
        <div class="modal">
            <h3><i class="fas fa-calendar-plus"></i> New Reservation</h3>
            <form id="bookingForm" onsubmit="createBooking(event)">
                <div style="background:#e8f5e9;padding:10px;border-radius:6px;margin-bottom:15px;font-size:12px;color:#2e7d32;">
                    <i class="fas fa-info-circle"></i> Fill in customer details to create a bay reservation
                </div>
                <div class="form-group" style="position:relative;">
                    <label>Customer Name *</label>
                    <input type="text" id="bookingCustomer" required placeholder="Search or enter name..." autocomplete="off">
                    <div id="bookingCustomerAutocomplete" style="position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;border-radius:0 0 8px 8px;max-height:180px;overflow-y:auto;z-index:100;display:none;box-shadow:0 4px 12px rgba(0,0,0,0.15);"></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Room/Bay *</label>
                        <select id="bookingRoom">
                            <option value="1">Room 1</option>
                            <option value="2">Room 2</option>
                            <option value="3">Room 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Duration *</label>
                        <select id="bookingDuration">
                            <option value="1">1 Hour - $45</option>
                            <option value="2">2 Hours - $80</option>
                            <option value="3">3 Hours - $110</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="bookingDate">
                    </div>
                    <div class="form-group">
                        <label>Time *</label>
                        <select id="bookingTime">
                            <option value="09:00">9:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="13:00">1:00 PM</option>
                            <option value="14:00">2:00 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="16:00">4:00 PM</option>
                            <option value="17:00">5:00 PM</option>
                            <option value="18:00">6:00 PM</option>
                            <option value="19:00">7:00 PM</option>
                            <option value="20:00">8:00 PM</option>
                            <option value="21:00">9:00 PM</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Players</label>
                        <select id="bookingPlayers">
                            <option value="1">1 Player</option>
                            <option value="2">2 Players</option>
                            <option value="3">3 Players</option>
                            <option value="4">4 Players</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="bookingPhone" placeholder="(203) 555-0123" oninput="formatPhoneNumber(this)">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="bookingEmail" placeholder="customer@email.com">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <input type="text" id="bookingNotes" placeholder="Special requests...">
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn-cancel" onclick="hideModal('booking')">Cancel</button>
                    <button type="submit" class="btn-save">Create Reservation</button>
                </div>
            </form>
        </div>
    </div>

    <!-- New Tab Modal -->
    <div class="modal-overlay" id="modal-newTab">
        <div class="modal">
            <h3><i class="fas fa-receipt"></i> New Tab</h3>
            <form onsubmit="createTab(event)">
                <div class="form-group">
                    <label>Customer Name *</label>
                    <input type="text" id="tabCustomer" required placeholder="Customer name">
                </div>
                <div class="form-group">
                    <label>Table/Location</label>
                    <select id="tabTable">
                        <option value="Tab">Open Tab</option>
                        <option value="Room 1">Room 1</option>
                        <option value="Room 2">Room 2</option>
                        <option value="Room 3">Room 3</option>
                        <option value="Bar">Bar</option>
                        <option value="Lounge">Lounge</option>
                        <optgroup label="Floor Tables">
                            <option value="Table 1">Table 1</option>
                            <option value="Table 2">Table 2</option>
                            <option value="Table 3">Table 3</option>
                            <option value="Table 4">Table 4</option>
                            <option value="Table 5">Table 5</option>
                            <option value="Table 6">Table 6</option>
                            <option value="Table 7">Table 7</option>
                            <option value="Table 8">Table 8</option>
                            <option value="Table 9">Table 9</option>
                            <option value="Table 10">Table 10</option>
                            <option value="Table 11">Table 11</option>
                            <option value="Table 12">Table 12</option>
                            <option value="Table 13">Table 13</option>
                            <option value="Table 14">Table 14</option>
                            <option value="Table 15">Table 15</option>
                        </optgroup>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn-cancel" onclick="hideModal('newTab')">Cancel</button>
                    <button type="submit" class="btn-save">Create Tab</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Booking Detail Modal -->
    <div class="modal-overlay" id="modal-bookingDetail">
        <div class="modal">
            <h3><i class="fas fa-calendar-check"></i> Reservation Details</h3>
            <div class="booking-detail">
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Customer</span>
                    <span class="booking-detail-value" id="detailCustomer">-</span>
                </div>
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Room/Bay</span>
                    <span class="booking-detail-value" id="detailRoom">-</span>
                </div>
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Time</span>
                    <span class="booking-detail-value" id="detailTime">-</span>
                </div>
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Duration</span>
                    <span class="booking-detail-value" id="detailDuration">-</span>
                </div>
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Players</span>
                    <span class="booking-detail-value" id="detailPlayers">-</span>
                </div>
            </div>
            <div class="modal-buttons" style="flex-wrap:wrap;">
                <button type="button" class="btn-cancel" onclick="hideModal('bookingDetail')" style="flex:1;min-width:100px;">Close</button>
                <button type="button" style="flex:1;min-width:100px;background:#f39c12;border:none;color:#fff;padding:12px;border-radius:6px;font-weight:600;cursor:pointer;" onclick="markNoShow()"><i class="fas fa-user-slash"></i> No Show</button>
                <button type="button" style="flex:1;min-width:100px;background:#9b59b6;border:none;color:#fff;padding:12px;border-radius:6px;font-weight:600;cursor:pointer;" onclick="rescheduleBooking()"><i class="fas fa-calendar-alt"></i> Reschedule</button>
                <button type="button" class="delete-booking-btn" onclick="deleteBooking()" style="flex:1;min-width:100px;"><i class="fas fa-trash"></i> Cancel</button>
                <button type="button" class="btn-save" onclick="checkInBooking()" style="flex:1;min-width:100px;"><i class="fas fa-check"></i> Check In</button>
            </div>
        </div>
    </div>

    <!-- Tab Detail Modal -->
    <div class="modal-overlay" id="modal-tabDetail">
        <div class="modal" style="max-width:450px;">
            <h3><i class="fas fa-receipt"></i> Tab Details</h3>
            <div class="booking-detail">
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Tab #</span>
                    <span class="booking-detail-value" id="tabDetailId">-</span>
                </div>
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Customer</span>
                    <span class="booking-detail-value" id="tabDetailCustomer">-</span>
                </div>
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Location</span>
                    <span class="booking-detail-value" id="tabDetailTable">-</span>
                </div>
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Subtotal</span>
                    <span class="booking-detail-value" id="tabDetailSubtotal">-</span>
                </div>
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Tax (6.35%)</span>
                    <span class="booking-detail-value" id="tabDetailTax">-</span>
                </div>
                <div class="booking-detail-row" style="font-weight:700;font-size:16px;border-top:2px solid #eee;padding-top:10px;margin-top:5px;">
                    <span class="booking-detail-label">Total</span>
                    <span class="booking-detail-value" id="tabDetailAmount" style="color:#27ae60;">-</span>
                </div>
            </div>
            <div id="tabItemsList" style="max-height:150px;overflow-y:auto;margin:15px 0;padding:10px;background:#f8f9fa;border-radius:6px;font-size:13px;"></div>
            <div class="modal-buttons">
                <button type="button" class="btn-cancel" onclick="hideModal('tabDetail')">Close</button>
                <button type="button" class="delete-booking-btn" onclick="closeTab()"><i class="fas fa-credit-card"></i> Pay & Close</button>
                <button type="button" class="btn-save" onclick="addToTabFromCurrent()"><i class="fas fa-plus"></i> Add Items</button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal-overlay" id="modal-payment">
        <div class="modal" style="max-width:400px;">
            <h3><i class="fas fa-credit-card"></i> Process Payment</h3>
            <div class="booking-detail">
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Subtotal</span>
                    <span class="booking-detail-value" id="paySubtotal">$0.00</span>
                </div>
                <div class="booking-detail-row" id="payDiscountRow" style="display:none;color:#27ae60;">
                    <span class="booking-detail-label">Discount</span>
                    <span class="booking-detail-value" id="payDiscount">-$0.00</span>
                </div>
                <div class="booking-detail-row">
                    <span class="booking-detail-label">Tax (6.35%)</span>
                    <span class="booking-detail-value" id="payTax">$0.00</span>
                </div>
                <div class="booking-detail-row" style="font-weight:700;font-size:18px;border-top:2px solid #eee;padding-top:10px;margin-top:5px;">
                    <span class="booking-detail-label">Total Due</span>
                    <span class="booking-detail-value" id="payTotal" style="color:#27ae60;">$0.00</span>
                </div>
            </div>
            <div style="margin:20px 0;">
                <label style="display:block;margin-bottom:8px;font-weight:600;font-size:13px;">Payment Method</label>
                <div style="display:flex;gap:10px;flex-wrap:wrap;">
                    <button type="button" class="pay-method-btn active" onclick="selectPayMethod('card', this)" style="flex:1;min-width:calc(50% - 5px);padding:15px 10px;border:2px solid #4a90a4;background:#4a90a4;color:#fff;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;">
                        <i class="fas fa-credit-card"></i> Card<br><span style="font-size:10px;opacity:0.8;font-weight:400;">(External Terminal)</span>
                    </button>
                    <button type="button" class="pay-method-btn" onclick="selectPayMethod('cash', this)" style="flex:1;min-width:calc(50% - 5px);padding:15px 10px;border:2px solid #ddd;background:#fff;color:#333;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;">
                        <i class="fas fa-money-bill-wave"></i> Cash
                    </button>
                    <button type="button" class="pay-method-btn" onclick="selectPayMethod('giftcard', this)" style="flex:1;min-width:calc(50% - 5px);padding:15px 10px;border:2px solid #ddd;background:#fff;color:#333;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;">
                        <i class="fas fa-gift"></i> Gift Card
                    </button>
                    <button type="button" class="pay-method-btn" onclick="selectPayMethod('tab', this)" style="flex:1;min-width:calc(50% - 5px);padding:15px 10px;border:2px solid #ddd;background:#fff;color:#333;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;">
                        <i class="fas fa-receipt"></i> Add to Tab
                    </button>
                </div>
            </div>
            <div id="cardSection" style="display:block;margin:15px 0;padding:15px;background:#e3f2fd;border-radius:8px;">
                <div style="display:flex;align-items:center;gap:10px;color:#1565c0;">
                    <i class="fas fa-info-circle" style="font-size:18px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:13px;" id="cardSectionTitle">Process on External Terminal</div>
                        <div style="font-size:12px;opacity:0.8;" id="cardSectionDesc">Complete the card payment on your card reader, then click "Complete Payment" to record the transaction.</div>
                    </div>
                </div>
                <div id="stripeTerminalActions" style="display:none;margin-top:10px;">
                    <button type="button" onclick="initiateStripePayment()" id="stripePayBtn" style="width:100%;padding:12px;background:#635bff;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:14px;">
                        <i class="fas fa-credit-card"></i> Charge Card on Reader
                    </button>
                    <div id="stripePaymentStatus" style="display:none;margin-top:10px;padding:12px;border-radius:6px;text-align:center;"></div>
                </div>
            </div>
            <div id="giftcardSection" style="display:none;margin:15px 0;padding:15px;background:#fff3e0;border-radius:8px;">
                <label style="display:block;margin-bottom:8px;font-weight:600;font-size:13px;">Gift Card Number</label>
                <input type="text" id="giftCardNumber" placeholder="Enter gift card code" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:14px;text-transform:uppercase;" oninput="this.value = this.value.toUpperCase()">
                <button type="button" onclick="lookupGiftCard()" style="margin-top:10px;width:100%;padding:10px;background:#f57c00;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;"><i class="fas fa-search"></i> Check Balance</button>
                <div id="giftCardInfo" style="display:none;margin-top:10px;padding:10px;background:#e8f5e9;border-radius:6px;"></div>
            </div>
            <div id="tabSection" style="display:none;margin:15px 0;padding:15px;background:#f3e5f5;border-radius:8px;">
                <div style="display:flex;align-items:center;gap:10px;color:#7b1fa2;">
                    <i class="fas fa-info-circle" style="font-size:18px;"></i>
                    <div>
                        <div style="font-weight:600;font-size:13px;">Add to Customer Tab</div>
                        <div style="font-size:12px;opacity:0.8;">This will add the items to the customer's open tab for payment later.</div>
                    </div>
                </div>
            </div>
            <div id="cashSection" style="display:none;margin:15px 0;padding:15px;background:#f8f9fa;border-radius:8px;">
                <label style="display:block;margin-bottom:8px;font-weight:600;font-size:13px;">Cash Tendered</label>
                <input type="number" id="cashTendered" placeholder="0.00" step="0.01" min="0" oninput="calculateChange()" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-size:16px;text-align:right;">
                <div style="display:flex;gap:5px;margin-top:10px;flex-wrap:wrap;">
                    <button type="button" onclick="quickCash(20)" style="flex:1;padding:8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;">$20</button>
                    <button type="button" onclick="quickCash(50)" style="flex:1;padding:8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;">$50</button>
                    <button type="button" onclick="quickCash(100)" style="flex:1;padding:8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;">$100</button>
                    <button type="button" onclick="quickCash('exact')" style="flex:1;padding:8px;border:1px solid #ddd;background:#fff;border-radius:4px;cursor:pointer;">Exact</button>
                </div>
                <div id="changeSection" style="display:none;margin-top:15px;padding:12px;background:#e8f5e9;border-radius:6px;text-align:center;">
                    <span style="font-size:13px;color:#666;">Change Due:</span>
                    <span id="changeAmount" style="font-size:20px;font-weight:700;color:#27ae60;margin-left:10px;">$0.00</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn-cancel" onclick="hideModal('payment')">Cancel</button>
                <button type="button" class="btn-save" id="completePayBtn" onclick="completePayment()"><i class="fas fa-check"></i> Complete Payment</button>
            </div>
        </div>
    </div>

    <!-- Global Lookup Modal -->
    <div class="modal-overlay" id="modal-lookup">
        <div class="modal" style="max-width:600px;">
            <h3><i class="fas fa-search"></i> Quick Lookup <span style="font-size:11px;opacity:0.7;margin-left:10px;">Ctrl+K</span></h3>
            <div style="margin-bottom:15px;">
                <input type="text" id="globalSearchInput" placeholder="Search customers, bookings, transactions..." 
                    style="width:100%;padding:15px;border:2px solid #4a90a4;border-radius:8px;font-size:16px;"
                    oninput="performGlobalSearch(this.value)" autofocus>
            </div>
            <div id="globalSearchResults" style="max-height:400px;overflow-y:auto;">
                <div style="text-align:center;color:#999;padding:40px;">
                    <i class="fas fa-search" style="font-size:40px;margin-bottom:10px;display:block;"></i>
                    Start typing to search...
                </div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn-cancel" onclick="hideModal('lookup')">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ============ DATA ============
        let currentDate = new Date();
        let selectedDate = currentDate.toISOString().split('T')[0]; // YYYY-MM-DD format
        let cart = [];
        let currentDiscount = 0;
        let selectedBookingId = null;
        let selectedTabId = null;
        let bookings = JSON.parse(localStorage.getItem('gc_bookings') || '[]');
        let transactions = JSON.parse(localStorage.getItem('gc_transactions') || '[]');
        let openTabs = JSON.parse(localStorage.getItem('gc_tabs') || '[]');
        
        // ============ PIN LOCK SYSTEM ============
        let currentPin = '';
        let currentEmployee = null;
        let isLocked = true;
        
        // Default employees with PINs - stored in localStorage
        const defaultEmployees = [
            { id: 1, name: 'EJ Sattelberger', pin: '9999', role: 'manager' },
            { id: 2, name: 'Manager', pin: '9999', role: 'manager' },
            { id: 3, name: 'Bartender 1', pin: '9999', role: 'staff' },
            { id: 4, name: 'Bartender 2', pin: '9999', role: 'staff' },
        ];
        
        // Initialize employees from localStorage or use defaults
        let employees = JSON.parse(localStorage.getItem('gc_employees') || 'null') || defaultEmployees;
        localStorage.setItem('gc_employees', JSON.stringify(employees));
        
        function enterPin(num) {
            if (currentPin.length < 4) {
                currentPin += num.toString();
                updatePinDisplay();
            }
        }
        
        function clearPin() {
            if (currentPin.length > 0) {
                currentPin = currentPin.slice(0, -1);
                updatePinDisplay();
            }
        }
        
        function updatePinDisplay() {
            const dots = document.querySelectorAll('#pinDisplay .pin-dot');
            dots.forEach((dot, i) => {
                if (i < currentPin.length) {
                    dot.style.background = '#4a90a4';
                } else {
                    dot.style.background = '#fff';
                }
            });
            document.getElementById('pinError').style.display = 'none';
        }
        
        function submitPin() {
            const employee = employees.find(e => e.pin === currentPin);
            
            if (employee) {
                currentEmployee = employee;
                isLocked = false;
                document.getElementById('lockScreen').style.display = 'none';
                document.getElementById('currentUserName').textContent = employee.name;
                showToast(`Welcome, ${employee.name}!`, 'success');
                
                // Log the clock-in
                const clockIns = JSON.parse(localStorage.getItem('gc_clock_ins') || '[]');
                clockIns.push({
                    employee: employee.name,
                    employeeId: employee.id,
                    action: 'clock_in',
                    time: new Date().toISOString()
                });
                localStorage.setItem('gc_clock_ins', JSON.stringify(clockIns));
            } else {
                document.getElementById('pinError').style.display = 'block';
                currentPin = '';
                updatePinDisplay();
                
                // Shake animation
                const pinDisplay = document.getElementById('pinDisplay');
                pinDisplay.style.animation = 'shake 0.3s';
                setTimeout(() => pinDisplay.style.animation = '', 300);
            }
        }
        
        function lockPOS() {
            isLocked = true;
            currentPin = '';
            updatePinDisplay();
            document.getElementById('lockScreen').style.display = 'flex';
            document.getElementById('pinError').style.display = 'none';
            
            if (currentEmployee) {
                // Log the clock-out
                const clockIns = JSON.parse(localStorage.getItem('gc_clock_ins') || '[]');
                clockIns.push({
                    employee: currentEmployee.name,
                    employeeId: currentEmployee.id,
                    action: 'lock',
                    time: new Date().toISOString()
                });
                localStorage.setItem('gc_clock_ins', JSON.stringify(clockIns));
            }
        }
        
        // Handle keyboard input for PIN
        document.addEventListener('keydown', function(e) {
            if (!isLocked) return;
            
            if (e.key >= '0' && e.key <= '9') {
                enterPin(parseInt(e.key));
            } else if (e.key === 'Backspace') {
                clearPin();
            } else if (e.key === 'Enter') {
                submitPin();
            }
        });
        
        // Add shake animation style
        const shakeStyle = document.createElement('style');
        shakeStyle.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
            .pin-btn:hover { background: #e9ecef !important; }
            .pin-btn:active { transform: scale(0.95); }
        `;
        document.head.appendChild(shakeStyle);

        const rooms = [
            { id: 1, name: 'Room 1' },
            { id: 2, name: 'Room 2' },
            { id: 3, name: 'Room 3' }
        ];

        const timeSlots = ['9:00am', '10:00am', '11:00am', '12:00pm', '1:00pm', '2:00pm', '3:00pm', '4:00pm', '5:00pm', '6:00pm', '7:00pm', '8:00pm'];

        const items = [
            // Bay Rentals
            { id: 1, name: '1 Hour Bay', price: 45, category: 'rental', icon: 'fa-golf-ball' },
            { id: 2, name: '2 Hour Bay', price: 80, category: 'rental', icon: 'fa-clock' },
            { id: 3, name: '3 Hour Bay', price: 110, category: 'rental', icon: 'fa-hourglass' },
            // Food
            { id: 4, name: 'Burger', price: 14, category: 'food', icon: 'fa-hamburger' },
            { id: 5, name: 'Wings (10pc)', price: 12, category: 'food', icon: 'fa-drumstick-bite' },
            { id: 6, name: 'Nachos', price: 11, category: 'food', icon: 'fa-cheese' },
            { id: 7, name: 'Pizza', price: 13, category: 'food', icon: 'fa-pizza-slice' },
            { id: 21, name: 'Chicken Tenders', price: 10, category: 'food', icon: 'fa-drumstick-bite' },
            { id: 22, name: 'Fries', price: 6, category: 'food', icon: 'fa-french-fries' },
            { id: 23, name: 'Hot Dog', price: 8, category: 'food', icon: 'fa-hotdog' },
            { id: 24, name: 'Pretzel', price: 7, category: 'food', icon: 'fa-cookie' },
            // Beer
            { id: 8, name: 'Domestic Beer', price: 5, category: 'beer', icon: 'fa-beer-mug-empty' },
            { id: 9, name: 'Craft Beer', price: 7, category: 'beer', icon: 'fa-beer-mug-empty' },
            { id: 25, name: 'Bucket (5)', price: 20, category: 'beer', icon: 'fa-bucket' },
            { id: 26, name: 'IPA', price: 8, category: 'beer', icon: 'fa-beer-mug-empty' },
            // Wine
            { id: 10, name: 'House Wine', price: 9, category: 'wine', icon: 'fa-wine-glass' },
            { id: 11, name: 'Premium Wine', price: 12, category: 'wine', icon: 'fa-wine-bottle' },
            { id: 27, name: 'Prosecco', price: 10, category: 'wine', icon: 'fa-champagne-glasses' },
            // Cocktails
            { id: 12, name: 'Well Cocktail', price: 8, category: 'cocktails', icon: 'fa-martini-glass' },
            { id: 13, name: 'Premium Cocktail', price: 12, category: 'cocktails', icon: 'fa-martini-glass-citrus' },
            { id: 28, name: 'Margarita', price: 10, category: 'cocktails', icon: 'fa-glass-citrus' },
            { id: 29, name: 'Old Fashioned', price: 12, category: 'cocktails', icon: 'fa-whiskey-glass' },
            // Beverages
            { id: 14, name: 'Soda', price: 3, category: 'beverage', icon: 'fa-glass-water' },
            { id: 15, name: 'Water', price: 2, category: 'beverage', icon: 'fa-droplet' },
            { id: 30, name: 'Coffee', price: 3, category: 'beverage', icon: 'fa-mug-hot' },
            { id: 31, name: 'Energy Drink', price: 5, category: 'beverage', icon: 'fa-bolt' },
            { id: 32, name: 'Juice', price: 4, category: 'beverage', icon: 'fa-lemon' },
            // Merchandise
            { id: 16, name: 'Golf Glove', price: 25, category: 'merch', icon: 'fa-hand' },
            { id: 17, name: 'Golf Balls (dz)', price: 35, category: 'merch', icon: 'fa-circle' },
            { id: 18, name: 'Hat', price: 28, category: 'merch', icon: 'fa-hat-cowboy' },
            { id: 33, name: 'Golf Cove Tee', price: 32, category: 'merch', icon: 'fa-shirt' },
            { id: 34, name: 'Club Rental', price: 15, category: 'merch', icon: 'fa-golf-ball-tee' },
            // Lessons
            { id: 19, name: '30 Min Lesson', price: 50, category: 'rental', icon: 'fa-chalkboard-teacher' },
            { id: 20, name: '1 Hour Lesson', price: 90, category: 'rental', icon: 'fa-user-graduate' },
        ];

        const floorPlanTables = [
            { id: 1, type: 'circle', x: 50, y: 50 },
            { id: 2, type: 'circle', x: 150, y: 50 },
            { id: 3, type: 'circle', x: 250, y: 50 },
            { id: 4, type: 'circle', x: 350, y: 50 },
            { id: 5, type: 'circle', x: 50, y: 150 },
            { id: 6, type: 'circle', x: 150, y: 150 },
            { id: 7, type: 'diamond', x: 300, y: 150 },
            { id: 8, type: 'diamond', x: 400, y: 150 },
            { id: 9, type: 'diamond', x: 500, y: 150 },
            { id: 10, type: 'rectangle', x: 50, y: 350 },
            { id: 11, type: 'rectangle', x: 150, y: 350 },
            { id: 12, type: 'rectangle', x: 250, y: 350 },
            { id: 13, type: 'circle', x: 400, y: 350 },
            { id: 14, type: 'circle', x: 500, y: 350 },
            { id: 15, type: 'circle', x: 600, y: 350 },
        ];

        // Sample bookings
        if (bookings.length === 0) {
            bookings = [
                { id: 1, room: 1, time: '10:00am', customer: 'Mike Johnson', players: 2, duration: 1 },
                { id: 2, room: 1, time: '11:00am', customer: 'Alex Qi', players: 4, duration: 2 },
                { id: 3, room: 2, time: '12:00pm', customer: 'Sarah Wilson', players: 1, duration: 1 },
                { id: 4, room: 2, time: '1:00pm', customer: 'Tom Brown', players: 2, duration: 1 },
                { id: 5, room: 3, time: '1:00pm', customer: 'Chris Lee', players: 1, duration: 1 },
                { id: 6, room: 3, time: '2:00pm', customer: 'Ryan Smith', players: 1, duration: 1 },
                { id: 7, room: 1, time: '5:00pm', customer: 'Nick Piselli', players: 1, duration: 1 },
                { id: 8, room: 2, time: '4:00pm', customer: 'Brett Huck', players: 1, duration: 1 },
                { id: 9, room: 3, time: '4:00pm', customer: 'Dylan Vasp', players: 1, duration: 1 },
            ];
            localStorage.setItem('gc_bookings', JSON.stringify(bookings));
        }

        // Sample tabs
        if (openTabs.length === 0) {
            openTabs = [
                { id: 53, customer: 'Ryan Handyman', employee: 'EJ Sattelberger', amount: 45.00, subtotal: 42.30, items: [], table: 'Tab', createdAt: new Date().toISOString() },
                { id: 63, customer: 'Adam', employee: 'GC TABS', amount: 12.00, subtotal: 11.28, items: [], table: 'Tab', createdAt: new Date().toISOString() },
                { id: 35, customer: 'Vinny', employee: 'GC TABS', amount: 28.00, subtotal: 26.33, items: [], table: 'Tab', createdAt: new Date().toISOString() },
                { id: 36, customer: 'EJ', employee: 'GC TABS', amount: 0, subtotal: 0, items: [], table: 'Tab', createdAt: new Date().toISOString() },
            ];
            localStorage.setItem('gc_tabs', JSON.stringify(openTabs));
        }

        // Sample transactions
        if (transactions.length === 0) {
            const today = new Date().toISOString();
            transactions = [
                { id: 26762, customer: 'Qi**', amount: 0, subtotal: 0, tax: 0, items: [], itemCount: 0, method: 'card', time: '6:18PM', date: today, discount: 0, isReturn: false, register: 'POS-1' },
                { id: 26761, customer: 'No Customer', amount: 94.48, subtotal: 88.84, tax: 5.64, items: [], itemCount: 2, method: 'card', time: '6:14PM', date: today, discount: 0, isReturn: false, register: 'POS-1' },
                { id: 26760, customer: 'No Customer', amount: 53.18, subtotal: 50.00, tax: 3.18, items: [], itemCount: 1, method: 'cash', time: '5:17PM', date: today, discount: 0, isReturn: false, register: 'POS-1', tip: 1.00 },
                { id: 26759, customer: 'No Customer', amount: 14.60, subtotal: 13.73, tax: 0.87, items: [], itemCount: 1, method: 'card', time: '3:55PM', date: today, discount: 0, isReturn: false, register: 'POS-1' },
                { id: 26758, customer: 'No Customer', amount: 0, subtotal: 0, tax: 0, items: [], itemCount: 0, method: 'cash', time: '3:12PM', date: today, discount: 0, isReturn: false, register: 'POS-1' },
            ];
        }

        // ============ RENDER FUNCTIONS ============
        function renderTeeSheet() {
            const container = document.getElementById('roomsContainer');
            container.innerHTML = rooms.map(room => {
                // Calculate room status
                const roomBookings = bookings.filter(b => b.room === room.id);
                const bookedCount = roomBookings.length;
                const checkedInCount = roomBookings.filter(b => b.checkedIn).length;
                let statusClass = 'available';
                if (bookedCount > 0 && checkedInCount === bookedCount) statusClass = 'occupied';
                else if (bookedCount > 0) statusClass = 'partial';
                
                return `
                <div class="room-column">
                    <div class="room-header">
                        <span class="status-dot ${statusClass}"></span>
                        <h3>${room.name}</h3>
                        <span style="font-size:11px;color:#888;margin-left:auto;">${bookedCount} bookings</span>
                    </div>
                    <div class="room-slots">
                        ${timeSlots.map(time => {
                            const booking = bookings.find(b => b.room === room.id && b.time === time);
                            return `
                                <div class="time-slot">
                                    <div class="time-label">${time}</div>
                                    <div class="slot-content ${booking ? (booking.checkedIn ? 'booked checked-in' : 'booked') : 'available'}" onclick="${booking ? `selectBooking(${booking.id})` : `quickBook(${room.id}, '${time}')`}">
                                        ${booking ? `
                                            <div class="booking-info">
                                                <span class="customer-name">${booking.customer}${booking.checkedIn ? ' <i class="fas fa-check-circle" style="color:#27ae60;"></i>' : ''}</span>
                                                <span class="booking-details">${booking.duration}hr</span>
                                            </div>
                                            <span class="player-count">${booking.players}<i class="fas fa-user" style="margin-left:3px;font-size:10px;"></i></span>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `}).join('');
            updateStats();
        }

        function renderFloorPlan() {
            const container = document.getElementById('floorPlan');
            // Add floor labels
            let html = `
                <div class="floor-label" style="top: 10px; left: 10px;">Lounge Area</div>
                <div class="floor-label" style="top: 130px; left: 280px;">VIP Section</div>
                <div class="floor-label" style="top: 320px; left: 10px;">Bar Area</div>
                <div class="floor-label" style="top: 320px; left: 380px;">Window Seating</div>
            `;
            html += floorPlanTables.map(table => {
                const hasTab = openTabs.some(t => t.table === `Table ${table.id}`);
                const tabAmount = openTabs.find(t => t.table === `Table ${table.id}`)?.amount || 0;
                return `<div class="table-item ${table.type} ${hasTab ? 'has-tab' : ''}" style="left:${table.x}px;top:${table.y}px;" onclick="selectTable(${table.id})" title="${hasTab ? '$' + tabAmount.toFixed(2) : 'Available'}"><span>${table.id}</span></div>`;
            }).join('');
            container.innerHTML = html;
        }

        function renderOpenTabs() {
            document.getElementById('openTabsBody').innerHTML = openTabs.map(tab => `
                <tr class="tab-row" onclick="selectTab(${tab.id})">
                    <td>Tab ${tab.id}</td>
                    <td>${tab.customer}</td>
                    <td>${tab.employee}</td>
                    <td>$${tab.amount.toFixed(2)}</td>
                </tr>
            `).join('');
        }

        function renderCart() {
            const container = document.getElementById('cartItems');
            if (cart.length === 0) {
                container.innerHTML = '<div class="cart-empty"><i class="fas fa-shopping-cart" style="font-size:40px;margin-bottom:10px;"></i><p>No items in cart</p></div>';
            } else {
                container.innerHTML = cart.map((item, i) => `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">$${item.price.toFixed(2)} each</div>
                        </div>
                        <div class="qty-controls">
                            <button class="qty-btn" onclick="changeQty(${i}, -1)">-</button>
                            <span class="qty-value">${item.qty}</span>
                            <button class="qty-btn" onclick="changeQty(${i}, 1)">+</button>
                        </div>
                        <div class="cart-item-total">$${(item.price * item.qty).toFixed(2)}</div>
                        <button class="cart-item-remove" onclick="removeFromCart(${i})"><i class="fas fa-trash"></i></button>
                    </div>
                `).join('');
            }
            updateTotals();
        }

        function renderRecentTrans() {
            document.getElementById('recentTrans').innerHTML = transactions.slice(0, 5).map((t, i) => `
                <div class="trans-item" onclick="showTransactionDetail(${i})" style="cursor:pointer;">
                    <span class="trans-time">${t.time}</span>
                    <span>${t.customer}</span>
                    <span class="trans-amount">$${t.amount.toFixed(2)}</span>
                    <span>#${t.id}</span>
                </div>
            `).join('');
        }
        
        function showTransactionDetail(index) {
            const trans = transactions[index];
            if (!trans) return;
            if (confirm(`Transaction #${trans.id}\nCustomer: ${trans.customer}\nAmount: $${trans.amount.toFixed(2)}\n\nPrint receipt?`)) {
                printReceipt(trans);
            }
        }

        function renderSuspendedSales() {
            const container = document.getElementById('suspendedSales');
            if (!container) return; // Element doesn't exist in current layout
            
            const suspended = JSON.parse(localStorage.getItem('gc_suspended') || '[]');
            if (suspended.length === 0) {
                // Sample data if empty
                const sampleSuspended = [
                    { id: 9991, customer: 'Brett Huck', amount: 69.13, items: [] },
                    { id: 9972, customer: 'Dylan Vasp', amount: 42.54, items: [] },
                    { id: 9962, customer: 'Robert Nea', amount: 53.18, items: [] },
                ];
                container.innerHTML = sampleSuspended.map(s => `
                    <div class="suspended-item" onclick="resumeSale(${s.id})">
                        <div><strong>SIM: #${s.id}</strong><br>${s.customer}</div>
                        <div>$${s.amount.toFixed(2)}</div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = suspended.map(s => `
                    <div class="suspended-item" onclick="resumeSale(${s.id})">
                        <div><strong>Sale #${s.id}</strong><br>${s.customer}</div>
                        <div>$${s.amount.toFixed(2)}</div>
                    </div>
                `).join('');
            }
        }
        
        function renderSalesItems(filter = 'all') {
            const container = document.getElementById('salesItems');
            if (!container) return;
            const filteredItems = filter === 'all' ? items : items.filter(i => i.category === filter);
            
            container.innerHTML = filteredItems.map(item => `
                <div class="pos-item ${item.category}" onclick="addToCart('${item.name}', ${item.price})">
                    <i class="fas ${item.icon}"></i>
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">$${item.price.toFixed(2)}</div>
                </div>
            `).join('');
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const days = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
            const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
            const today = new Date();
            
            let html = days.map(d => `<div class="calendar-day header">${d}</div>`).join('');
            for (let i = 0; i < firstDay; i++) html += '<div class="calendar-day"></div>';
            for (let i = 1; i <= daysInMonth; i++) {
                const isToday = i === today.getDate() && currentDate.getMonth() === today.getMonth() && currentDate.getFullYear() === today.getFullYear();
                html += `<div class="calendar-day ${isToday ? 'today' : ''}" onclick="selectDate(${i})">${i}</div>`;
            }
            grid.innerHTML = html;
            document.getElementById('calendarMonth').textContent = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
        }

        // ============ CART FUNCTIONS ============
        function addToCart(name, price) {
            const existing = cart.find(i => i.name === name);
            if (existing) existing.qty++;
            else cart.push({ name, price, qty: 1 });
            renderCart();
            showToast(`Added: ${name}`);
        }

        function removeFromCart(index) {
            const item = cart[index];
            cart.splice(index, 1);
            renderCart();
            if (item) showToast(`Removed: ${item.name}`);
        }
        
        function clearCart() {
            if (cart.length === 0) return;
            cart = [];
            currentDiscount = 0;
            renderCart();
            showToast('Cart cleared');
        }
        
        function changeQty(index, delta) {
            cart[index].qty += delta;
            if (cart[index].qty <= 0) {
                cart.splice(index, 1);
            }
            // Reset discount if cart is now empty or discount exceeds new subtotal
            if (cart.length === 0) {
                currentDiscount = 0;
            } else {
                const newSubtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
                if (currentDiscount > newSubtotal) {
                    currentDiscount = newSubtotal;
                    showToast('Discount adjusted to match subtotal', 'error');
                }
            }
            renderCart();
        }
        
        // Phone number formatting
        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 10) value = value.slice(0, 10);
            if (value.length >= 6) {
                input.value = `(${value.slice(0,3)}) ${value.slice(3,6)}-${value.slice(6)}`;
            } else if (value.length >= 3) {
                input.value = `(${value.slice(0,3)}) ${value.slice(3)}`;
            } else if (value.length > 0) {
                input.value = `(${value}`;
            }
        }
        
        // Customer database
        let customers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
        
        // Helper to get full name from customer object (handles both old and new formats)
        function getCustomerFullName(c) {
            if (c.firstName && c.lastName) return `${c.firstName} ${c.lastName}`;
            if (c.firstName) return c.firstName;
            if (c.name) return c.name;
            return 'Unknown';
        }
        
        function saveCustomer(name, phone, email) {
            if (!name) return;
            // Split name into firstName/lastName for consistency
            const nameParts = name.trim().split(/\s+/);
            const firstName = nameParts[0] || '';
            const lastName = nameParts.slice(1).join(' ') || '';
            
            const existing = customers.find(c => {
                const fullName = getCustomerFullName(c).toLowerCase();
                return fullName === name.toLowerCase();
            });
            
            if (existing) {
                // Migrate old format to new format if needed
                if (existing.name && !existing.firstName) {
                    const parts = existing.name.trim().split(/\s+/);
                    existing.firstName = parts[0] || '';
                    existing.lastName = parts.slice(1).join(' ') || '';
                    delete existing.name;
                }
                if (phone) existing.phone = phone;
                if (email) existing.email = email;
            } else {
                customers.push({
                    id: Date.now(),
                    firstName: firstName,
                    lastName: lastName,
                    phone: phone || '',
                    email: email || '',
                    isMember: false,
                    memberType: null,
                    priceClass: 'Regular',
                    visitCount: 0,
                    totalSpent: 0,
                    createdAt: new Date().toISOString()
                });
            }
            localStorage.setItem('gc_customers', JSON.stringify(customers));
        }
        
        // Update customer stats after a transaction
        function updateCustomerStats(customerName, amount) {
            if (!customerName || customerName === 'Walk-In' || customerName === 'Walk-in') return;
            
            const customer = customers.find(c => {
                const fullName = getCustomerFullName(c).toLowerCase();
                return fullName === customerName.toLowerCase();
            });
            
            if (customer) {
                customer.totalSpent = (customer.totalSpent || 0) + amount;
                customer.visitCount = (customer.visitCount || 0) + 1;
                customer.lastVisit = new Date().toISOString();
                localStorage.setItem('gc_customers', JSON.stringify(customers));
            }
        }

        function updateTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const discountedSubtotal = subtotal - currentDiscount;
            const tax = discountedSubtotal * 0.0635;
            const total = discountedSubtotal + tax;
            
            document.getElementById('subtotal').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('taxAmount').textContent = '$' + tax.toFixed(2);
            document.getElementById('totalDue').textContent = '$' + total.toFixed(2);
            document.getElementById('totalAmount').textContent = total.toFixed(2);
            
            // Show/hide discount row
            const discountRow = document.getElementById('discountRow');
            if (currentDiscount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('discountAmount').textContent = '-$' + currentDiscount.toFixed(2);
            } else {
                discountRow.style.display = 'none';
            }
        }
        
        function applyDiscount() {
            if (cart.length === 0) return showToast('Add items first', 'error');
            const discountType = prompt('Enter discount:\\n- Percentage (e.g., "10%")\\n- Dollar amount (e.g., "5")\\n- Or cancel');
            if (!discountType) return;
            
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            
            if (discountType.includes('%')) {
                const pct = parseFloat(discountType.replace('%', ''));
                if (isNaN(pct) || pct < 0 || pct > 100) {
                    return showToast('Invalid percentage (0-100)', 'error');
                }
                currentDiscount = subtotal * (pct / 100);
                showToast(`${pct}% discount applied`);
            } else {
                const dollarAmount = parseFloat(discountType);
                if (isNaN(dollarAmount) || dollarAmount < 0) {
                    return showToast('Invalid amount', 'error');
                }
                if (dollarAmount > subtotal) {
                    return showToast('Discount cannot exceed subtotal', 'error');
                }
                currentDiscount = dollarAmount;
                showToast(`$${currentDiscount.toFixed(2)} discount applied`);
            }
            updateTotals();
        }

        let currentPayMethod = 'card';
        let currentPayTotal = 0;
        
        function processPayment(method) {
            if (cart.length === 0) return showToast('Cart is empty', 'error');
            
            // Calculate totals
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const discountedSubtotal = subtotal - currentDiscount;
            const tax = discountedSubtotal * 0.0635;
            currentPayTotal = discountedSubtotal + tax;
            
            // Populate payment modal
            document.getElementById('paySubtotal').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('payTax').textContent = '$' + tax.toFixed(2);
            document.getElementById('payTotal').textContent = '$' + currentPayTotal.toFixed(2);
            
            if (currentDiscount > 0) {
                document.getElementById('payDiscountRow').style.display = 'flex';
                document.getElementById('payDiscount').textContent = '-$' + currentDiscount.toFixed(2);
            } else {
                document.getElementById('payDiscountRow').style.display = 'none';
            }
            
            // Reset payment modal state
            currentPayMethod = 'card';
            document.getElementById('cashSection').style.display = 'none';
            document.getElementById('cardSection').style.display = 'block';
            document.getElementById('giftcardSection').style.display = 'none';
            document.getElementById('tabSection').style.display = 'none';
            document.getElementById('cashTendered').value = '';
            document.getElementById('changeSection').style.display = 'none';
            document.getElementById('giftCardNumber').value = '';
            document.getElementById('giftCardInfo').style.display = 'none';
            
            // Reset button states
            document.querySelectorAll('.pay-method-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = '#fff';
                btn.style.color = '#333';
                btn.style.borderColor = '#ddd';
            });
            const cardBtn = document.querySelector('.pay-method-btn');
            if (cardBtn) {
                cardBtn.classList.add('active');
                cardBtn.style.background = '#4a90a4';
                cardBtn.style.color = '#fff';
                cardBtn.style.borderColor = '#4a90a4';
            }
            
            showModal('payment');
        }
        
        function selectPayMethod(method, btn) {
            currentPayMethod = method;
            document.querySelectorAll('.pay-method-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = '#fff';
                b.style.color = '#333';
                b.style.borderColor = '#ddd';
            });
            btn.classList.add('active');
            btn.style.background = '#4a90a4';
            btn.style.color = '#fff';
            btn.style.borderColor = '#4a90a4';
            
            // Hide all payment sections
            document.getElementById('cashSection').style.display = 'none';
            document.getElementById('cardSection').style.display = 'none';
            document.getElementById('giftcardSection').style.display = 'none';
            document.getElementById('tabSection').style.display = 'none';
            
            // Show relevant section
            if (method === 'cash') {
                document.getElementById('cashSection').style.display = 'block';
            } else if (method === 'card') {
                document.getElementById('cardSection').style.display = 'block';
                updateCardSectionUI();
            } else if (method === 'giftcard') {
                document.getElementById('giftcardSection').style.display = 'block';
            } else if (method === 'tab') {
                document.getElementById('tabSection').style.display = 'block';
            }
        }
        
        // Update card section based on Stripe Terminal connection status
        function updateCardSectionUI() {
            const titleEl = document.getElementById('cardSectionTitle');
            const descEl = document.getElementById('cardSectionDesc');
            const actionsEl = document.getElementById('stripeTerminalActions');
            const cardSection = document.getElementById('cardSection');
            
            if (connectedReader) {
                // Stripe Terminal connected
                titleEl.textContent = 'Stripe Terminal Connected';
                descEl.textContent = 'Click the button below to charge the card on your reader.';
                cardSection.style.background = '#ede7f6';
                cardSection.querySelector('i').style.color = '#635bff';
                actionsEl.style.display = 'block';
            } else if (localStorage.getItem('gc_stripe_pk')) {
                // Stripe configured but no reader connected
                titleEl.textContent = 'No Card Reader Connected';
                descEl.innerHTML = 'Connect a Stripe Terminal reader or process payment on your external terminal. <a href="#" onclick="showReaderSetup(); return false;" style="color:#1565c0;">Connect Reader</a>';
                cardSection.style.background = '#fff3e0';
                actionsEl.style.display = 'none';
            } else {
                // No Stripe configured - external terminal mode
                titleEl.textContent = 'Process on External Terminal';
                descEl.textContent = 'Complete the card payment on your card reader, then click "Complete Payment" to record the transaction.';
                cardSection.style.background = '#e3f2fd';
                actionsEl.style.display = 'none';
            }
        }
        
        // Initiate payment on Stripe Terminal
        let stripePaymentInProgress = false;
        
        async function initiateStripePayment() {
            if (stripePaymentInProgress) return;
            
            const btn = document.getElementById('stripePayBtn');
            const statusEl = document.getElementById('stripePaymentStatus');
            
            stripePaymentInProgress = true;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Waiting for card...';
            statusEl.style.display = 'block';
            statusEl.style.background = '#fff3e0';
            statusEl.innerHTML = '<i class="fas fa-hand-pointer"></i> Present card on reader...';
            
            const amountCents = Math.round(currentPayTotal * 100);
            const description = `Golf Cove POS - ${document.getElementById('customerSearch').value || 'Walk-In'}`;
            
            const result = await processStripeTerminalPayment(amountCents, description);
            
            if (result.success) {
                statusEl.style.background = '#e8f5e9';
                statusEl.innerHTML = '<i class="fas fa-check-circle" style="color:#27ae60;"></i> Payment successful!';
                btn.innerHTML = '<i class="fas fa-check"></i> Card Charged';
                btn.style.background = '#27ae60';
                
                // Auto-complete the payment
                setTimeout(() => {
                    completePaymentWithStripe(result.paymentIntentId);
                }, 1000);
            } else if (result.fallback) {
                // No reader - fall back to manual mode
                statusEl.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-credit-card"></i> Charge Card on Reader';
                btn.disabled = false;
                stripePaymentInProgress = false;
                showToast('No reader connected. Process on external terminal.', 'info');
            } else {
                statusEl.style.background = '#ffebee';
                statusEl.innerHTML = '<i class="fas fa-times-circle" style="color:#e74c3c;"></i> ' + (result.error || 'Payment failed');
                btn.innerHTML = '<i class="fas fa-redo"></i> Try Again';
                btn.disabled = false;
                stripePaymentInProgress = false;
            }
        }
        
        // Complete payment after successful Stripe charge
        function completePaymentWithStripe(paymentIntentId) {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const discountedSubtotal = subtotal - currentDiscount;
            const tax = discountedSubtotal * 0.0635;
            
            const cartItems = [...cart];
            transactions.unshift({
                id: 26763 + transactions.length,
                customer: document.getElementById('customerSearch').value || 'Walk-In',
                amount: currentPayTotal,
                subtotal: discountedSubtotal,
                tax: tax,
                items: cartItems,
                itemDetails: cartItems.map(i => ({ name: i.name, qty: i.qty, price: i.price, discount: i.discount || 0 })),
                itemCount: cart.reduce((sum, item) => sum + item.qty, 0),
                method: 'stripe',
                methodDisplay: 'Stripe Terminal',
                stripePaymentIntentId: paymentIntentId,
                time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                date: new Date().toISOString(),
                discount: currentDiscount,
                isReturn: false,
                register: localStorage.getItem('gc_register_id') || 'POS-1'
            });
            localStorage.setItem('gc_transactions', JSON.stringify(transactions));
            
            // Update customer stats
            const customerName = document.getElementById('customerSearch').value;
            if (customerName) {
                updateCustomerStats(customerName, currentPayTotal);
            }
            
            // Ask to print receipt
            if (confirm('Print receipt?')) {
                printReceipt(transactions[0]);
            }
            
            hideModal('payment');
            cart = [];
            currentDiscount = 0;
            stripePaymentInProgress = false;
            
            // Reset button state
            const btn = document.getElementById('stripePayBtn');
            btn.innerHTML = '<i class="fas fa-credit-card"></i> Charge Card on Reader';
            btn.style.background = '#635bff';
            btn.disabled = false;
            document.getElementById('stripePaymentStatus').style.display = 'none';
            
            renderCart();
            renderRecentTrans();
            showToast(`Payment of $${currentPayTotal.toFixed(2)} processed via Stripe Terminal!`, 'success');
        }
        
        function lookupGiftCard() {
            const code = document.getElementById('giftCardNumber').value.trim();
            if (!code) {
                showToast('Please enter a gift card code', 'error');
                return;
            }
            
            // Look up gift card from local storage
            const giftCards = JSON.parse(localStorage.getItem('gc_gift_cards') || '[]');
            const card = giftCards.find(gc => gc.code.toUpperCase() === code.toUpperCase());
            
            const infoDiv = document.getElementById('giftCardInfo');
            if (card) {
                if (card.balance <= 0) {
                    infoDiv.innerHTML = `<div style="color:#e74c3c;"><i class="fas fa-times-circle"></i> This gift card has no remaining balance.</div>`;
                } else if (card.balance < currentPayTotal) {
                    infoDiv.innerHTML = `
                        <div style="color:#f57c00;">
                            <i class="fas fa-exclamation-triangle"></i> <strong>Balance: $${card.balance.toFixed(2)}</strong><br>
                            <span style="font-size:12px;">This will cover $${card.balance.toFixed(2)} of the $${currentPayTotal.toFixed(2)} total. Remaining $${(currentPayTotal - card.balance).toFixed(2)} will need another payment method.</span>
                        </div>`;
                } else {
                    infoDiv.innerHTML = `<div style="color:#27ae60;"><i class="fas fa-check-circle"></i> <strong>Balance: $${card.balance.toFixed(2)}</strong> - Sufficient for this purchase!</div>`;
                }
                infoDiv.style.display = 'block';
            } else {
                infoDiv.innerHTML = `<div style="color:#e74c3c;"><i class="fas fa-times-circle"></i> Gift card not found. Please check the code.</div>`;
                infoDiv.style.display = 'block';
            }
        }
        
        function quickCash(amount) {
            if (amount === 'exact') {
                document.getElementById('cashTendered').value = currentPayTotal.toFixed(2);
            } else {
                document.getElementById('cashTendered').value = amount.toFixed(2);
            }
            calculateChange();
        }
        
        function calculateChange() {
            const tendered = parseFloat(document.getElementById('cashTendered').value) || 0;
            const changeSection = document.getElementById('changeSection');
            
            if (tendered >= currentPayTotal) {
                const change = tendered - currentPayTotal;
                document.getElementById('changeAmount').textContent = '$' + change.toFixed(2);
                changeSection.style.display = 'block';
            } else {
                changeSection.style.display = 'none';
            }
        }
        
        function completePayment() {
            // Validate based on payment method
            if (currentPayMethod === 'cash') {
                const tendered = parseFloat(document.getElementById('cashTendered').value) || 0;
                if (tendered < currentPayTotal) {
                    return showToast('Insufficient cash tendered', 'error');
                }
            }
            
            if (currentPayMethod === 'giftcard') {
                const code = document.getElementById('giftCardNumber').value.trim();
                if (!code) {
                    return showToast('Please enter a gift card code', 'error');
                }
                // Process gift card payment
                const giftCards = JSON.parse(localStorage.getItem('gc_gift_cards') || '[]');
                const cardIndex = giftCards.findIndex(gc => gc.code.toUpperCase() === code.toUpperCase());
                if (cardIndex === -1) {
                    return showToast('Gift card not found', 'error');
                }
                if (giftCards[cardIndex].balance <= 0) {
                    return showToast('Gift card has no balance', 'error');
                }
                // Deduct from gift card balance
                const amountToDeduct = Math.min(giftCards[cardIndex].balance, currentPayTotal);
                giftCards[cardIndex].balance -= amountToDeduct;
                giftCards[cardIndex].lastUsed = new Date().toISOString();
                localStorage.setItem('gc_gift_cards', JSON.stringify(giftCards));
                
                if (amountToDeduct < currentPayTotal) {
                    showToast(`Gift card covered $${amountToDeduct.toFixed(2)}. Remaining $${(currentPayTotal - amountToDeduct).toFixed(2)} needed.`, 'warning');
                }
            }
            
            if (currentPayMethod === 'tab') {
                // Add to customer's tab instead of completing payment
                const customerName = document.getElementById('customerSearch').value;
                if (!customerName) {
                    return showToast('Please select a customer to add to tab', 'error');
                }
                addToTabFromCart(customerName);
                hideModal('payment');
                return;
            }
            
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const discountedSubtotal = subtotal - currentDiscount;
            const tax = discountedSubtotal * 0.0635;
            
            // Friendly method names for display
            const methodNames = {
                'card': 'Card (External Terminal)',
                'cash': 'Cash',
                'giftcard': 'Gift Card',
                'tab': 'Tab'
            };
            
            const cartItems = [...cart];
            transactions.unshift({
                id: 26763 + transactions.length,
                customer: document.getElementById('customerSearch').value || 'Walk-In',
                amount: currentPayTotal,
                subtotal: discountedSubtotal,
                tax: tax,
                items: cartItems,
                itemDetails: cartItems.map(i => ({ name: i.name, qty: i.qty, price: i.price, discount: i.discount || 0 })),
                itemCount: cart.reduce((sum, item) => sum + item.qty, 0),
                method: currentPayMethod,
                methodDisplay: methodNames[currentPayMethod] || currentPayMethod,
                time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                date: new Date().toISOString(),
                discount: currentDiscount,
                isReturn: false,
                register: localStorage.getItem('gc_register_id') || 'POS-1',
                giftCardCode: currentPayMethod === 'giftcard' ? document.getElementById('giftCardNumber').value.trim() : null
            });
            localStorage.setItem('gc_transactions', JSON.stringify(transactions));
            
            // Update customer stats
            const customerName = document.getElementById('customerSearch').value;
            if (customerName) {
                updateCustomerStats(customerName, currentPayTotal);
            }
            
            // Ask to print receipt
            if (confirm('Print receipt?')) {
                printReceipt(transactions[0]);
            }
            
            hideModal('payment');
            cart = [];
            currentDiscount = 0;
            renderCart();
            renderRecentTrans();
            showToast(`Payment of $${currentPayTotal.toFixed(2)} processed via ${methodNames[currentPayMethod] || currentPayMethod}!`, 'success');
        }
        
        function addToTabFromCart(customerName) {
            // Find or create tab for customer
            let tab = openTabs.find(t => t.customer.toLowerCase() === customerName.toLowerCase());
            if (!tab) {
                tab = {
                    id: Date.now(),
                    customer: customerName,
                    items: [],
                    total: 0,
                    created: new Date().toISOString()
                };
                openTabs.push(tab);
            }
            
            // Add cart items to tab
            cart.forEach(item => {
                const existingItem = tab.items.find(i => i.name === item.name && i.price === item.price);
                if (existingItem) {
                    existingItem.qty += item.qty;
                } else {
                    tab.items.push({...item});
                }
            });
            
            // Recalculate tab total
            tab.total = tab.items.reduce((sum, item) => sum + (item.price * item.qty), 0);
            localStorage.setItem('gc_tabs', JSON.stringify(openTabs));
            
            cart = [];
            currentDiscount = 0;
            renderCart();
            renderTabs();
            showToast(`Items added to ${customerName}'s tab!`, 'success');
        }
        
        function printReceipt(transaction) {
            const receiptWindow = window.open('', '_blank', 'width=400,height=600');
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            
            const itemsHtml = transaction.items ? transaction.items.map(item => 
                '<tr><td style="padding:5px 0;">' + item.name + '</td><td style="padding:5px 0;text-align:center;">' + item.qty + '</td><td style="padding:5px 0;text-align:right;">$' + (item.price * item.qty).toFixed(2) + '</td></tr>'
            ).join('') : '<tr><td colspan="3">Items not recorded</td></tr>';
            
            const subtotal = transaction.items ? transaction.items.reduce((sum, i) => sum + i.price * i.qty, 0) : transaction.amount / 1.0635;
            const discount = transaction.discount || 0;
            const discountedSubtotal = subtotal - discount;
            const tax = discountedSubtotal * 0.0635;
            
            const discountHtml = discount > 0 ? '<div style="color:green;"><span>Discount:</span><span>-$' + discount.toFixed(2) + '</span></div>' : '';
            
            const receiptHtml = '<!DOCTYPE html><html><head><title>Receipt #' + transaction.id + '</title>' +
                '<style>body { font-family: "Courier New", monospace; padding: 20px; max-width: 300px; margin: 0 auto; font-size: 12px; }' +
                '.header { text-align: center; margin-bottom: 20px; } .header h1 { font-size: 18px; margin: 0; } .header p { margin: 5px 0; color: #666; }' +
                '.divider { border-top: 1px dashed #333; margin: 10px 0; } table { width: 100%; }' +
                '.totals { margin-top: 10px; } .totals div { display: flex; justify-content: space-between; padding: 3px 0; }' +
                '.totals .total { font-weight: bold; font-size: 14px; border-top: 1px solid #333; padding-top: 5px; margin-top: 5px; }' +
                '.footer { text-align: center; margin-top: 20px; font-size: 11px; color: #666; }' +
                '@media print { body { padding: 0; } }</style></head><body>' +
                '<div class="header"><h1>GOLF COVE</h1><p>Indoor Golf & Bar</p><p>' + dateStr + ' ' + transaction.time + '</p><p>Receipt #' + transaction.id + '</p></div>' +
                '<div class="divider"></div><p><strong>Customer:</strong> ' + transaction.customer + '</p><div class="divider"></div>' +
                '<table><thead><tr><th style="text-align:left;">Item</th><th style="text-align:center;">Qty</th><th style="text-align:right;">Price</th></tr></thead>' +
                '<tbody>' + itemsHtml + '</tbody></table><div class="divider"></div>' +
                '<div class="totals"><div><span>Subtotal:</span><span>$' + subtotal.toFixed(2) + '</span></div>' + discountHtml +
                '<div><span>Tax (6.35%):</span><span>$' + tax.toFixed(2) + '</span></div>' +
                '<div class="total"><span>TOTAL:</span><span>$' + transaction.amount.toFixed(2) + '</span></div>' +
                '<div><span>Method:</span><span>' + (transaction.method || 'Card') + '</span></div></div>' +
                '<div class="divider"></div><div class="footer"><p>Thank you for visiting Golf Cove!</p><p>www.golfcove.com</p></div>' +
                '<scr' + 'ipt>window.print(); setTimeout(function() { window.close(); }, 500);</scr' + 'ipt>' +
                '</bo' + 'dy></ht' + 'ml>';
            
            receiptWindow.document.write(receiptHtml);
            receiptWindow.document.close();
        }

        function filterItems(category, el) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            if (el) el.classList.add('active');
            renderSalesItems(category);
        }
        
        function suspendSale() {
            if (cart.length === 0) return showToast('Cart is empty', 'error');
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const total = subtotal * 1.0635;
            const suspended = JSON.parse(localStorage.getItem('gc_suspended') || '[]');
            suspended.push({
                id: Date.now(),
                customer: document.getElementById('customerSearch').value || 'No Customer',
                amount: total,
                items: [...cart]
            });
            localStorage.setItem('gc_suspended', JSON.stringify(suspended));
            cart = [];
            currentDiscount = 0;
            renderCart();
            renderSuspendedSales();
            showToast('Sale suspended');
        }
        
        function resumeSale(id) {
            const suspended = JSON.parse(localStorage.getItem('gc_suspended') || '[]');
            const sale = suspended.find(s => s.id === id);
            if (sale && sale.items) {
                cart = [...sale.items];
                renderCart();
                // Remove from suspended
                localStorage.setItem('gc_suspended', JSON.stringify(suspended.filter(s => s.id !== id)));
                renderSuspendedSales();
                showToast('Sale resumed');
            }
        }
        
        function showToast(message, type = 'success') {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ============ BOOKING FUNCTIONS ============
        function createBooking(e) {
            e.preventDefault();
            
            // Convert 24h time to 12h format for tee sheet
            const timeValue = document.getElementById('bookingTime').value;
            const hour = parseInt(timeValue.split(':')[0]);
            const displayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
            const ampm = hour >= 12 ? 'pm' : 'am';
            const timeString = displayHour + ':00' + ampm;
            
            // Check for booking conflict
            const room = parseInt(document.getElementById('bookingRoom').value);
            const existingBooking = bookings.find(b => b.room === room && b.time === timeString && b.id !== window.rescheduleFromId);
            if (existingBooking) {
                showToast('Time slot already booked!', 'error');
                return;
            }
            
            const customerName = document.getElementById('bookingCustomer').value;
            const phone = document.getElementById('bookingPhone').value || '';
            const email = document.getElementById('bookingEmail') ? document.getElementById('bookingEmail').value : '';
            
            // Save customer to database
            saveCustomer(customerName, phone, email);
            
            const booking = {
                id: Date.now(), // Use timestamp for unique ID
                room: room,
                time: timeString,
                customer: customerName,
                players: parseInt(document.getElementById('bookingPlayers').value),
                duration: parseInt(document.getElementById('bookingDuration').value),
                phone: phone,
                email: email,
                notes: document.getElementById('bookingNotes').value || '',
                createdAt: new Date().toISOString()
            };
            
            // If rescheduling, remove old booking
            if (window.rescheduleFromId) {
                bookings = bookings.filter(b => b.id !== window.rescheduleFromId);
                window.rescheduleFromId = null;
                showToast('Booking rescheduled for ' + booking.customer);
            } else {
                showToast('Booking created for ' + booking.customer);
            }
            
            bookings.push(booking);
            localStorage.setItem('gc_bookings', JSON.stringify(bookings));
            hideModal('booking');
            renderTeeSheet();
            
            // Add rental to cart
            const prices = { 1: 45, 2: 80, 3: 110 };
            addToCart(`Room ${booking.room} - ${booking.duration}hr`, prices[booking.duration]);
            
            // Offer email confirmation
            if (email && confirm('Send confirmation email to ' + email + '?')) {
                sendConfirmationEmail(booking);
            }
            
            e.target.reset();
        }
        
        function sendConfirmationEmail(booking) {
            // In production, this would call an API
            const subject = encodeURIComponent('Golf Cove Booking Confirmation');
            const body = encodeURIComponent(
                `Hi ${booking.customer},\n\n` +
                `Your booking at Golf Cove is confirmed!\n\n` +
                `Details:\n` +
                `- Room: Room ${booking.room}\n` +
                `- Date: ${currentDate.toLocaleDateString()}\n` +
                `- Time: ${booking.time}\n` +
                `- Duration: ${booking.duration} hour(s)\n` +
                `- Players: ${booking.players}\n\n` +
                `See you soon!\n` +
                `Golf Cove Team`
            );
            window.open(`mailto:${booking.email}?subject=${subject}&body=${body}`);
            showToast('Confirmation email opened', 'success');
        }

        function quickBook(room, time) {
            document.getElementById('bookingRoom').value = room;
            // Convert 12h time to 24h for the select input
            const isPM = time.toLowerCase().includes('pm');
            let hour = parseInt(time);
            if (isPM && hour !== 12) hour += 12;
            if (!isPM && hour === 12) hour = 0;
            const timeValue = hour.toString().padStart(2, '0') + ':00';
            document.getElementById('bookingTime').value = timeValue;
            showModal('booking');
        }

        function selectBooking(id) {
            const booking = bookings.find(b => b.id === id);
            if (booking) {
                selectedBookingId = id;
                document.getElementById('detailCustomer').textContent = booking.customer;
                document.getElementById('detailRoom').textContent = 'Room ' + booking.room;
                document.getElementById('detailTime').textContent = booking.time;
                document.getElementById('detailDuration').textContent = booking.duration + ' hour(s)';
                document.getElementById('detailPlayers').textContent = booking.players + ' player(s)';
                showModal('bookingDetail');
            }
        }
        
        function deleteBooking() {
            if (!selectedBookingId) return;
            bookings = bookings.filter(b => b.id !== selectedBookingId);
            localStorage.setItem('gc_bookings', JSON.stringify(bookings));
            hideModal('bookingDetail');
            renderTeeSheet();
            showToast('Booking cancelled');
            selectedBookingId = null;
        }
        
        function checkInBooking() {
            if (!selectedBookingId) return;
            const booking = bookings.find(b => b.id === selectedBookingId);
            if (booking) {
                booking.checkedIn = true;
                booking.checkedInAt = new Date().toISOString();
                localStorage.setItem('gc_bookings', JSON.stringify(bookings));
                hideModal('bookingDetail');
                renderTeeSheet();
                updateStats();
                showToast(booking.customer + ' checked in!');
            }
            selectedBookingId = null;
        }
        
        function markNoShow() {
            if (!selectedBookingId) return;
            const booking = bookings.find(b => b.id === selectedBookingId);
            if (!booking) return;
            
            if (!confirm(`Mark ${booking.customer} as No Show?\n\nThis will record the no-show and free up the slot.`)) return;
            
            booking.noShow = true;
            booking.noShowAt = new Date().toISOString();
            
            // Update customer no-show count
            const customers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
            const customer = customers.find(c => `${c.firstName} ${c.lastName}`.toLowerCase() === booking.customer.toLowerCase());
            if (customer) {
                customer.noShowCount = (customer.noShowCount || 0) + 1;
                localStorage.setItem('gc_customers', JSON.stringify(customers));
            }
            
            // Remove from bookings
            bookings = bookings.filter(b => b.id !== selectedBookingId);
            localStorage.setItem('gc_bookings', JSON.stringify(bookings));
            
            // Update stats
            const noShowCount = parseInt(document.getElementById('statNoShows').textContent) + 1;
            document.getElementById('statNoShows').textContent = noShowCount;
            
            hideModal('bookingDetail');
            renderTeeSheet();
            showToast(`${booking.customer} marked as No Show`, 'error');
            selectedBookingId = null;
        }
        
        function rescheduleBooking() {
            if (!selectedBookingId) return;
            const booking = bookings.find(b => b.id === selectedBookingId);
            if (!booking) return;
            
            hideModal('bookingDetail');
            
            // Pre-fill booking form with existing data
            document.getElementById('bookingCustomer').value = booking.customer;
            document.getElementById('bookingRoom').value = booking.room;
            document.getElementById('bookingDuration').value = booking.duration;
            document.getElementById('bookingPlayers').value = booking.players;
            if (booking.phone) document.getElementById('bookingPhone').value = booking.phone;
            if (booking.notes) document.getElementById('bookingNotes').value = booking.notes;
            
            // Store original booking ID to delete after rescheduling
            window.rescheduleFromId = selectedBookingId;
            
            showModal('booking');
            showToast('Select new date/time for ' + booking.customer, 'success');
        }

        // ============ TAB FUNCTIONS ============
        function createTab(e) {
            e.preventDefault();
            const tableValue = document.getElementById('tabTable').value;
            
            // Check if table already has a tab
            const existingTab = openTabs.find(t => t.table === tableValue && tableValue !== 'Tab');
            if (existingTab) {
                showToast('This table already has an open tab!', 'error');
                return;
            }
            
            openTabs.push({
                id: Date.now(), // Use timestamp for unique ID
                customer: document.getElementById('tabCustomer').value,
                employee: 'GC TABS',
                amount: 0,
                subtotal: 0,
                items: [],
                table: tableValue,
                createdAt: new Date().toISOString()
            });
            localStorage.setItem('gc_tabs', JSON.stringify(openTabs));
            hideModal('newTab');
            renderOpenTabs();
            renderFloorPlan(); // Update floor plan to show new tab
            showToast('Tab created for ' + document.getElementById('tabCustomer').value);
            e.target.reset();
        }

        function selectTab(id) {
            const tab = openTabs.find(t => t.id === id);
            if (tab) {
                selectedTabId = id;
                document.getElementById('tabDetailId').textContent = tab.id;
                document.getElementById('tabDetailCustomer').textContent = tab.customer;
                document.getElementById('tabDetailTable').textContent = tab.table;
                
                // Calculate subtotal and tax
                const subtotal = tab.subtotal || (tab.amount / 1.0635);
                const tax = subtotal * 0.0635;
                
                // Update detail fields if they exist
                const subtotalEl = document.getElementById('tabDetailSubtotal');
                const taxEl = document.getElementById('tabDetailTax');
                if (subtotalEl) subtotalEl.textContent = '$' + subtotal.toFixed(2);
                if (taxEl) taxEl.textContent = '$' + tax.toFixed(2);
                document.getElementById('tabDetailAmount').textContent = '$' + tab.amount.toFixed(2);
                
                // Render items list
                const itemsListEl = document.getElementById('tabItemsList');
                if (itemsListEl) {
                    if (tab.items && tab.items.length > 0) {
                        itemsListEl.innerHTML = tab.items.map(item => `
                            <div style="display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid #eee;">
                                <span>${item.qty}x ${item.name}</span>
                                <span>$${(item.price * item.qty).toFixed(2)}</span>
                            </div>
                        `).join('');
                    } else {
                        itemsListEl.innerHTML = '<div style="color:#999;text-align:center;">No items on this tab yet</div>';
                    }
                }
                
                showModal('tabDetail');
            }
        }
        
        function closeTab() {
            if (!selectedTabId) return;
            const tab = openTabs.find(t => t.id === selectedTabId);
            if (tab && tab.amount > 0) {
                const subtotal = tab.subtotal || (tab.amount / 1.0635);
                const tax = tab.amount - subtotal;
                const tabItems = tab.items || [];
                // Add to transactions
                transactions.unshift({
                    id: 26763 + transactions.length,
                    customer: tab.customer,
                    amount: tab.amount,
                    subtotal: subtotal,
                    tax: tax,
                    items: tabItems,
                    itemDetails: tabItems.map(i => ({ name: i.name, qty: i.qty, price: i.price, discount: i.discount || 0 })),
                    itemCount: tabItems.reduce((sum, i) => sum + i.qty, 0),
                    method: 'tab',
                    time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                    date: new Date().toISOString(),
                    discount: 0,
                    isReturn: false,
                    register: localStorage.getItem('gc_register_id') || 'POS-1'
                });
                localStorage.setItem('gc_transactions', JSON.stringify(transactions));
                
                // Update customer stats
                updateCustomerStats(tab.customer, tab.amount);
                
                showToast(`Tab closed - $${tab.amount.toFixed(2)} charged`, 'success');
            } else {
                showToast('Tab closed (no charges)', 'success');
            }
            openTabs = openTabs.filter(t => t.id !== selectedTabId);
            localStorage.setItem('gc_tabs', JSON.stringify(openTabs));
            hideModal('tabDetail');
            renderOpenTabs();
            renderFloorPlan(); // Update floor plan to show table is now available
            renderRecentTrans();
            selectedTabId = null;
        }
        
        function addToTabFromCurrent() {
            if (!selectedTabId) return showToast('No tab selected', 'error');
            if (cart.length === 0) return showToast('Add items to cart first', 'error');
            
            const tab = openTabs.find(t => t.id === selectedTabId);
            if (tab) {
                const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
                const cartTax = cartTotal * 0.0635;
                
                // Add items to tab
                if (!tab.items) tab.items = [];
                cart.forEach(cartItem => {
                    const existing = tab.items.find(i => i.name === cartItem.name);
                    if (existing) {
                        existing.qty += cartItem.qty;
                    } else {
                        tab.items.push({ ...cartItem });
                    }
                });
                
                tab.subtotal = (tab.subtotal || 0) + cartTotal;
                tab.amount += cartTotal + cartTax;
                localStorage.setItem('gc_tabs', JSON.stringify(openTabs));
                
                const itemCount = cart.reduce((sum, i) => sum + i.qty, 0);
                cart = [];
                currentDiscount = 0;
                renderCart();
                hideModal('tabDetail');
                renderOpenTabs();
                renderFloorPlan(); // Update floor plan to show updated tab amount
                showToast(`${itemCount} item${itemCount > 1 ? 's' : ''} ($${(cartTotal + cartTax).toFixed(2)}) added to ${tab.customer}'s tab`);
            }
            selectedTabId = null;
        }

        function selectTable(id) {
            const tab = openTabs.find(t => t.table === `Table ${id}`);
            if (tab) {
                selectTab(tab.id);
            } else {
                // Create new tab for this table
                document.getElementById('tabTable').value = `Table ${id}`;
                showModal('newTab');
            }
        }

        // ============ NAVIGATION ============
        function showPage(page, el) {
            document.querySelectorAll('.page-content').forEach(p => p.style.display = 'none');
            document.getElementById('page-' + page).style.display = 'block';
            document.querySelectorAll('.header-nav a').forEach(a => a.classList.remove('active'));
            if (el) el.classList.add('active');
        }

        function switchFnbTab(tab, el) {
            document.querySelectorAll('.fnb-tab').forEach(t => t.classList.remove('active'));
            if (el) el.classList.add('active');
            // Could switch between different floor layouts in the future
            showToast(`Viewing ${tab === 'lounge' ? 'Golf Cove Lounge' : 'Golf Cove Rooms'}`);
        }

        function showModal(name) {
            document.getElementById('modal-' + name).classList.add('active');
            if (name === 'booking') document.getElementById('bookingDate').valueAsDate = new Date();
        }

        function hideModal(name) {
            document.getElementById('modal-' + name).classList.remove('active');
        }

        // ============ DATE FUNCTIONS ============
        function changeDate(delta) {
            currentDate.setDate(currentDate.getDate() + delta);
            selectedDate = currentDate.toISOString().split('T')[0];
            updateDateDisplay();
            renderTeeSheet();
        }

        function goToToday() {
            currentDate = new Date();
            selectedDate = currentDate.toISOString().split('T')[0];
            updateDateDisplay();
            renderTeeSheet();
            showToast('Viewing today');
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        function selectDate(day) {
            currentDate.setDate(day);
            selectedDate = currentDate.toISOString().split('T')[0];
            updateDateDisplay();
            renderTeeSheet(); // Re-render tee sheet for selected date
            showToast(`Viewing ${currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`);
        }

        function updateDateDisplay() {
            document.getElementById('currentDateDisplay').textContent = currentDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            renderCalendar();
        }

        function updateStats() {
            document.getElementById('statBookings').textContent = bookings.length;
            document.getElementById('statOccupancy').textContent = Math.round((bookings.length / (rooms.length * timeSlots.length)) * 100) + '%';
            const checkedIn = bookings.filter(b => b.checkedIn).length;
            document.getElementById('statCheckedIn').textContent = checkedIn;
            const revenue = bookings.reduce((sum, b) => sum + (b.duration === 1 ? 45 : b.duration === 2 ? 80 : 110), 0);
            document.getElementById('statRevenue').textContent = '$' + revenue.toFixed(2);
        }
        
        function resetDemoData() {
            if (!confirm('Reset all data to demo defaults? This cannot be undone.')) return;
            localStorage.removeItem('gc_bookings');
            localStorage.removeItem('gc_tabs');
            localStorage.removeItem('gc_transactions');
            localStorage.removeItem('gc_suspended');
            location.reload();
        }

        // ============ INIT ============
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.classList.remove('active'); });
        });
        
        // Global Search Function
        function performGlobalSearch(query) {
            const resultsDiv = document.getElementById('globalSearchResults');
            if (!query || query.length < 2) {
                resultsDiv.innerHTML = '<div style="text-align:center;color:#999;padding:40px;"><i class="fas fa-search" style="font-size:40px;margin-bottom:10px;display:block;"></i>Start typing to search...</div>';
                return;
            }
            
            const q = query.toLowerCase();
            const customers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
            let html = '';
            
            // Search customers
            const matchedCustomers = customers.filter(c => 
                `${c.firstName} ${c.lastName}`.toLowerCase().includes(q) ||
                (c.email && c.email.toLowerCase().includes(q)) ||
                (c.phone && c.phone.includes(q))
            ).slice(0, 5);
            
            if (matchedCustomers.length > 0) {
                html += '<div style="padding:8px 12px;background:#f0f2f5;font-weight:600;font-size:12px;text-transform:uppercase;color:#666;"><i class="fas fa-users"></i> Customers</div>';
                matchedCustomers.forEach(c => {
                    const isMember = c.isMember;
                    html += `<div style="padding:12px;border-bottom:1px solid #eee;cursor:pointer;display:flex;align-items:center;gap:12px;" onclick="goToCustomer(${c.id})">
                        <div style="width:40px;height:40px;background:#4a90a4;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;">${c.firstName.charAt(0)}${c.lastName.charAt(0)}</div>
                        <div style="flex:1;">
                            <div style="font-weight:600;">${c.firstName} ${c.lastName} ${isMember ? '<span style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-size:9px;padding:2px 5px;border-radius:8px;">MEMBER</span>' : ''}</div>
                            <div style="font-size:12px;color:#999;">${c.email || ''} ${c.phone ? '· ' + c.phone : ''}</div>
                        </div>
                        <i class="fas fa-arrow-right" style="color:#ccc;"></i>
                    </div>`;
                });
            }
            
            // Search bookings
            const matchedBookings = bookings.filter(b => 
                b.customer.toLowerCase().includes(q) ||
                b.time.toLowerCase().includes(q)
            ).slice(0, 5);
            
            if (matchedBookings.length > 0) {
                html += '<div style="padding:8px 12px;background:#f0f2f5;font-weight:600;font-size:12px;text-transform:uppercase;color:#666;"><i class="fas fa-calendar"></i> Bookings</div>';
                matchedBookings.forEach(b => {
                    const room = rooms.find(r => r.id === b.room);
                    html += `<div style="padding:12px;border-bottom:1px solid #eee;cursor:pointer;display:flex;align-items:center;gap:12px;" onclick="selectBooking(${b.id}); hideModal('lookup');">
                        <div style="width:40px;height:40px;background:#27ae60;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;"><i class="fas fa-golf-ball"></i></div>
                        <div style="flex:1;">
                            <div style="font-weight:600;">${b.customer}</div>
                            <div style="font-size:12px;color:#999;">${room ? room.name : 'Bay ' + b.room} · ${b.time} · ${b.players} players</div>
                        </div>
                        <i class="fas fa-arrow-right" style="color:#ccc;"></i>
                    </div>`;
                });
            }
            
            // Search transactions
            const matchedTrans = transactions.filter(t =>
                t.customer.toLowerCase().includes(q) ||
                t.id.toString().includes(q)
            ).slice(0, 5);
            
            if (matchedTrans.length > 0) {
                html += '<div style="padding:8px 12px;background:#f0f2f5;font-weight:600;font-size:12px;text-transform:uppercase;color:#666;"><i class="fas fa-receipt"></i> Transactions</div>';
                matchedTrans.forEach(t => {
                    html += `<div style="padding:12px;border-bottom:1px solid #eee;display:flex;align-items:center;gap:12px;">
                        <div style="width:40px;height:40px;background:#3498db;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;"><i class="fas fa-receipt"></i></div>
                        <div style="flex:1;">
                            <div style="font-weight:600;">#${t.id} - ${t.customer}</div>
                            <div style="font-size:12px;color:#999;">${t.time} · $${t.amount.toFixed(2)}</div>
                        </div>
                    </div>`;
                });
            }
            
            if (!html) {
                html = '<div style="text-align:center;color:#999;padding:40px;"><i class="fas fa-search" style="font-size:40px;margin-bottom:10px;display:block;opacity:0.3;"></i>No results found</div>';
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function goToCustomer(id) {
            hideModal('lookup');
            window.location.href = `customers.html?id=${id}`;
        }

        // Update clock every second
        function updateClock() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
        }
        updateClock();
        setInterval(updateClock, 1000);

        // Customer search with autocomplete using customer database
        const customerSearch = document.getElementById('customerSearch');
        
        // Create autocomplete dropdown
        const autocompleteDiv = document.createElement('div');
        autocompleteDiv.id = 'customerAutocomplete';
        autocompleteDiv.style.cssText = 'position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;border-radius:0 0 8px 8px;max-height:200px;overflow-y:auto;z-index:100;display:none;box-shadow:0 4px 12px rgba(0,0,0,0.15);';
        customerSearch.parentElement.style.position = 'relative';
        customerSearch.parentElement.appendChild(autocompleteDiv);
        
        customerSearch.addEventListener('input', function() {
            const val = this.value.toLowerCase().trim();
            if (val.length < 2) {
                autocompleteDiv.style.display = 'none';
                return;
            }
            
            const allCustomers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
            const matches = allCustomers.filter(c => {
                const fullName = `${c.firstName} ${c.lastName}`.toLowerCase();
                return fullName.includes(val) || (c.email && c.email.toLowerCase().includes(val));
            }).slice(0, 8);
            
            if (matches.length === 0) {
                autocompleteDiv.style.display = 'none';
                return;
            }
            
            autocompleteDiv.innerHTML = matches.map(c => {
                const isMember = c.isMember && c.memberExpires && new Date(c.memberExpires) > new Date();
                return `
                    <div style="padding:10px 15px;cursor:pointer;display:flex;align-items:center;gap:10px;border-bottom:1px solid #eee;" 
                         onmouseover="this.style.background='#f5f6fa'" 
                         onmouseout="this.style.background='#fff'"
                         onclick="selectCustomerFromSearch('${c.firstName} ${c.lastName}', ${c.isMember})">
                        <div style="width:32px;height:32px;border-radius:50%;background:${isMember ? 'linear-gradient(135deg, #f1c40f, #e67e22)' : '#4a90a4'};color:#fff;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:12px;">
                            ${(c.firstName[0] || '') + (c.lastName[0] || '')}
                        </div>
                        <div style="flex:1;">
                            <div style="font-weight:600;color:#333;display:flex;align-items:center;gap:6px;">
                                ${c.firstName} ${c.lastName}
                                ${isMember ? '<span style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-size:10px;padding:2px 6px;border-radius:10px;font-weight:700;">MEMBER</span>' : ''}
                            </div>
                            <div style="font-size:12px;color:#999;">${c.email || c.phone || 'No contact'}</div>
                        </div>
                    </div>
                `;
            }).join('');
            autocompleteDiv.style.display = 'block';
        });
        
        customerSearch.addEventListener('blur', function() {
            setTimeout(() => { autocompleteDiv.style.display = 'none'; }, 200);
        });
        
        function selectCustomerFromSearch(name, isMember) {
            customerSearch.value = name;
            autocompleteDiv.style.display = 'none';
            if (isMember) {
                showToast(`Member: ${name}`, 'success');
            }
        }
        
        // Booking customer autocomplete
        const bookingCustomerInput = document.getElementById('bookingCustomer');
        const bookingAutocomplete = document.getElementById('bookingCustomerAutocomplete');
        
        bookingCustomerInput.addEventListener('input', function() {
            const val = this.value.toLowerCase().trim();
            if (val.length < 2) {
                bookingAutocomplete.style.display = 'none';
                return;
            }
            
            const allCustomers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
            const matches = allCustomers.filter(c => {
                const fullName = `${c.firstName} ${c.lastName}`.toLowerCase();
                return fullName.includes(val);
            }).slice(0, 6);
            
            if (matches.length === 0) {
                bookingAutocomplete.style.display = 'none';
                return;
            }
            
            bookingAutocomplete.innerHTML = matches.map(c => {
                const isMember = c.isMember && c.memberExpires && new Date(c.memberExpires) > new Date();
                return `
                    <div style="padding:10px 12px;cursor:pointer;display:flex;align-items:center;gap:10px;border-bottom:1px solid #eee;" 
                         onmouseover="this.style.background='#f5f6fa'" 
                         onmouseout="this.style.background='#fff'"
                         onclick="selectBookingCustomer('${c.firstName} ${c.lastName}', ${isMember})">
                        <div style="width:28px;height:28px;border-radius:50%;background:${isMember ? 'linear-gradient(135deg, #f1c40f, #e67e22)' : '#4a90a4'};color:#fff;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:11px;">
                            ${(c.firstName[0] || '') + (c.lastName[0] || '')}
                        </div>
                        <div style="flex:1;">
                            <div style="font-weight:600;color:#333;font-size:13px;display:flex;align-items:center;gap:6px;">
                                ${c.firstName} ${c.lastName}
                                ${isMember ? '<span style="background:linear-gradient(135deg,#f1c40f,#e67e22);color:#fff;font-size:9px;padding:2px 5px;border-radius:8px;font-weight:700;">MEMBER</span>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            bookingAutocomplete.style.display = 'block';
        });
        
        bookingCustomerInput.addEventListener('blur', function() {
            setTimeout(() => { bookingAutocomplete.style.display = 'none'; }, 200);
        });
        
        function selectBookingCustomer(name, isMember) {
            bookingCustomerInput.value = name;
            bookingAutocomplete.style.display = 'none';
            if (isMember) {
                showToast(`Member selected: ${name}`, 'success');
            }
        }

        renderTeeSheet();
        renderFloorPlan();
        renderOpenTabs();
        renderCart();
        renderRecentTrans();
        renderSuspendedSales();
        renderCalendar();
        renderSalesItems();
        updateDateDisplay();
        updateDailySummary();
        loadDailyNotes();
        
        // Update daily summary every 30 seconds
        setInterval(updateDailySummary, 30000);
        
        // Daily Summary Functions
        function updateDailySummary() {
            const today = new Date().toDateString();
            const todaysTrans = transactions.filter(t => new Date(t.date || Date.now()).toDateString() === today);
            const todaysSales = todaysTrans.reduce((sum, t) => sum + t.amount, 0);
            const openTabCount = openTabs.length;
            
            document.getElementById('summaryTodaySales').textContent = '$' + todaysSales.toFixed(2);
            document.getElementById('summaryTodayTrans').textContent = todaysTrans.length;
            document.getElementById('summaryOpenTabs').textContent = openTabCount;
        }
        
        function saveDailyNotes() {
            const notes = document.getElementById('dailyNotes').value;
            const today = new Date().toDateString();
            localStorage.setItem('gc_daily_notes_' + today, notes);
        }
        
        function loadDailyNotes() {
            const today = new Date().toDateString();
            const notes = localStorage.getItem('gc_daily_notes_' + today) || '';
            document.getElementById('dailyNotes').value = notes;
        }
        
        // Check for quickbook customer from customers page
        const quickbookCustomer = localStorage.getItem('gc_quickbook_customer');
        if (quickbookCustomer) {
            try {
                const customer = JSON.parse(quickbookCustomer);
                document.getElementById('bookingCustomer').value = `${customer.firstName} ${customer.lastName}`;
                showModal('booking');
                showToast(`Creating booking for ${customer.firstName} ${customer.lastName}`);
            } catch (e) {}
            localStorage.removeItem('gc_quickbook_customer');
        }
        
        // Show welcome toast on load
        setTimeout(() => showToast('POS System Ready', 'success'), 500);
        
        // ============ DATA IMPORT/EXPORT FOR TEE SHEET ============
        function showDataImportModal() {
            const html = `
                <div id="dataImportModal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;">
                    <div style="background:#fff;padding:25px;border-radius:12px;max-width:800px;width:95%;max-height:90vh;overflow-y:auto;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                            <h3 style="margin:0;"><i class="fas fa-database"></i> Import/Export Data</h3>
                            <button onclick="closeDataImportModal()" style="border:none;background:none;font-size:24px;cursor:pointer;color:#999;">&times;</button>
                        </div>
                        
                        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));gap:15px;margin-bottom:20px;">
                            <div onclick="selectImportType('bookings')" class="import-card" id="import-bookings" style="padding:20px;border:2px solid #ddd;border-radius:10px;text-align:center;cursor:pointer;transition:all 0.2s;">
                                <i class="fas fa-calendar-alt" style="font-size:30px;color:#27ae60;margin-bottom:10px;display:block;"></i>
                                <strong>Bookings</strong>
                                <div style="font-size:11px;color:#666;">Tee times, reservations</div>
                            </div>
                            <div onclick="selectImportType('customers')" class="import-card" id="import-customers" style="padding:20px;border:2px solid #ddd;border-radius:10px;text-align:center;cursor:pointer;transition:all 0.2s;">
                                <i class="fas fa-users" style="font-size:30px;color:#3498db;margin-bottom:10px;display:block;"></i>
                                <strong>Customers</strong>
                                <div style="font-size:11px;color:#666;">Customer database</div>
                            </div>
                            <div onclick="selectImportType('members')" class="import-card" id="import-members" style="padding:20px;border:2px solid #ddd;border-radius:10px;text-align:center;cursor:pointer;transition:all 0.2s;">
                                <i class="fas fa-id-card" style="font-size:30px;color:#f1c40f;margin-bottom:10px;display:block;"></i>
                                <strong>Members</strong>
                                <div style="font-size:11px;color:#666;">Membership data</div>
                            </div>
                            <div onclick="selectImportType('transactions')" class="import-card" id="import-transactions" style="padding:20px;border:2px solid #ddd;border-radius:10px;text-align:center;cursor:pointer;transition:all 0.2s;">
                                <i class="fas fa-receipt" style="font-size:30px;color:#9b59b6;margin-bottom:10px;display:block;"></i>
                                <strong>Transactions</strong>
                                <div style="font-size:11px;color:#666;">Historical sales</div>
                            </div>
                        </div>
                        
                        <div id="importUploadSection" style="display:none;">
                            <div style="border:2px dashed #ccc;border-radius:10px;padding:40px;text-align:center;margin-bottom:15px;background:#fafafa;" 
                                 ondrop="handleImportFileDrop(event)" ondragover="event.preventDefault();this.style.borderColor='#27ae60';this.style.background='#e8f5e9'" ondragleave="this.style.borderColor='#ccc';this.style.background='#fafafa'">
                                <i class="fas fa-cloud-upload-alt" style="font-size:40px;color:#ccc;margin-bottom:10px;"></i>
                                <div style="margin-bottom:10px;color:#666;">Drag & drop CSV or JSON file here</div>
                                <input type="file" id="importFileInput" accept=".csv,.json" style="display:none;" onchange="handleImportFileSelect(event)">
                                <button onclick="document.getElementById('importFileInput').click()" style="padding:10px 25px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                                    <i class="fas fa-folder-open"></i> Choose File
                                </button>
                            </div>
                            
                            <div id="importMappingSection" style="display:none;background:#f8f9fa;padding:15px;border-radius:8px;margin-bottom:15px;">
                                <h4 style="margin:0 0 10px;"><i class="fas fa-link"></i> Field Mapping</h4>
                                <div id="mappingFields"></div>
                            </div>
                            
                            <div id="importPreviewSection" style="display:none;background:#f8f9fa;padding:15px;border-radius:8px;margin-bottom:15px;max-height:250px;overflow:auto;">
                                <h4 style="margin:0 0 10px;"><i class="fas fa-eye"></i> Preview</h4>
                                <div id="previewTable"></div>
                            </div>
                            
                            <div style="display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap;">
                                <label style="flex:1;min-width:150px;display:flex;align-items:center;gap:8px;padding:10px;background:#fff;border:1px solid #ddd;border-radius:6px;cursor:pointer;">
                                    <input type="radio" name="duplicateHandling" value="skip" checked> Skip duplicates
                                </label>
                                <label style="flex:1;min-width:150px;display:flex;align-items:center;gap:8px;padding:10px;background:#fff;border:1px solid #ddd;border-radius:6px;cursor:pointer;">
                                    <input type="radio" name="duplicateHandling" value="update"> Update existing
                                </label>
                                <label style="flex:1;min-width:150px;display:flex;align-items:center;gap:8px;padding:10px;background:#fff;border:1px solid #ddd;border-radius:6px;cursor:pointer;">
                                    <input type="radio" name="duplicateHandling" value="create"> Create all new
                                </label>
                            </div>
                            
                            <div style="background:#e8f5e9;padding:12px;border-radius:8px;margin-bottom:15px;display:flex;align-items:center;gap:10px;">
                                <i class="fas fa-download" style="color:#27ae60;"></i>
                                <span style="flex:1;font-size:13px;">Need a template?</span>
                                <button onclick="downloadImportTemplate()" style="padding:8px 15px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:12px;">
                                    <i class="fas fa-file-download"></i> Download Template
                                </button>
                            </div>
                        </div>
                        
                        <div style="border-top:1px solid #eee;padding-top:15px;margin-top:15px;">
                            <h4 style="margin:0 0 15px;"><i class="fas fa-download"></i> Export Data</h4>
                            <div style="display:flex;gap:10px;flex-wrap:wrap;">
                                <button onclick="exportDataType('bookings')" style="padding:10px 15px;background:#fff;border:1px solid #27ae60;color:#27ae60;border-radius:6px;cursor:pointer;font-size:13px;"><i class="fas fa-calendar"></i> Bookings</button>
                                <button onclick="exportDataType('customers')" style="padding:10px 15px;background:#fff;border:1px solid #3498db;color:#3498db;border-radius:6px;cursor:pointer;font-size:13px;"><i class="fas fa-users"></i> Customers</button>
                                <button onclick="exportDataType('transactions')" style="padding:10px 15px;background:#fff;border:1px solid #9b59b6;color:#9b59b6;border-radius:6px;cursor:pointer;font-size:13px;"><i class="fas fa-receipt"></i> Transactions</button>
                                <button onclick="exportAllDataBackup()" style="padding:10px 15px;background:#e74c3c;border:none;color:#fff;border-radius:6px;cursor:pointer;font-size:13px;"><i class="fas fa-archive"></i> Full Backup</button>
                            </div>
                        </div>
                        
                        <div style="display:flex;gap:10px;margin-top:20px;">
                            <button onclick="closeDataImportModal()" style="flex:1;padding:12px;background:#95a5a6;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">Cancel</button>
                            <button id="executeImportBtn" onclick="executeDataImport()" style="flex:1;padding:12px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:none;"><i class="fas fa-check"></i> Import Data</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }
        
        let selectedImportType = null;
        let pendingImportData = null;
        let importFieldMapping = {};
        
        function selectImportType(type) {
            selectedImportType = type;
            document.querySelectorAll('.import-card').forEach(c => c.style.borderColor = '#ddd');
            document.getElementById('import-' + type).style.borderColor = '#27ae60';
            document.getElementById('importUploadSection').style.display = 'block';
            document.getElementById('importMappingSection').style.display = 'none';
            document.getElementById('importPreviewSection').style.display = 'none';
            document.getElementById('executeImportBtn').style.display = 'none';
            pendingImportData = null;
        }
        
        function handleImportFileDrop(e) {
            e.preventDefault();
            e.target.style.borderColor = '#ccc';
            e.target.style.background = '#fafafa';
            const file = e.dataTransfer.files[0];
            if (file) processImportFile(file);
        }
        
        function handleImportFileSelect(e) {
            const file = e.target.files[0];
            if (file) processImportFile(file);
        }
        
        function processImportFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                let data;
                
                if (file.name.endsWith('.json')) {
                    try {
                        data = JSON.parse(content);
                        if (!Array.isArray(data)) data = [data];
                    } catch (err) {
                        return showToast('Invalid JSON file', 'error');
                    }
                } else {
                    data = parseCSVForImport(content);
                }
                
                if (!data || data.length === 0) {
                    return showToast('No data found in file', 'error');
                }
                
                pendingImportData = data;
                showFieldMapping(data);
                showToast(`Found ${data.length} records`, 'success');
            };
            reader.readAsText(file);
        }
        
        function parseCSVForImport(content) {
            const lines = content.trim().split('\n');
            if (lines.length < 2) return [];
            
            const headers = parseCSVLineAdmin(lines[0]);
            const rows = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                const values = parseCSVLineAdmin(lines[i]);
                const row = {};
                headers.forEach((h, idx) => {
                    row[h.trim().toLowerCase().replace(/\s+/g, '_')] = values[idx] || '';
                });
                rows.push(row);
            }
            return rows;
        }
        
        function parseCSVLineAdmin(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') inQuotes = !inQuotes;
                else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }
        
        function showFieldMapping(data) {
            const sample = data[0];
            const fileFields = Object.keys(sample);
            
            const expectedFields = {
                bookings: ['date', 'time', 'customer', 'players', 'room', 'bay', 'notes', 'status'],
                customers: ['first_name', 'last_name', 'email', 'phone', 'address', 'city', 'state', 'zip'],
                members: ['first_name', 'last_name', 'email', 'member_type', 'member_since', 'expires', 'passes_remaining'],
                transactions: ['date', 'time', 'customer', 'amount', 'method', 'items', 'tax']
            };
            
            const fields = expectedFields[selectedImportType] || [];
            importFieldMapping = {};
            
            // Auto-detect
            fields.forEach(field => {
                const found = fileFields.find(f => {
                    const fLower = f.toLowerCase();
                    return fLower === field || fLower.includes(field) || field.includes(fLower);
                });
                if (found) importFieldMapping[field] = found;
            });
            
            let html = '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">';
            fields.forEach(field => {
                html += `
                    <div style="display:flex;align-items:center;gap:10px;">
                        <label style="min-width:100px;font-weight:600;font-size:13px;">${field}:</label>
                        <select id="mapping_${field}" style="flex:1;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:13px;">
                            <option value="">-- Skip --</option>
                            ${fileFields.map(f => `<option value="${f}" ${importFieldMapping[field] === f ? 'selected' : ''}>${f}</option>`).join('')}
                        </select>
                    </div>
                `;
            });
            html += '</div>';
            
            document.getElementById('mappingFields').innerHTML = html;
            document.getElementById('importMappingSection').style.display = 'block';
            
            // Show preview
            showImportPreview(data.slice(0, 5));
        }
        
        function showImportPreview(data) {
            if (!data.length) return;
            
            let html = `<div style="font-size:12px;color:#666;margin-bottom:8px;">Showing ${Math.min(5, data.length)} of ${pendingImportData.length} records</div>`;
            html += '<table style="width:100%;border-collapse:collapse;font-size:11px;">';
            html += '<tr style="background:#e9ecef;">' + Object.keys(data[0]).slice(0, 6).map(k => `<th style="padding:6px;border:1px solid #ddd;text-align:left;">${k}</th>`).join('') + '</tr>';
            data.forEach(row => {
                html += '<tr>' + Object.values(row).slice(0, 6).map(v => `<td style="padding:6px;border:1px solid #ddd;">${String(v).substring(0, 25)}</td>`).join('') + '</tr>';
            });
            html += '</table>';
            
            document.getElementById('previewTable').innerHTML = html;
            document.getElementById('importPreviewSection').style.display = 'block';
            document.getElementById('executeImportBtn').style.display = 'block';
        }
        
        function executeDataImport() {
            if (!pendingImportData || !selectedImportType) {
                return showToast('No data to import', 'error');
            }
            
            const duplicateHandling = document.querySelector('input[name="duplicateHandling"]:checked').value;
            
            // Gather current mapping
            const expectedFields = {
                bookings: ['date', 'time', 'customer', 'players', 'room', 'bay', 'notes', 'status'],
                customers: ['first_name', 'last_name', 'email', 'phone', 'address', 'city', 'state', 'zip'],
                members: ['first_name', 'last_name', 'email', 'member_type', 'member_since', 'expires', 'passes_remaining'],
                transactions: ['date', 'time', 'customer', 'amount', 'method', 'items', 'tax']
            };
            
            const mapping = {};
            (expectedFields[selectedImportType] || []).forEach(field => {
                const sel = document.getElementById('mapping_' + field);
                if (sel && sel.value) mapping[field] = sel.value;
            });
            
            let imported = 0, skipped = 0, updated = 0;
            
            if (selectedImportType === 'bookings') {
                pendingImportData.forEach(row => {
                    const booking = {
                        id: bookings.length + imported + 1,
                        date: row[mapping.date] || new Date().toISOString().split('T')[0],
                        time: row[mapping.time] || '9:00 AM',
                        customer: row[mapping.customer] || 'Imported Customer',
                        players: parseInt(row[mapping.players]) || 1,
                        room: parseInt(row[mapping.room]) || parseInt(row[mapping.bay]) || 1,
                        notes: row[mapping.notes] || '',
                        status: row[mapping.status] || 'booked',
                        imported: true,
                        importDate: new Date().toISOString()
                    };
                    
                    // Check for duplicate (same customer, date, time)
                    const existing = bookings.findIndex(b => 
                        b.customer.toLowerCase() === booking.customer.toLowerCase() &&
                        b.date === booking.date &&
                        b.time === booking.time
                    );
                    
                    if (existing >= 0) {
                        if (duplicateHandling === 'skip') return skipped++;
                        if (duplicateHandling === 'update') {
                            bookings[existing] = { ...bookings[existing], ...booking, id: bookings[existing].id };
                            return updated++;
                        }
                    }
                    
                    bookings.push(booking);
                    imported++;
                });
                localStorage.setItem('gc_bookings', JSON.stringify(bookings));
                renderTeeSheet();
            }
            
            else if (selectedImportType === 'customers' || selectedImportType === 'members') {
                let customers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
                
                pendingImportData.forEach(row => {
                    const firstName = row[mapping.first_name] || '';
                    const lastName = row[mapping.last_name] || '';
                    const email = row[mapping.email] || '';
                    
                    if (!firstName && !lastName && !email) return skipped++;
                    
                    const customer = {
                        id: Date.now() + imported,
                        firstName: firstName,
                        lastName: lastName,
                        email: email,
                        phone: row[mapping.phone] || '',
                        address: row[mapping.address] || '',
                        city: row[mapping.city] || '',
                        state: row[mapping.state] || '',
                        zip: row[mapping.zip] || '',
                        isMember: selectedImportType === 'members' || row[mapping.member_type] ? true : false,
                        memberType: row[mapping.member_type] || '',
                        memberSince: row[mapping.member_since] || null,
                        memberExpires: row[mapping.expires] || null,
                        passesRemaining: parseInt(row[mapping.passes_remaining]) || 0,
                        imported: true,
                        importDate: new Date().toISOString()
                    };
                    
                    const existing = customers.findIndex(c => 
                        (email && c.email && c.email.toLowerCase() === email.toLowerCase()) ||
                        (`${c.firstName} ${c.lastName}`.toLowerCase() === `${firstName} ${lastName}`.toLowerCase())
                    );
                    
                    if (existing >= 0) {
                        if (duplicateHandling === 'skip') return skipped++;
                        if (duplicateHandling === 'update') {
                            customers[existing] = { ...customers[existing], ...customer, id: customers[existing].id };
                            return updated++;
                        }
                    }
                    
                    customers.push(customer);
                    imported++;
                });
                
                localStorage.setItem('gc_customers', JSON.stringify(customers));
            }
            
            else if (selectedImportType === 'transactions') {
                pendingImportData.forEach(row => {
                    const trans = {
                        id: transactions.length + imported + 26763,
                        date: row[mapping.date] || new Date().toISOString(),
                        time: row[mapping.time] || '12:00 PM',
                        customer: row[mapping.customer] || 'Imported',
                        amount: parseFloat(row[mapping.amount]) || 0,
                        subtotal: parseFloat(row[mapping.amount]) / 1.0635 || 0,
                        tax: parseFloat(row[mapping.tax]) || (parseFloat(row[mapping.amount]) * 0.0635 / 1.0635) || 0,
                        method: row[mapping.method] || 'cash',
                        items: [],
                        itemCount: 0,
                        discount: 0,
                        isReturn: false,
                        imported: true,
                        importDate: new Date().toISOString(),
                        register: 'IMPORT'
                    };
                    
                    transactions.push(trans);
                    imported++;
                });
                
                localStorage.setItem('gc_transactions', JSON.stringify(transactions));
                renderRecentTrans();
            }
            
            // Log import history
            const history = JSON.parse(localStorage.getItem('gc_import_history') || '[]');
            history.unshift({
                type: selectedImportType,
                date: new Date().toISOString(),
                imported,
                skipped,
                updated,
                total: pendingImportData.length
            });
            localStorage.setItem('gc_import_history', JSON.stringify(history.slice(0, 50)));
            
            closeDataImportModal();
            showToast(`Import complete: ${imported} added, ${updated} updated, ${skipped} skipped`, 'success');
        }
        
        function downloadImportTemplate() {
            const templates = {
                bookings: 'date,time,customer,players,room,notes,status\n2024-01-15,9:00 AM,John Doe,4,1,"Birthday party",booked\n2024-01-15,10:00 AM,Jane Smith,2,2,"",confirmed',
                customers: 'first_name,last_name,email,phone,address,city,state,zip\nJohn,Doe,john@email.com,555-1234,123 Main St,Hartford,CT,06101\nJane,Smith,jane@email.com,555-5678,456 Oak Ave,West Hartford,CT,06107',
                members: 'first_name,last_name,email,member_type,member_since,expires,passes_remaining\nJohn,Doe,john@email.com,Gold,2024-01-01,2025-01-01,10\nJane,Smith,jane@email.com,Silver,2024-06-01,2025-06-01,5',
                transactions: 'date,time,customer,amount,method,items,tax\n2024-01-15,10:30 AM,John Doe,45.75,card,"Hot Dog x2, Beer x1",2.75\n2024-01-15,11:00 AM,Jane Smith,12.50,cash,"Soda x2",0.75'
            };
            
            const content = templates[selectedImportType] || '';
            const blob = new Blob([content], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${selectedImportType}_template.csv`;
            a.click();
            showToast('Template downloaded', 'success');
        }
        
        function exportDataType(type) {
            let data, filename;
            
            if (type === 'bookings') {
                let csv = 'date,time,customer,players,room,notes,status\n';
                bookings.forEach(b => {
                    csv += `"${b.date || ''}","${b.time}","${b.customer}",${b.players},${b.room},"${b.notes || ''}","${b.status || 'booked'}"\n`;
                });
                data = csv;
                filename = `bookings_${new Date().toISOString().split('T')[0]}.csv`;
            }
            else if (type === 'customers') {
                const customers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
                let csv = 'first_name,last_name,email,phone,is_member,member_type,member_expires\n';
                customers.forEach(c => {
                    csv += `"${c.firstName || ''}","${c.lastName || ''}","${c.email || ''}","${c.phone || ''}",${c.isMember ? 'true' : 'false'},"${c.memberType || ''}","${c.memberExpires || ''}"\n`;
                });
                data = csv;
                filename = `customers_${new Date().toISOString().split('T')[0]}.csv`;
            }
            else if (type === 'transactions') {
                let csv = 'id,date,time,customer,amount,method\n';
                transactions.forEach(t => {
                    csv += `${t.id},"${t.date || ''}","${t.time}","${t.customer}",${t.amount.toFixed(2)},"${t.method}"\n`;
                });
                data = csv;
                filename = `transactions_${new Date().toISOString().split('T')[0]}.csv`;
            }
            
            const blob = new Blob([data], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            showToast(`${type} exported`, 'success');
        }
        
        function exportAllDataBackup() {
            const backup = {
                exportDate: new Date().toISOString(),
                version: '1.0',
                bookings: bookings,
                customers: JSON.parse(localStorage.getItem('gc_customers') || '[]'),
                transactions: transactions,
                openTabs: openTabs,
                suspended: JSON.parse(localStorage.getItem('gc_suspended') || '[]'),
                settings: {
                    stripePK: localStorage.getItem('gc_stripe_pk'),
                    stripeLocation: localStorage.getItem('gc_stripe_location'),
                    registerId: localStorage.getItem('gc_register_id')
                }
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `golf_cove_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showToast('Full backup created', 'success');
        }
        
        function closeDataImportModal() {
            const modal = document.getElementById('dataImportModal');
            if (modal) modal.remove();
            pendingImportData = null;
            selectedImportType = null;
            importFieldMapping = {};
        }
        
        // ============ MIGRATION WIZARD ============
        let wizardStep = 1;
        
        function showMigrationWizard() {
            const customers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
            const hasData = customers.length > 0 || bookings.length > 0 || transactions.length > 0;
            
            const html = `
                <div id="migrationWizard" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999;">
                    <div style="background:#fff;border-radius:12px;max-width:800px;width:95%;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;">
                        <div style="background:linear-gradient(135deg, #4a90a4, #2c3e50);color:#fff;padding:20px 25px;">
                            <h2 style="margin:0;"><i class="fas fa-magic"></i> Golf Cove Setup & Migration</h2>
                            <p style="margin:5px 0 0;opacity:0.8;font-size:14px;">Import data from your previous system</p>
                        </div>
                        
                        <div style="padding:25px;overflow-y:auto;flex:1;" id="wizardContent">
                            ${getWizardStep(1, hasData)}
                        </div>
                        
                        <div style="padding:15px 25px;border-top:1px solid #eee;display:flex;justify-content:space-between;background:#f8f9fa;">
                            <button onclick="closeMigrationWizard()" style="padding:10px 20px;background:#95a5a6;color:#fff;border:none;border-radius:6px;cursor:pointer;">Close</button>
                            <div id="wizardNavButtons">
                                <button id="wizardNextBtn" onclick="nextWizardStep()" style="padding:10px 25px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                                    Get Started <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
            wizardStep = 1;
        }
        
        function getWizardStep(step, hasData) {
            if (step === 1) {
                return `
                    <div style="text-align:center;padding:20px 0;">
                        <img src="images/golfCoveLogo6.png" alt="Golf Cove" style="height:80px;margin-bottom:20px;">
                        <h3 style="margin:0 0 10px;">Welcome to Golf Cove POS</h3>
                        <p style="color:#666;margin-bottom:30px;">Let's set up your system and import your data</p>
                        
                        ${hasData ? `
                            <div style="background:#e8f5e9;padding:15px;border-radius:8px;margin-bottom:20px;text-align:left;">
                                <i class="fas fa-check-circle" style="color:#27ae60;"></i>
                                <strong>Data Already Present</strong>
                                <div style="font-size:13px;color:#666;margin-top:5px;">
                                    You already have data in the system. The wizard will help you add more.
                                </div>
                            </div>
                        ` : ''}
                        
                        <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:15px;text-align:center;margin-top:20px;">
                            <div style="padding:20px;background:#f8f9fa;border-radius:10px;">
                                <i class="fas fa-users" style="font-size:30px;color:#3498db;margin-bottom:10px;display:block;"></i>
                                <strong>Step 1</strong>
                                <div style="font-size:12px;color:#666;">Import Customers</div>
                            </div>
                            <div style="padding:20px;background:#f8f9fa;border-radius:10px;">
                                <i class="fas fa-id-card" style="font-size:30px;color:#f1c40f;margin-bottom:10px;display:block;"></i>
                                <strong>Step 2</strong>
                                <div style="font-size:12px;color:#666;">Import Members</div>
                            </div>
                            <div style="padding:20px;background:#f8f9fa;border-radius:10px;">
                                <i class="fas fa-calendar" style="font-size:30px;color:#27ae60;margin-bottom:10px;display:block;"></i>
                                <strong>Step 3</strong>
                                <div style="font-size:12px;color:#666;">Import Bookings</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (step === 2) {
                return `
                    <div>
                        <h3><i class="fas fa-users"></i> Step 1: Import Customers</h3>
                        <p style="color:#666;margin-bottom:20px;">Import your customer database from CSV or JSON</p>
                        
                        <div style="background:#e3f2fd;padding:15px;border-radius:8px;margin-bottom:20px;">
                            <strong><i class="fas fa-lightbulb"></i> Tip:</strong> Export your customers from your previous system as a CSV file
                        </div>
                        
                        <div style="border:2px dashed #ccc;border-radius:10px;padding:40px;text-align:center;margin-bottom:20px;background:#fafafa;" id="customerDropZone"
                             ondrop="handleWizardDrop(event, 'customers')" ondragover="event.preventDefault();this.style.borderColor='#27ae60'">
                            <i class="fas fa-cloud-upload-alt" style="font-size:50px;color:#ccc;margin-bottom:15px;"></i>
                            <div style="font-size:16px;margin-bottom:10px;">Drag & drop customer file here</div>
                            <input type="file" id="wizardCustomerFile" accept=".csv,.json" style="display:none;" onchange="handleWizardFile(this.files[0], 'customers')">
                            <button onclick="document.getElementById('wizardCustomerFile').click()" style="padding:12px 25px;background:#3498db;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                                <i class="fas fa-folder-open"></i> Choose File
                            </button>
                        </div>
                        
                        <div id="wizardCustomerPreview"></div>
                        
                        <div style="background:#f8f9fa;padding:15px;border-radius:8px;">
                            <strong>Expected CSV Format:</strong>
                            <code style="display:block;margin-top:10px;background:#fff;padding:10px;border-radius:4px;font-size:12px;">
                                first_name,last_name,email,phone,member,member_type,expires
                            </code>
                        </div>
                    </div>
                `;
            } else if (step === 3) {
                return `
                    <div>
                        <h3><i class="fas fa-id-card"></i> Step 2: Import Memberships</h3>
                        <p style="color:#666;margin-bottom:20px;">Import membership data (can also update existing customers)</p>
                        
                        <div style="border:2px dashed #ccc;border-radius:10px;padding:40px;text-align:center;margin-bottom:20px;background:#fafafa;"
                             ondrop="handleWizardDrop(event, 'members')" ondragover="event.preventDefault();this.style.borderColor='#f1c40f'">
                            <i class="fas fa-cloud-upload-alt" style="font-size:50px;color:#ccc;margin-bottom:15px;"></i>
                            <div style="font-size:16px;margin-bottom:10px;">Drag & drop membership file here</div>
                            <input type="file" id="wizardMemberFile" accept=".csv,.json" style="display:none;" onchange="handleWizardFile(this.files[0], 'members')">
                            <button onclick="document.getElementById('wizardMemberFile').click()" style="padding:12px 25px;background:#f1c40f;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                                <i class="fas fa-folder-open"></i> Choose File
                            </button>
                        </div>
                        
                        <div id="wizardMemberPreview"></div>
                        
                        <p style="color:#888;font-size:13px;"><i class="fas fa-info-circle"></i> This step is optional if membership data was included with customers</p>
                    </div>
                `;
            } else if (step === 4) {
                return `
                    <div>
                        <h3><i class="fas fa-calendar"></i> Step 3: Import Bookings</h3>
                        <p style="color:#666;margin-bottom:20px;">Import existing bookings and reservations</p>
                        
                        <div style="border:2px dashed #ccc;border-radius:10px;padding:40px;text-align:center;margin-bottom:20px;background:#fafafa;"
                             ondrop="handleWizardDrop(event, 'bookings')" ondragover="event.preventDefault();this.style.borderColor='#27ae60'">
                            <i class="fas fa-cloud-upload-alt" style="font-size:50px;color:#ccc;margin-bottom:15px;"></i>
                            <div style="font-size:16px;margin-bottom:10px;">Drag & drop bookings file here</div>
                            <input type="file" id="wizardBookingFile" accept=".csv,.json" style="display:none;" onchange="handleWizardFile(this.files[0], 'bookings')">
                            <button onclick="document.getElementById('wizardBookingFile').click()" style="padding:12px 25px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                                <i class="fas fa-folder-open"></i> Choose File
                            </button>
                        </div>
                        
                        <div id="wizardBookingPreview"></div>
                        
                        <div style="background:#f8f9fa;padding:15px;border-radius:8px;">
                            <strong>Expected CSV Format:</strong>
                            <code style="display:block;margin-top:10px;background:#fff;padding:10px;border-radius:4px;font-size:12px;">
                                date,time,customer,players,bay,notes
                            </code>
                        </div>
                    </div>
                `;
            } else if (step === 5) {
                const customers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
                const memberCount = customers.filter(c => c.isMember).length;
                
                return `
                    <div style="text-align:center;padding:20px;">
                        <i class="fas fa-check-circle" style="font-size:80px;color:#27ae60;margin-bottom:20px;"></i>
                        <h2 style="margin:0 0 10px;color:#27ae60;">Setup Complete!</h2>
                        <p style="color:#666;margin-bottom:30px;">Your Golf Cove POS is ready to use</p>
                        
                        <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:15px;margin-bottom:30px;">
                            <div style="background:#e8f5e9;padding:20px;border-radius:10px;">
                                <div style="font-size:36px;font-weight:700;color:#27ae60;">${customers.length}</div>
                                <div style="font-size:13px;color:#666;">Customers</div>
                            </div>
                            <div style="background:#fff3cd;padding:20px;border-radius:10px;">
                                <div style="font-size:36px;font-weight:700;color:#f1c40f;">${memberCount}</div>
                                <div style="font-size:13px;color:#666;">Members</div>
                            </div>
                            <div style="background:#e3f2fd;padding:20px;border-radius:10px;">
                                <div style="font-size:36px;font-weight:700;color:#3498db;">${bookings.length}</div>
                                <div style="font-size:13px;color:#666;">Bookings</div>
                            </div>
                        </div>
                        
                        <div style="background:#f8f9fa;padding:20px;border-radius:8px;text-align:left;">
                            <h4 style="margin:0 0 15px;"><i class="fas fa-rocket"></i> Quick Start Tips</h4>
                            <ul style="margin:0;padding-left:20px;color:#666;">
                                <li>Press <kbd style="background:#e9ecef;padding:2px 6px;border-radius:3px;">Ctrl+K</kbd> for global search</li>
                                <li>Press <kbd style="background:#e9ecef;padding:2px 6px;border-radius:3px;">F2</kbd> to create a new booking</li>
                                <li>Use the Import button to add more data anytime</li>
                                <li>Configure Stripe in Sales → Settings (F10) for card payments</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }
        
        function nextWizardStep() {
            wizardStep++;
            if (wizardStep > 5) {
                closeMigrationWizard();
                return;
            }
            
            const hasData = JSON.parse(localStorage.getItem('gc_customers') || '[]').length > 0;
            document.getElementById('wizardContent').innerHTML = getWizardStep(wizardStep, hasData);
            
            // Update button
            if (wizardStep === 5) {
                document.getElementById('wizardNextBtn').innerHTML = '<i class="fas fa-check"></i> Finish';
            } else if (wizardStep > 1) {
                document.getElementById('wizardNextBtn').innerHTML = 'Skip & Continue <i class="fas fa-arrow-right"></i>';
            }
        }
        
        function handleWizardDrop(e, type) {
            e.preventDefault();
            const file = e.dataTransfer.files[0];
            if (file) handleWizardFile(file, type);
        }
        
        function handleWizardFile(file, type) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                let data;
                if (file.name.endsWith('.json')) {
                    try {
                        data = JSON.parse(e.target.result);
                        if (!Array.isArray(data)) data = data.customers || data.data || [data];
                    } catch (err) {
                        return showToast('Invalid JSON file', 'error');
                    }
                } else {
                    data = parseCSVForImport(e.target.result);
                }
                
                if (!data || data.length === 0) {
                    return showToast('No data found', 'error');
                }
                
                // Process and show preview
                const previewId = 'wizard' + type.charAt(0).toUpperCase() + type.slice(1) + 'Preview';
                const previewDiv = document.getElementById(previewId);
                
                previewDiv.innerHTML = `
                    <div style="background:#e8f5e9;padding:15px;border-radius:8px;margin-bottom:15px;">
                        <i class="fas fa-check-circle" style="color:#27ae60;"></i>
                        <strong>Found ${data.length} records</strong>
                        <button onclick="importWizardData('${type}')" style="float:right;padding:8px 15px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;">
                            <i class="fas fa-upload"></i> Import Now
                        </button>
                    </div>
                    <div style="max-height:150px;overflow:auto;font-size:12px;">
                        <table style="width:100%;border-collapse:collapse;">
                            <tr style="background:#f8f9fa;">
                                ${Object.keys(data[0]).slice(0, 5).map(k => `<th style="padding:5px;border:1px solid #ddd;">${k}</th>`).join('')}
                            </tr>
                            ${data.slice(0, 3).map(row => `
                                <tr>${Object.values(row).slice(0, 5).map(v => `<td style="padding:5px;border:1px solid #ddd;">${String(v).substring(0, 20)}</td>`).join('')}</tr>
                            `).join('')}
                        </table>
                    </div>
                `;
                
                // Store data for import
                window.wizardPendingData = { type, data };
            };
            reader.readAsText(file);
        }
        
        function importWizardData(type) {
            if (!window.wizardPendingData || window.wizardPendingData.type !== type) {
                return showToast('No data to import', 'error');
            }
            
            const data = window.wizardPendingData.data;
            let imported = 0;
            
            if (type === 'customers' || type === 'members') {
                let customers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
                
                data.forEach(row => {
                    const firstName = row.first_name || row.firstName || row.firstname || '';
                    const lastName = row.last_name || row.lastName || row.lastname || '';
                    const email = row.email || '';
                    
                    if (!firstName && !lastName && !email) return;
                    
                    // Check for duplicate
                    const existing = customers.find(c => 
                        (email && c.email === email) ||
                        (`${c.firstName} ${c.lastName}`.toLowerCase() === `${firstName} ${lastName}`.toLowerCase())
                    );
                    
                    if (existing) {
                        // Update membership info if importing members
                        if (type === 'members') {
                            existing.isMember = true;
                            existing.memberType = row.member_type || row.memberType || existing.memberType;
                            existing.memberExpires = row.expires || row.memberExpires || existing.memberExpires;
                        }
                    } else {
                        customers.push({
                            id: Date.now() + imported,
                            firstName,
                            lastName,
                            email,
                            phone: row.phone || '',
                            isMember: type === 'members' || row.member === 'true' || row.member === 'Yes',
                            memberType: row.member_type || row.memberType || null,
                            memberExpires: row.expires || row.memberExpires || null,
                            priceClass: row.price_class || 'Regular',
                            passes: [],
                            createdAt: new Date().toISOString()
                        });
                        imported++;
                    }
                });
                
                localStorage.setItem('gc_customers', JSON.stringify(customers));
            } else if (type === 'bookings') {
                data.forEach(row => {
                    bookings.push({
                        id: bookings.length + imported + 1,
                        date: row.date || new Date().toISOString().split('T')[0],
                        time: row.time || '9:00 AM',
                        customer: row.customer || row.name || 'Guest',
                        players: parseInt(row.players) || 1,
                        room: parseInt(row.bay || row.room) || 1,
                        notes: row.notes || '',
                        status: 'booked'
                    });
                    imported++;
                });
                localStorage.setItem('gc_bookings', JSON.stringify(bookings));
                renderTeeSheet();
            }
            
            showToast(`Imported ${imported} ${type}!`, 'success');
            window.wizardPendingData = null;
            
            // Update preview
            const previewId = 'wizard' + type.charAt(0).toUpperCase() + type.slice(1) + 'Preview';
            document.getElementById(previewId).innerHTML = `
                <div style="background:#e8f5e9;padding:15px;border-radius:8px;">
                    <i class="fas fa-check-circle" style="color:#27ae60;"></i>
                    <strong>Successfully imported ${imported} records!</strong>
                </div>
            `;
        }
        
        function closeMigrationWizard() {
            const modal = document.getElementById('migrationWizard');
            if (modal) modal.remove();
            wizardStep = 1;
            window.wizardPendingData = null;
        }
        
        // ============ ANALYTICS DASHBOARD ============
        function showAnalytics() {
            const transactions = JSON.parse(localStorage.getItem('gc_transactions') || '[]');
            const customers = JSON.parse(localStorage.getItem('gc_customers') || '[]');
            const dailySales = JSON.parse(localStorage.getItem('gc_daily_sales') || '{}');
            
            // Calculate metrics
            const today = new Date().toDateString();
            const todayData = dailySales[today] || { total: 0, count: 0 };
            
            // Last 7 days
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const key = d.toDateString();
                last7Days.push({
                    date: d.toLocaleDateString('en-US', { weekday: 'short' }),
                    sales: dailySales[key]?.total || 0,
                    count: dailySales[key]?.count || 0
                });
            }
            
            const totalLast7 = last7Days.reduce((sum, d) => sum + d.sales, 0);
            const transLast7 = last7Days.reduce((sum, d) => sum + d.count, 0);
            const avgPerDay = totalLast7 / 7;
            
            // Top customers
            const sortedCustomers = [...customers]
                .filter(c => c.totalSpent > 0)
                .sort((a, b) => (b.totalSpent || 0) - (a.totalSpent || 0))
                .slice(0, 5);
            
            // Members vs non-members
            const memberCount = customers.filter(c => c.isMember).length;
            const nonMemberCount = customers.length - memberCount;
            
            const html = `
                <div id="analyticsModal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;overflow:auto;">
                    <div style="background:#fff;padding:30px;border-radius:12px;max-width:900px;width:95%;max-height:90vh;overflow:auto;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;">
                            <h2 style="margin:0;color:#2c3e50;"><i class="fas fa-chart-bar"></i> Analytics Dashboard</h2>
                            <button onclick="closeAnalytics()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#666;">&times;</button>
                        </div>
                        
                        <!-- Summary Cards -->
                        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:15px;margin-bottom:25px;">
                            <div style="background:linear-gradient(135deg,#3498db,#2980b9);color:#fff;padding:20px;border-radius:10px;">
                                <div style="font-size:12px;opacity:0.8;">Today's Sales</div>
                                <div style="font-size:28px;font-weight:700;">$${todayData.total.toFixed(2)}</div>
                                <div style="font-size:12px;margin-top:5px;">${todayData.count} transactions</div>
                            </div>
                            <div style="background:linear-gradient(135deg,#27ae60,#1e8449);color:#fff;padding:20px;border-radius:10px;">
                                <div style="font-size:12px;opacity:0.8;">7-Day Sales</div>
                                <div style="font-size:28px;font-weight:700;">$${totalLast7.toFixed(2)}</div>
                                <div style="font-size:12px;margin-top:5px;">${transLast7} transactions</div>
                            </div>
                            <div style="background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff;padding:20px;border-radius:10px;">
                                <div style="font-size:12px;opacity:0.8;">Avg Daily</div>
                                <div style="font-size:28px;font-weight:700;">$${avgPerDay.toFixed(2)}</div>
                                <div style="font-size:12px;margin-top:5px;">per day</div>
                            </div>
                            <div style="background:linear-gradient(135deg,#e67e22,#d35400);color:#fff;padding:20px;border-radius:10px;">
                                <div style="font-size:12px;opacity:0.8;">Total Customers</div>
                                <div style="font-size:28px;font-weight:700;">${customers.length}</div>
                                <div style="font-size:12px;margin-top:5px;">${memberCount} members</div>
                            </div>
                        </div>
                        
                        <div style="display:grid;grid-template-columns:2fr 1fr;gap:20px;">
                            <!-- Daily Sales Chart -->
                            <div style="background:#f8f9fa;padding:20px;border-radius:10px;">
                                <h4 style="margin:0 0 15px;color:#2c3e50;">Last 7 Days</h4>
                                <div style="display:flex;align-items:flex-end;height:150px;gap:10px;">
                                    ${last7Days.map(d => {
                                        const height = totalLast7 > 0 ? Math.max(10, (d.sales / Math.max(...last7Days.map(x => x.sales))) * 130) : 10;
                                        return `
                                            <div style="flex:1;text-align:center;">
                                                <div style="background:linear-gradient(180deg,#4a90a4,#3d7a8a);height:${height}px;border-radius:4px 4px 0 0;" title="$${d.sales.toFixed(2)}"></div>
                                                <div style="font-size:11px;margin-top:5px;color:#666;">${d.date}</div>
                                                <div style="font-size:10px;color:#999;">$${d.sales.toFixed(0)}</div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                            
                            <!-- Top Customers -->
                            <div style="background:#f8f9fa;padding:20px;border-radius:10px;">
                                <h4 style="margin:0 0 15px;color:#2c3e50;">Top Customers</h4>
                                ${sortedCustomers.length > 0 ? sortedCustomers.map((c, i) => `
                                    <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #e0e0e0;">
                                        <span style="font-size:13px;">${i+1}. ${c.firstName} ${c.lastName}</span>
                                        <strong style="color:#27ae60;">$${(c.totalSpent || 0).toFixed(2)}</strong>
                                    </div>
                                `).join('') : '<p style="color:#666;font-size:13px;">No customer data yet</p>'}
                            </div>
                        </div>
                        
                        <!-- Booking Stats -->
                        <div style="margin-top:20px;background:#f8f9fa;padding:20px;border-radius:10px;">
                            <h4 style="margin:0 0 15px;color:#2c3e50;">Today's Bookings</h4>
                            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:15px;">
                                <div style="text-align:center;">
                                    <div style="font-size:24px;font-weight:700;color:#3498db;">${bookings.filter(b => b.date === selectedDate).length}</div>
                                    <div style="font-size:12px;color:#666;">Total Bookings</div>
                                </div>
                                <div style="text-align:center;">
                                    <div style="font-size:24px;font-weight:700;color:#27ae60;">${bookings.filter(b => b.date === selectedDate && b.status === 'checked-in').length}</div>
                                    <div style="font-size:12px;color:#666;">Checked In</div>
                                </div>
                                <div style="text-align:center;">
                                    <div style="font-size:24px;font-weight:700;color:#e67e22;">${bookings.filter(b => b.date === selectedDate && b.status === 'booked').length}</div>
                                    <div style="font-size:12px;color:#666;">Pending</div>
                                </div>
                                <div style="text-align:center;">
                                    <div style="font-size:24px;font-weight:700;color:#9b59b6;">${bookings.filter(b => b.date === selectedDate).reduce((sum, b) => sum + b.players, 0)}</div>
                                    <div style="font-size:12px;color:#666;">Total Players</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top:20px;text-align:right;">
                            <button onclick="exportAnalyticsReport()" style="background:#27ae60;color:#fff;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;font-weight:600;"><i class="fas fa-download"></i> Export Report</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }
        
        function closeAnalytics() {
            const modal = document.getElementById('analyticsModal');
            if (modal) modal.remove();
        }
        
        function exportAnalyticsReport() {
            const transactions = JSON.parse(localStorage.getItem('gc_transactions') || '[]');
            const dailySales = JSON.parse(localStorage.getItem('gc_daily_sales') || '{}');
            
            let csv = 'Date,Total Sales,Transaction Count,Cash,Card\n';
            Object.keys(dailySales).sort().reverse().forEach(date => {
                const d = dailySales[date];
                csv += `"${date}",${d.total.toFixed(2)},${d.count},${(d.cash || 0).toFixed(2)},${(d.card || 0).toFixed(2)}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analytics_report_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            showToast('Report exported', 'success');
        }
        
        // ============ BOOKING UTILITIES ============
        function showBulkBooking() {
            const html = `
                <div id="bulkBookingModal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;">
                    <div style="background:#fff;padding:25px;border-radius:12px;max-width:500px;width:95%;">
                        <h3 style="margin:0 0 20px;color:#4a90a4;"><i class="fas fa-calendar-plus"></i> Bulk Booking</h3>
                        
                        <div style="margin-bottom:15px;">
                            <label style="display:block;margin-bottom:5px;font-weight:600;">Group/Event Name:</label>
                            <input type="text" id="bulkGroupName" placeholder="e.g., Corporate Outing" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                        </div>
                        
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px;">
                            <div>
                                <label style="display:block;margin-bottom:5px;font-weight:600;">Date:</label>
                                <input type="date" id="bulkDate" value="${selectedDate}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:5px;font-weight:600;">Players Per Slot:</label>
                                <select id="bulkPlayers" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4" selected>4</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px;">
                            <div>
                                <label style="display:block;margin-bottom:5px;font-weight:600;">Start Time:</label>
                                <select id="bulkStartTime" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                    ${generateTimeOptions().map(t => `<option value="${t}">${t}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:5px;font-weight:600;">End Time:</label>
                                <select id="bulkEndTime" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                    ${generateTimeOptions().map(t => `<option value="${t}" ${t === '5:00 PM' ? 'selected' : ''}>${t}</option>`).join('')}
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-bottom:15px;">
                            <label style="display:block;margin-bottom:5px;font-weight:600;">Bays (comma-separated or range like 1-5):</label>
                            <input type="text" id="bulkBays" placeholder="1-5 or 1,3,5" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                        </div>
                        
                        <div style="margin-bottom:15px;">
                            <label style="display:block;margin-bottom:5px;font-weight:600;">Contact Email:</label>
                            <input type="email" id="bulkEmail" placeholder="contact@email.com" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                        </div>
                        
                        <div style="display:flex;gap:10px;">
                            <button onclick="closeBulkBooking()" style="flex:1;padding:12px;border:none;background:#95a5a6;color:#fff;border-radius:6px;cursor:pointer;font-weight:600;">Cancel</button>
                            <button onclick="createBulkBooking()" style="flex:1;padding:12px;border:none;background:#4a90a4;color:#fff;border-radius:6px;cursor:pointer;font-weight:600;"><i class="fas fa-check"></i> Create Bookings</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }
        
        function generateTimeOptions() {
            const times = [];
            for (let h = 6; h <= 20; h++) {
                const hour12 = h > 12 ? h - 12 : h;
                const ampm = h >= 12 ? 'PM' : 'AM';
                times.push(`${hour12}:00 ${ampm}`);
                times.push(`${hour12}:30 ${ampm}`);
            }
            return times;
        }
        
        function closeBulkBooking() {
            const modal = document.getElementById('bulkBookingModal');
            if (modal) modal.remove();
        }
        
        function createBulkBooking() {
            const groupName = document.getElementById('bulkGroupName').value || 'Group Booking';
            const date = document.getElementById('bulkDate').value;
            const players = parseInt(document.getElementById('bulkPlayers').value);
            const startTime = document.getElementById('bulkStartTime').value;
            const endTime = document.getElementById('bulkEndTime').value;
            const baysInput = document.getElementById('bulkBays').value;
            const email = document.getElementById('bulkEmail').value;
            
            // Parse bays
            let bays = [];
            if (baysInput.includes('-')) {
                const [start, end] = baysInput.split('-').map(Number);
                for (let i = start; i <= end; i++) bays.push(i);
            } else {
                bays = baysInput.split(',').map(b => parseInt(b.trim())).filter(b => !isNaN(b));
            }
            
            if (bays.length === 0) {
                showToast('Please specify bays', 'error');
                return;
            }
            
            // Generate time slots
            const times = generateTimeOptions();
            const startIdx = times.indexOf(startTime);
            const endIdx = times.indexOf(endTime);
            
            if (startIdx === -1 || endIdx === -1 || startIdx >= endIdx) {
                showToast('Invalid time range', 'error');
                return;
            }
            
            let created = 0;
            for (let t = startIdx; t < endIdx; t++) {
                for (const bay of bays) {
                    // Check if slot is available
                    const existing = bookings.find(b => 
                        b.date === date && b.time === times[t] && b.room === bay
                    );
                    
                    if (!existing) {
                        bookings.push({
                            id: bookings.length + created + 1,
                            date: date,
                            time: times[t],
                            customer: groupName,
                            players: players,
                            room: bay,
                            notes: email ? `Contact: ${email}` : '',
                            status: 'booked',
                            isGroup: true
                        });
                        created++;
                    }
                }
            }
            
            localStorage.setItem('gc_bookings', JSON.stringify(bookings));
            closeBulkBooking();
            renderTeeSheet();
            showToast(`Created ${created} bookings for "${groupName}"`, 'success');
        }
        
        // ============ WAITLIST ============
        function showWaitlist() {
            const waitlist = JSON.parse(localStorage.getItem('gc_waitlist') || '[]');
            
            const html = `
                <div id="waitlistModal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;">
                    <div style="background:#fff;padding:25px;border-radius:12px;max-width:600px;width:95%;max-height:80vh;overflow:auto;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                            <h3 style="margin:0;color:#e67e22;"><i class="fas fa-clock"></i> Waitlist</h3>
                            <button onclick="closeWaitlist()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#666;">&times;</button>
                        </div>
                        
                        <button onclick="addToWaitlist()" style="width:100%;padding:12px;background:#e67e22;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;margin-bottom:20px;"><i class="fas fa-plus"></i> Add to Waitlist</button>
                        
                        <div id="waitlistEntries">
                            ${waitlist.length > 0 ? waitlist.map((w, i) => `
                                <div style="display:flex;align-items:center;padding:15px;background:#f8f9fa;border-radius:8px;margin-bottom:10px;">
                                    <div style="flex:1;">
                                        <strong>${w.name}</strong> - ${w.players} player(s)
                                        <div style="font-size:12px;color:#666;">${w.phone || 'No phone'} | Requested: ${w.preferredDate || 'Any'} ${w.preferredTime || ''}</div>
                                        ${w.notes ? `<div style="font-size:12px;color:#888;margin-top:3px;">${w.notes}</div>` : ''}
                                    </div>
                                    <button onclick="convertWaitlistToBooking(${i})" style="background:#27ae60;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;margin-right:5px;" title="Convert to booking"><i class="fas fa-check"></i></button>
                                    <button onclick="removeFromWaitlist(${i})" style="background:#e74c3c;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;" title="Remove"><i class="fas fa-times"></i></button>
                                </div>
                            `).join('') : '<p style="color:#666;text-align:center;">No one on waitlist</p>'}
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }
        
        function closeWaitlist() {
            const modal = document.getElementById('waitlistModal');
            if (modal) modal.remove();
        }
        
        function addToWaitlist() {
            const name = prompt('Customer name:');
            if (!name) return;
            
            const phone = prompt('Phone number:');
            const players = prompt('Number of players:', '2');
            const preferredDate = prompt('Preferred date (YYYY-MM-DD or leave blank):');
            const preferredTime = prompt('Preferred time (e.g., Morning, Afternoon):');
            const notes = prompt('Notes:');
            
            const waitlist = JSON.parse(localStorage.getItem('gc_waitlist') || '[]');
            waitlist.push({
                name,
                phone,
                players: parseInt(players) || 2,
                preferredDate,
                preferredTime,
                notes,
                addedAt: new Date().toISOString()
            });
            localStorage.setItem('gc_waitlist', JSON.stringify(waitlist));
            closeWaitlist();
            showWaitlist();
            showToast('Added to waitlist', 'success');
        }
        
        function removeFromWaitlist(index) {
            if (!confirm('Remove from waitlist?')) return;
            const waitlist = JSON.parse(localStorage.getItem('gc_waitlist') || '[]');
            waitlist.splice(index, 1);
            localStorage.setItem('gc_waitlist', JSON.stringify(waitlist));
            closeWaitlist();
            showWaitlist();
        }
        
        function convertWaitlistToBooking(index) {
            const waitlist = JSON.parse(localStorage.getItem('gc_waitlist') || '[]');
            const entry = waitlist[index];
            
            // Open booking modal with pre-filled data
            const time = prompt('Time for booking:', '9:00 AM');
            const bay = prompt('Bay number:', '1');
            
            if (!time || !bay) return;
            
            bookings.push({
                id: bookings.length + 1,
                date: entry.preferredDate || selectedDate,
                time: time,
                customer: entry.name,
                players: entry.players,
                room: parseInt(bay),
                notes: entry.notes || '',
                status: 'booked'
            });
            
            localStorage.setItem('gc_bookings', JSON.stringify(bookings));
            
            // Remove from waitlist
            waitlist.splice(index, 1);
            localStorage.setItem('gc_waitlist', JSON.stringify(waitlist));
            
            closeWaitlist();
            renderTeeSheet();
            showToast(`Booking created for ${entry.name}`, 'success');
        }
        
        // ============ SETTINGS ============
        function showSettings() {
            const businessName = localStorage.getItem('gc_business_name') || 'Golf Cove';
            const businessPhone = localStorage.getItem('gc_business_phone') || '(203) 390-5994';
            const businessEmail = localStorage.getItem('gc_business_email') || 'info@golfcovect.com';
            const businessAddress = localStorage.getItem('gc_business_address') || '336 State Street';
            const businessCity = localStorage.getItem('gc_business_city') || 'North Haven';
            const businessState = localStorage.getItem('gc_business_state') || 'Connecticut';
            const businessZip = localStorage.getItem('gc_business_zip') || '06473';
            const taxRate = localStorage.getItem('gc_tax_rate') || '6.35';
            const timeFormat = localStorage.getItem('gc_time_format') || '12h';
            const dateFormat = localStorage.getItem('gc_date_format') || 'MM/DD/YYYY';
            
            const html = `
                <div id="settingsModal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;overflow:auto;">
                    <div style="background:#fff;padding:25px;border-radius:12px;max-width:700px;width:95%;max-height:90vh;overflow:auto;margin:20px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                            <h2 style="margin:0;color:#4a90a4;"><i class="fas fa-cog"></i> Settings</h2>
                            <button onclick="closeSettings()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#666;">&times;</button>
                        </div>
                        
                        <!-- Business Details -->
                        <div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-bottom:20px;">
                            <h4 style="margin:0 0 15px;color:#2c3e50;"><i class="fas fa-building"></i> Business Details</h4>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Business Name</label>
                                    <input type="text" id="settingBusinessName" value="${businessName}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Phone Number</label>
                                    <input type="tel" id="settingBusinessPhone" value="${businessPhone}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Email Address</label>
                                    <input type="email" id="settingBusinessEmail" value="${businessEmail}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Business Address</label>
                                    <input type="text" id="settingBusinessAddress" value="${businessAddress}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">City</label>
                                    <input type="text" id="settingBusinessCity" value="${businessCity}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                </div>
                                <div style="display:grid;grid-template-columns:2fr 1fr;gap:10px;">
                                    <div>
                                        <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">State</label>
                                        <input type="text" id="settingBusinessState" value="${businessState}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                    </div>
                                    <div>
                                        <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Zip</label>
                                        <input type="text" id="settingBusinessZip" value="${businessZip}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sales Settings -->
                        <div style="background:#e8f5e9;padding:20px;border-radius:10px;margin-bottom:20px;">
                            <h4 style="margin:0 0 15px;color:#2e7d32;"><i class="fas fa-cash-register"></i> Sales Settings</h4>
                            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;">
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Tax Rate (%)</label>
                                    <input type="number" id="settingTaxRate" value="${taxRate}" step="0.01" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Time Format</label>
                                    <select id="settingTimeFormat" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                        <option value="12h" ${timeFormat === '12h' ? 'selected' : ''}>12 Hour (1:00PM)</option>
                                        <option value="24h" ${timeFormat === '24h' ? 'selected' : ''}>24 Hour (13:00)</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Date Format</label>
                                    <select id="settingDateFormat" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                        <option value="MM/DD/YYYY" ${dateFormat === 'MM/DD/YYYY' ? 'selected' : ''}>MM/DD/YYYY</option>
                                        <option value="DD/MM/YYYY" ${dateFormat === 'DD/MM/YYYY' ? 'selected' : ''}>DD/MM/YYYY</option>
                                        <option value="YYYY-MM-DD" ${dateFormat === 'YYYY-MM-DD' ? 'selected' : ''}>YYYY-MM-DD</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tee Sheet Settings -->
                        <div style="background:#e3f2fd;padding:20px;border-radius:10px;margin-bottom:20px;">
                            <h4 style="margin:0 0 15px;color:#1565c0;"><i class="fas fa-calendar-alt"></i> Tee Sheet Settings</h4>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Number of Bays</label>
                                    <select id="settingNumBays" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                        <option value="3" ${rooms.length === 3 ? 'selected' : ''}>3 Bays</option>
                                        <option value="4" ${rooms.length === 4 ? 'selected' : ''}>4 Bays</option>
                                        <option value="5" ${rooms.length === 5 ? 'selected' : ''}>5 Bays</option>
                                        <option value="6" ${rooms.length === 6 ? 'selected' : ''}>6 Bays</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Default Booking Duration</label>
                                    <select id="settingDefaultDuration" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;">
                                        <option value="1">1 Hour</option>
                                        <option value="2" selected>2 Hours</option>
                                        <option value="3">3 Hours</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stripe / Payment Settings -->
                        <div style="background:#f3e5f5;padding:20px;border-radius:10px;margin-bottom:20px;">
                            <h4 style="margin:0 0 15px;color:#7b1fa2;"><i class="fab fa-stripe"></i> Stripe Payment Settings</h4>
                            <p style="font-size:12px;color:#666;margin-bottom:15px;">Configure Stripe for online gift card purchases and website payments. In-person card payments use your external terminal.</p>
                            <div style="display:grid;grid-template-columns:1fr;gap:15px;">
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Publishable Key <span style="font-weight:400;color:#999;">(starts with pk_)</span></label>
                                    <input type="text" id="settingStripePK" value="${localStorage.getItem('gc_stripe_pk') || ''}" placeholder="pk_live_... or pk_test_..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-family:monospace;font-size:12px;">
                                </div>
                                <div>
                                    <label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Secret Key <span style="font-weight:400;color:#999;">(starts with sk_ - keep private!)</span></label>
                                    <input type="password" id="settingStripeSK" value="${localStorage.getItem('gc_stripe_sk') || ''}" placeholder="sk_live_... or sk_test_..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-family:monospace;font-size:12px;">
                                    <p style="font-size:11px;color:#e74c3c;margin-top:5px;"><i class="fas fa-exclamation-triangle"></i> Never share your secret key. It's stored locally on this device only.</p>
                                </div>
                            </div>
                            <div style="margin-top:15px;padding:12px;background:#fff;border-radius:6px;border:1px solid #e1bee7;">
                                <div style="font-size:12px;color:#666;">
                                    <strong>Where to find your keys:</strong><br>
                                    1. Go to <a href="https://dashboard.stripe.com/apikeys" target="_blank" style="color:#7b1fa2;">Stripe Dashboard → Developers → API Keys</a><br>
                                    2. Copy your Publishable key and Secret key<br>
                                    3. Use test keys (pk_test_, sk_test_) for testing before going live
                                </div>
                            </div>
                        </div>
                        
                        <!-- Employee PINs -->
                        <div style="background:#e8f5e9;padding:20px;border-radius:10px;margin-bottom:20px;">
                            <h4 style="margin:0 0 15px;color:#2e7d32;"><i class="fas fa-users"></i> Employee PINs</h4>
                            <p style="font-size:12px;color:#666;margin-bottom:15px;">Manage employee access to the POS system.</p>
                            <div id="employeeList" style="margin-bottom:15px;">
                                ${employees.map((emp, i) => `
                                    <div style="display:flex;align-items:center;gap:10px;padding:10px;background:#fff;border-radius:6px;margin-bottom:8px;">
                                        <div style="flex:1;">
                                            <input type="text" value="${emp.name}" onchange="updateEmployee(${i}, 'name', this.value)" style="border:none;font-weight:600;font-size:14px;width:100%;" placeholder="Employee name">
                                        </div>
                                        <div style="width:80px;">
                                            <input type="text" value="${emp.pin}" onchange="updateEmployee(${i}, 'pin', this.value)" maxlength="4" style="border:1px solid #ddd;border-radius:4px;padding:5px;text-align:center;font-family:monospace;width:100%;" placeholder="PIN">
                                        </div>
                                        <select onchange="updateEmployee(${i}, 'role', this.value)" style="border:1px solid #ddd;border-radius:4px;padding:5px;">
                                            <option value="staff" ${emp.role === 'staff' ? 'selected' : ''}>Staff</option>
                                            <option value="manager" ${emp.role === 'manager' ? 'selected' : ''}>Manager</option>
                                        </select>
                                        <button onclick="removeEmployee(${i})" style="background:#e74c3c;color:#fff;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;" ${employees.length <= 1 ? 'disabled' : ''}><i class="fas fa-trash"></i></button>
                                    </div>
                                `).join('')}
                            </div>
                            <button onclick="addEmployee()" style="width:100%;padding:10px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;"><i class="fas fa-plus"></i> Add Employee</button>
                        </div>
                        
                        <!-- Data Management -->
                        <div style="background:#fff3e0;padding:20px;border-radius:10px;margin-bottom:20px;">
                            <h4 style="margin:0 0 15px;color:#e65100;"><i class="fas fa-database"></i> Data Management</h4>
                            <div style="display:flex;gap:10px;flex-wrap:wrap;">
                                <button onclick="exportAllData()" style="flex:1;min-width:120px;padding:12px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;"><i class="fas fa-download"></i> Export All Data</button>
                                <button onclick="importDataFromFile()" style="flex:1;min-width:120px;padding:12px;background:#3498db;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;"><i class="fas fa-upload"></i> Import Data</button>
                                <button onclick="resetDemoData()" style="flex:1;min-width:120px;padding:12px;background:#e74c3c;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;"><i class="fas fa-redo"></i> Reset Data</button>
                            </div>
                        </div>
                        
                        <div style="display:flex;gap:10px;">
                            <button onclick="closeSettings()" style="flex:1;padding:14px;background:#95a5a6;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">Cancel</button>
                            <button onclick="saveAllSettings()" style="flex:1;padding:14px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;"><i class="fas fa-save"></i> Save Settings</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
            loadEmployeeList();
        }
        
        function closeSettings() {
            const modal = document.getElementById('settingsModal');
            if (modal) modal.remove();
        }
        
        function saveAllSettings() {
            localStorage.setItem('gc_business_name', document.getElementById('settingBusinessName').value);
            localStorage.setItem('gc_business_phone', document.getElementById('settingBusinessPhone').value);
            localStorage.setItem('gc_business_email', document.getElementById('settingBusinessEmail').value);
            localStorage.setItem('gc_business_address', document.getElementById('settingBusinessAddress').value);
            localStorage.setItem('gc_business_city', document.getElementById('settingBusinessCity').value);
            localStorage.setItem('gc_business_state', document.getElementById('settingBusinessState').value);
            localStorage.setItem('gc_business_zip', document.getElementById('settingBusinessZip').value);
            localStorage.setItem('gc_tax_rate', document.getElementById('settingTaxRate').value);
            localStorage.setItem('gc_time_format', document.getElementById('settingTimeFormat').value);
            localStorage.setItem('gc_date_format', document.getElementById('settingDateFormat').value);
            
            // Save Stripe settings
            const stripePK = document.getElementById('settingStripePK').value.trim();
            const stripeSK = document.getElementById('settingStripeSK').value.trim();
            if (stripePK) localStorage.setItem('gc_stripe_pk', stripePK);
            if (stripeSK) localStorage.setItem('gc_stripe_sk', stripeSK);
            
            closeSettings();
            showToast('Settings saved successfully!', 'success');
        }
        
        // Employee Management Functions
        function loadEmployeeList() {
            const container = document.getElementById('employeeList');
            if (!container) return;
            
            if (employees.length === 0) {
                container.innerHTML = '<p style="color: rgba(255,255,255,0.5); font-style: italic;">No employees added yet</p>';
                return;
            }
            
            container.innerHTML = employees.map((emp, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px;">
                    <div>
                        <strong>${emp.name}</strong>
                        <span style="color: rgba(255,255,255,0.5); margin-left: 10px;">PIN: ****</span>
                        ${emp.isManager ? '<span style="background: #f59e0b; color: black; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 10px;">Manager</span>' : ''}
                    </div>
                    <div>
                        <button onclick="editEmployee(${index})" style="background: #3b82f6; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px;">Edit</button>
                        <button onclick="deleteEmployee(${index})" style="background: #ef4444; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        function showAddEmployeeModal() {
            const name = prompt('Enter employee name:');
            if (!name) return;
            
            const pin = prompt('Enter 4-digit PIN for this employee:');
            if (!pin || pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                showToast('PIN must be exactly 4 digits', 'error');
                return;
            }
            
            // Check for duplicate PIN
            if (employees.some(emp => emp.pin === pin)) {
                showToast('This PIN is already in use', 'error');
                return;
            }
            
            const isManager = confirm('Is this employee a manager? (Managers can access settings and reports)');
            
            employees.push({ name, pin, isManager, clockedIn: false });
            localStorage.setItem('gc_employees', JSON.stringify(employees));
            
            loadEmployeeList();
            updatePinEmployeeButtons();
            showToast(`Employee "${name}" added successfully!`, 'success');
        }
        
        function editEmployee(index) {
            const emp = employees[index];
            if (!emp) return;
            
            const name = prompt('Enter new name:', emp.name);
            if (!name) return;
            
            const changePin = confirm('Do you want to change the PIN?');
            let pin = emp.pin;
            
            if (changePin) {
                pin = prompt('Enter new 4-digit PIN:');
                if (!pin || pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                    showToast('PIN must be exactly 4 digits', 'error');
                    return;
                }
                
                // Check for duplicate PIN (excluding current employee)
                if (employees.some((e, i) => i !== index && e.pin === pin)) {
                    showToast('This PIN is already in use', 'error');
                    return;
                }
            }
            
            const isManager = confirm('Is this employee a manager?');
            
            employees[index] = { ...emp, name, pin, isManager };
            localStorage.setItem('gc_employees', JSON.stringify(employees));
            
            loadEmployeeList();
            updatePinEmployeeButtons();
            showToast(`Employee "${name}" updated successfully!`, 'success');
        }
        
        function deleteEmployee(index) {
            const emp = employees[index];
            if (!emp) return;
            
            if (!confirm(`Are you sure you want to delete "${emp.name}"?`)) return;
            
            employees.splice(index, 1);
            localStorage.setItem('gc_employees', JSON.stringify(employees));
            
            loadEmployeeList();
            updatePinEmployeeButtons();
            showToast(`Employee deleted`, 'success');
        }
        
        function updatePinEmployeeButtons() {
            const container = document.getElementById('pinEmployeeButtons');
            if (!container) return;
            
            if (employees.length === 0) {
                container.innerHTML = '<p style="color: rgba(255,255,255,0.5);">No employees. Add employees in Settings.</p>';
                return;
            }
            
            container.innerHTML = employees.map(emp => `
                <button onclick="selectPinEmployee('${emp.name}')" style="padding: 15px 25px; font-size: 16px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                    ${emp.name}
                </button>
            `).join('');
        }
        
        function selectPinEmployee(name) {
            selectedPinEmployee = name;
            document.getElementById('pinEmployeeSelect').style.display = 'none';
            document.getElementById('pinEntrySection').style.display = 'block';
            document.getElementById('pinEmployeeName').textContent = name;
            currentPin = '';
            updatePinDisplay();
        }
        
        function backToEmployeeSelect() {
            selectedPinEmployee = null;
            currentPin = '';
            document.getElementById('pinEmployeeSelect').style.display = 'block';
            document.getElementById('pinEntrySection').style.display = 'none';
        }
        
        // Override openSettings to load employee list
        const originalOpenSettings = typeof openSettings === 'function' ? openSettings : null;
        function openSettingsWithEmployees() {
            if (originalOpenSettings) originalOpenSettings();
            else document.getElementById('settingsModal').classList.add('active');
            setTimeout(() => loadEmployeeList(), 100);
        }
        
        function exportAllData() {
            const data = {
                exportDate: new Date().toISOString(),
                version: '1.0',
                settings: {
                    businessName: localStorage.getItem('gc_business_name'),
                    businessPhone: localStorage.getItem('gc_business_phone'),
                    businessEmail: localStorage.getItem('gc_business_email'),
                    taxRate: localStorage.getItem('gc_tax_rate')
                },
                bookings: JSON.parse(localStorage.getItem('gc_bookings') || '[]'),
                customers: JSON.parse(localStorage.getItem('gc_customers') || '[]'),
                transactions: JSON.parse(localStorage.getItem('gc_transactions') || '[]'),
                tabs: JSON.parse(localStorage.getItem('gc_tabs') || '[]'),
                inventory: JSON.parse(localStorage.getItem('gc_inventory') || '[]'),
                giftCards: JSON.parse(localStorage.getItem('gc_gift_cards') || '{}')
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `golf-cove-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Data exported successfully!', 'success');
        }
        
        function importDataFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (data.bookings) localStorage.setItem('gc_bookings', JSON.stringify(data.bookings));
                        if (data.customers) localStorage.setItem('gc_customers', JSON.stringify(data.customers));
                        if (data.transactions) localStorage.setItem('gc_transactions', JSON.stringify(data.transactions));
                        if (data.tabs) localStorage.setItem('gc_tabs', JSON.stringify(data.tabs));
                        if (data.inventory) localStorage.setItem('gc_inventory', JSON.stringify(data.inventory));
                        if (data.giftCards) localStorage.setItem('gc_gift_cards', JSON.stringify(data.giftCards));
                        if (data.settings) {
                            if (data.settings.businessName) localStorage.setItem('gc_business_name', data.settings.businessName);
                            if (data.settings.businessPhone) localStorage.setItem('gc_business_phone', data.settings.businessPhone);
                            if (data.settings.taxRate) localStorage.setItem('gc_tax_rate', data.settings.taxRate);
                        }
                        
                        showToast('Data imported! Refreshing...', 'success');
                        setTimeout(() => location.reload(), 1500);
                    } catch (err) {
                        showToast('Invalid file format', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        // ============ STRIPE TERMINAL INTEGRATION ============
        let stripeTerminal = null;
        let connectedReader = null;
        let currentPaymentIntent = null;
        
        // Initialize Stripe Terminal
        async function initStripeTerminal() {
            const stripePK = localStorage.getItem('gc_stripe_pk');
            if (!stripePK) {
                console.log('Stripe not configured - using external terminal mode');
                return false;
            }
            
            try {
                stripeTerminal = StripeTerminal.create({
                    onFetchConnectionToken: async () => {
                        const response = await fetch('/api/createConnectionToken', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        const data = await response.json();
                        if (data.error) throw new Error(data.error);
                        return data.secret;
                    },
                    onUnexpectedReaderDisconnect: () => {
                        showToast('Card reader disconnected!', 'error');
                        connectedReader = null;
                        updateReaderStatus();
                    }
                });
                
                console.log('Stripe Terminal initialized');
                updateReaderStatus();
                return true;
            } catch (error) {
                console.error('Failed to initialize Stripe Terminal:', error);
                return false;
            }
        }
        
        // Discover available readers
        async function discoverReaders() {
            if (!stripeTerminal) {
                showToast('Stripe Terminal not initialized. Configure Stripe keys in Settings.', 'error');
                return [];
            }
            
            try {
                const config = { simulated: false };
                const discoverResult = await stripeTerminal.discoverReaders(config);
                
                if (discoverResult.error) {
                    showToast('Error discovering readers: ' + discoverResult.error.message, 'error');
                    return [];
                }
                
                return discoverResult.discoveredReaders;
            } catch (error) {
                showToast('Failed to discover readers', 'error');
                return [];
            }
        }
        
        // Connect to a reader
        async function connectToReader(reader) {
            if (!stripeTerminal) return false;
            
            try {
                const connectResult = await stripeTerminal.connectReader(reader);
                
                if (connectResult.error) {
                    showToast('Failed to connect: ' + connectResult.error.message, 'error');
                    return false;
                }
                
                connectedReader = connectResult.reader;
                localStorage.setItem('gc_connected_reader', JSON.stringify({
                    id: reader.id,
                    label: reader.label
                }));
                
                showToast('Connected to ' + (reader.label || 'Card Reader'), 'success');
                updateReaderStatus();
                return true;
            } catch (error) {
                showToast('Connection error: ' + error.message, 'error');
                return false;
            }
        }
        
        // Update reader status in UI
        function updateReaderStatus() {
            const statusEl = document.getElementById('readerStatus');
            if (statusEl) {
                if (connectedReader) {
                    statusEl.innerHTML = '<i class="fas fa-check-circle" style="color:#27ae60;"></i> ' + (connectedReader.label || 'Reader Connected');
                } else {
                    statusEl.innerHTML = '<i class="fas fa-times-circle" style="color:#e74c3c;"></i> No Reader Connected';
                }
            }
        }
        
        // Process card payment through Stripe Terminal
        async function processStripeTerminalPayment(amountCents, description) {
            if (!stripeTerminal || !connectedReader) {
                // Fall back to external terminal mode
                return { success: false, fallback: true };
            }
            
            try {
                // Create payment intent on server
                const response = await fetch('/api/createPaymentIntent', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        amount: amountCents,
                        description: description,
                        metadata: {
                            register: localStorage.getItem('gc_register_id') || 'POS-1'
                        }
                    })
                });
                
                const { clientSecret, paymentIntentId, error } = await response.json();
                if (error) throw new Error(error);
                
                currentPaymentIntent = paymentIntentId;
                
                // Collect payment method from reader
                showToast('Present card on reader...', 'info');
                const collectResult = await stripeTerminal.collectPaymentMethod(clientSecret);
                
                if (collectResult.error) {
                    throw new Error(collectResult.error.message);
                }
                
                // Confirm the payment
                showToast('Processing payment...', 'info');
                const confirmResult = await stripeTerminal.processPayment(collectResult.paymentIntent);
                
                if (confirmResult.error) {
                    throw new Error(confirmResult.error.message);
                }
                
                if (confirmResult.paymentIntent.status === 'succeeded') {
                    return { 
                        success: true, 
                        paymentIntentId: confirmResult.paymentIntent.id,
                        amount: confirmResult.paymentIntent.amount
                    };
                } else {
                    throw new Error('Payment not completed: ' + confirmResult.paymentIntent.status);
                }
                
            } catch (error) {
                showToast('Payment failed: ' + error.message, 'error');
                currentPaymentIntent = null;
                return { success: false, error: error.message };
            }
        }
        
        // Cancel current payment
        async function cancelStripePayment() {
            if (stripeTerminal && currentPaymentIntent) {
                try {
                    await stripeTerminal.cancelCollectPaymentMethod();
                    await fetch('/api/cancelPayment', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ paymentIntentId: currentPaymentIntent })
                    });
                } catch (e) {
                    console.log('Cancel cleanup:', e);
                }
                currentPaymentIntent = null;
            }
        }
        
        // Show reader setup modal
        function showReaderSetup() {
            const isConfigured = !!localStorage.getItem('gc_stripe_pk');
            const savedReader = JSON.parse(localStorage.getItem('gc_connected_reader') || 'null');
            
            const html = `
                <div id="readerSetupModal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;">
                    <div style="background:#fff;padding:25px;border-radius:12px;max-width:500px;width:95%;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                            <h2 style="margin:0;color:#4a90a4;"><i class="fab fa-stripe"></i> Card Reader Setup</h2>
                            <button onclick="closeReaderSetup()" style="background:none;border:none;font-size:24px;cursor:pointer;">&times;</button>
                        </div>
                        
                        ${!isConfigured ? `
                            <div style="background:#fff3e0;padding:15px;border-radius:8px;margin-bottom:20px;">
                                <i class="fas fa-exclamation-triangle" style="color:#f57c00;"></i>
                                <strong>Stripe Not Configured</strong>
                                <p style="margin:5px 0 0;font-size:13px;">Add your Stripe API keys in Settings first.</p>
                                <button onclick="closeReaderSetup(); showSettingsModal();" style="margin-top:10px;padding:8px 15px;background:#4a90a4;color:#fff;border:none;border-radius:6px;cursor:pointer;">Open Settings</button>
                            </div>
                        ` : `
                            <div style="margin-bottom:20px;">
                                <div id="readerStatus" style="padding:15px;background:#f8f9fa;border-radius:8px;text-align:center;font-size:14px;">
                                    ${connectedReader ? 
                                        `<i class="fas fa-check-circle" style="color:#27ae60;"></i> Connected: ${connectedReader.label || 'Card Reader'}` : 
                                        `<i class="fas fa-times-circle" style="color:#e74c3c;"></i> No Reader Connected`}
                                </div>
                            </div>
                            
                            <div style="display:flex;flex-direction:column;gap:10px;">
                                <button onclick="scanForReaders()" style="padding:12px;background:#3498db;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                                    <i class="fas fa-search"></i> Scan for Readers
                                </button>
                                
                                <div id="readerList" style="display:none;margin:10px 0;"></div>
                                
                                ${savedReader ? `
                                    <button onclick="reconnectSavedReader()" style="padding:12px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                                        <i class="fas fa-plug"></i> Reconnect to ${savedReader.label || 'Saved Reader'}
                                    </button>
                                ` : ''}
                                
                                <button onclick="useSimulatedReader()" style="padding:12px;background:#95a5a6;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                                    <i class="fas fa-laptop"></i> Use Simulated Reader (Testing)
                                </button>
                            </div>
                            
                            <div style="margin-top:20px;padding:15px;background:#e3f2fd;border-radius:8px;font-size:12px;color:#1565c0;">
                                <strong>Need a card reader?</strong><br>
                                Purchase Stripe Terminal hardware at <a href="https://stripe.com/terminal" target="_blank" style="color:#1565c0;">stripe.com/terminal</a>
                            </div>
                        `}
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }
        
        function closeReaderSetup() {
            const modal = document.getElementById('readerSetupModal');
            if (modal) modal.remove();
        }
        
        async function scanForReaders() {
            const listEl = document.getElementById('readerList');
            listEl.innerHTML = '<div style="text-align:center;padding:20px;"><i class="fas fa-spinner fa-spin"></i> Scanning...</div>';
            listEl.style.display = 'block';
            
            const readers = await discoverReaders();
            
            if (readers.length === 0) {
                listEl.innerHTML = '<div style="text-align:center;padding:20px;color:#666;">No readers found. Make sure your reader is powered on and connected to the same network.</div>';
            } else {
                listEl.innerHTML = readers.map(r => `
                    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#f8f9fa;border-radius:6px;margin-bottom:8px;">
                        <div>
                            <strong>${r.label || r.id}</strong>
                            <div style="font-size:11px;color:#666;">${r.device_type} • ${r.status}</div>
                        </div>
                        <button onclick="selectReader('${r.id}')" style="padding:8px 15px;background:#27ae60;color:#fff;border:none;border-radius:6px;cursor:pointer;">Connect</button>
                    </div>
                `).join('');
            }
        }
        
        async function selectReader(readerId) {
            const readers = await discoverReaders();
            const reader = readers.find(r => r.id === readerId);
            if (reader) {
                const success = await connectToReader(reader);
                if (success) closeReaderSetup();
            }
        }
        
        async function useSimulatedReader() {
            if (!stripeTerminal) {
                await initStripeTerminal();
            }
            
            try {
                const discoverResult = await stripeTerminal.discoverReaders({ simulated: true });
                if (discoverResult.discoveredReaders.length > 0) {
                    const reader = discoverResult.discoveredReaders[0];
                    const connectResult = await stripeTerminal.connectReader(reader);
                    if (!connectResult.error) {
                        connectedReader = connectResult.reader;
                        showToast('Simulated reader connected (for testing)', 'success');
                        updateReaderStatus();
                        closeReaderSetup();
                    }
                }
            } catch (error) {
                showToast('Failed to connect simulated reader', 'error');
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize PIN lock screen
            if (employees.length > 0) {
                // Show the lock screen if there are employees
                document.getElementById('lockScreen').style.display = 'flex';
            } else {
                // No employees yet, skip the lock screen
                isLocked = false;
                document.getElementById('lockScreen').style.display = 'none';
            }
            
            // Try to initialize Stripe Terminal
            setTimeout(() => {
                initStripeTerminal();
            }, 1000);
        });
    </script>
</body>
</html>