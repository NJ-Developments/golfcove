<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Golf Cove - New Haven</title>
    <link rel="icon" type="image/png" href="images/golfCoveLogo6.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .standings-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .standings-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .standings-header h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
        }
        .standings-header p {
            color: #666;
            font-size: 16px;
        }
        .live-badge {
            display: inline-block;
            background: #37b24a;
            color: #fff;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 15px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 25px;
        }
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }
        .tab.active {
            color: #37b24a;
            border-bottom-color: #37b24a;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .standings-table {
            width: 100%;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }
        .standings-table th,
        .standings-table td {
            padding: 15px;
            text-align: left;
        }
        .standings-table th {
            background: #333;
            color: #fff;
            font-weight: 600;
            font-size: 14px;
        }
        .standings-table th:first-child {
            width: 60px;
            text-align: center;
        }
        .standings-table td {
            border-bottom: 1px solid #eee;
        }
        .standings-table tr:hover {
            background: #f9f9f9;
        }
        .standings-table tr:last-child td {
            border-bottom: none;
        }
        .position {
            text-align: center;
            font-weight: 700;
            font-size: 18px;
        }
        .pos-1 { color: #ffd700; }
        .pos-2 { color: #c0c0c0; }
        .pos-3 { color: #cd7f32; }
        .player-name {
            font-weight: 600;
            color: #333;
        }
        .player-hcp {
            color: #888;
            font-size: 13px;
            margin-left: 8px;
        }
        .score-cell {
            font-weight: 700;
            font-size: 18px;
        }
        .score-cell.highlight {
            color: #37b24a;
        }
        .thru-cell {
            color: #666;
            font-size: 14px;
        }
        .status-playing {
            color: #37b24a;
        }
        .status-finished {
            color: #888;
        }
        .expand-row {
            display: none;
            background: #f9f9f9;
        }
        .expand-row.open {
            display: table-row;
        }
        .expand-row td {
            padding: 20px;
        }
        .hole-scores {
            display: grid;
            grid-template-columns: repeat(9, 1fr) auto;
            gap: 3px;
            max-width: 600px;
            text-align: center;
            font-size: 12px;
        }
        .hole-scores .h {
            background: #e0e0e0;
            padding: 8px 4px;
            font-weight: 600;
        }
        .hole-scores .p {
            background: #f0f0f0;
            padding: 8px 4px;
            color: #666;
        }
        .hole-scores .s {
            padding: 8px 4px;
            font-weight: 600;
            background: #fff;
        }
        .hole-scores .s.under { color: #37b24a; background: #e8f5e9; }
        .hole-scores .s.over { color: #f44336; background: #ffebee; }
        .hole-scores .out {
            background: #333;
            color: #fff;
            padding: 8px 4px;
            font-weight: 600;
        }
        .round-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .round-btn {
            padding: 10px 20px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            text-decoration: none;
        }
        .round-btn.active {
            background: #37b24a;
            border-color: #37b24a;
            color: #fff;
        }
        .refresh-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: #f5f5f5;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #666;
        }
        .refresh-btn {
            padding: 8px 20px;
            background: #37b24a;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #37b24a;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        .empty-state i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <a href="tel:2033905994"><i class="fas fa-phone"></i> 203.390.5994</a>
            </div>
            <div class="top-bar-right">
                <div class="social-links">
                    <a href="https://www.facebook.com/golfcove/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.instagram.com/golfcovect/" target="_blank"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-main">
            <div class="logo">
                <a href="index.html">
                    <img src="images/golfCoveLogo6.png" alt="Golf Cove Logo">
                </a>
            </div>
        </div>
    </header>

    <div class="standings-container">
        <a href="tournaments.html" class="back-link"><i class="fas fa-arrow-left"></i> Back</a>

        <div class="standings-header">
            <h1 id="leagueTitle">Loading...</h1>
            <p id="leagueSubtitle"></p>
            <span class="live-badge" id="liveBadge" style="display: none;">
                <i class="fas fa-circle"></i> LIVE
            </span>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="season" onclick="standings.switchTab('season')">Season Standings</div>
            <div class="tab" data-tab="round" onclick="standings.switchTab('round')">This Round</div>
        </div>

        <div id="roundNav" class="round-nav" style="display: none;">
            <!-- Round buttons -->
        </div>

        <div class="refresh-bar">
            <span id="lastUpdate">Last updated: --</span>
            <button class="refresh-btn" onclick="standings.refresh()">
                <i class="fas fa-sync"></i> Refresh
            </button>
        </div>

        <div id="seasonTab" class="tab-content active">
            <table class="standings-table" id="seasonTable">
                <!-- Season standings -->
            </table>
        </div>

        <div id="roundTab" class="tab-content">
            <table class="standings-table" id="roundTable">
                <!-- Round scores -->
            </table>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        const standings = {
            league: null,
            currentRoundId: null,
            activeTab: 'season',
            refreshInterval: null,

            init() {
                this.league = JSON.parse(localStorage.getItem('golfcove_league') || 'null');
                
                if (!this.league) {
                    document.getElementById('leagueTitle').textContent = 'No League Found';
                    return;
                }

                const params = new URLSearchParams(window.location.search);
                this.currentRoundId = params.get('r');

                // If specific round requested, show that tab
                if (this.currentRoundId) {
                    this.activeTab = 'round';
                } else if (this.league.rounds.length > 0) {
                    // Default to most recent round
                    this.currentRoundId = this.league.rounds[this.league.rounds.length - 1].id;
                }

                this.render();
                this.startAutoRefresh();
            },

            switchTab(tab) {
                this.activeTab = tab;
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(tab + 'Tab').classList.add('active');
                document.getElementById('roundNav').style.display = tab === 'round' ? 'flex' : 'none';
            },

            render() {
                const l = this.league;
                
                document.getElementById('leagueTitle').textContent = l.name;
                document.getElementById('leagueSubtitle').textContent = `${l.season} â€¢ ${l.course.name}`;
                document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;

                // Check if there's live scoring
                const hasLive = l.rounds.some(r => {
                    const scores = l.scores[r.id] || {};
                    const hasScores = Object.keys(scores).length > 0;
                    const allDone = l.players.every(p => scores[p.id]?.submitted);
                    return hasScores && !allDone;
                });
                document.getElementById('liveBadge').style.display = hasLive ? 'inline-block' : 'none';

                // Round navigation
                if (l.rounds.length > 0) {
                    document.getElementById('roundNav').innerHTML = l.rounds.map(r => `
                        <a href="?r=${r.id}" class="round-btn ${r.id === this.currentRoundId ? 'active' : ''}">${r.name}</a>
                    `).join('');
                }

                this.renderSeasonStandings();
                this.renderRoundScores();

                // Switch to correct tab
                this.switchTab(this.activeTab);
            },

            calculateSeasonStandings() {
                const l = this.league;
                
                return l.players.map(player => {
                    let totalGross = 0;
                    let totalNet = 0;
                    let roundsPlayed = 0;
                    const roundDetails = [];

                    l.rounds.forEach(round => {
                        const ps = l.scores[round.id]?.[player.id];
                        if (ps && ps.submitted) {
                            const gross = Object.keys(ps)
                                .filter(k => !isNaN(k))
                                .reduce((sum, h) => sum + (ps[h] || 0), 0);
                            totalGross += gross;
                            totalNet += gross - (player.handicap || 0);
                            roundsPlayed++;
                            roundDetails.push({ round: round.name, gross, net: gross - player.handicap });
                        }
                    });

                    return {
                        id: player.id,
                        name: player.name,
                        handicap: player.handicap,
                        totalGross,
                        totalNet,
                        roundsPlayed,
                        roundDetails,
                        avg: roundsPlayed > 0 ? (totalGross / roundsPlayed).toFixed(1) : '-'
                    };
                }).sort((a, b) => {
                    if (a.roundsPlayed === 0 && b.roundsPlayed === 0) return 0;
                    if (a.roundsPlayed === 0) return 1;
                    if (b.roundsPlayed === 0) return -1;
                    return a.totalNet - b.totalNet;
                });
            },

            renderSeasonStandings() {
                const standings = this.calculateSeasonStandings();
                
                if (standings.every(s => s.roundsPlayed === 0)) {
                    document.getElementById('seasonTable').innerHTML = `
                        <tr><td colspan="6" class="empty-state">
                            <i class="fas fa-trophy"></i>
                            <p>No scores yet. Standings will appear after the first round.</p>
                        </td></tr>
                    `;
                    return;
                }

                document.getElementById('seasonTable').innerHTML = `
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Player</th>
                            <th>Rounds</th>
                            <th>Total Net</th>
                            <th>Avg</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${standings.map((s, i) => `
                            <tr onclick="standings.toggleExpand('season-${s.id}')" style="cursor: pointer;">
                                <td class="position ${i < 3 ? 'pos-' + (i+1) : ''}">${s.roundsPlayed > 0 ? i + 1 : '-'}</td>
                                <td>
                                    <span class="player-name">${s.name}</span>
                                    <span class="player-hcp">HCP: ${s.handicap}</span>
                                </td>
                                <td>${s.roundsPlayed}</td>
                                <td class="score-cell highlight">${s.totalNet || '-'}</td>
                                <td class="thru-cell">${s.avg}</td>
                            </tr>
                            <tr class="expand-row" id="season-${s.id}">
                                <td colspan="5">
                                    <strong>Round History:</strong>
                                    ${s.roundDetails.length === 0 ? '<p>No rounds completed.</p>' : `
                                        <table style="margin-top: 10px; font-size: 14px;">
                                            ${s.roundDetails.map(r => {
                                                const PAR = 36;
                                                const netToPar = r.net - PAR;
                                                const netDisplay = netToPar === 0 ? 'E' : (netToPar > 0 ? '+' + netToPar : String(netToPar));
                                                const netColor = r.net < PAR ? '#37b24a' : r.net > PAR ? '#f44336' : '#333';
                                                return `
                                                <tr>
                                                    <td style="padding: 5px 15px 5px 0;">${r.round}</td>
                                                    <td style="padding: 5px 15px;">Gross: ${r.gross}</td>
                                                    <td style="padding: 5px 15px; font-weight: 600; color: ${netColor};">+/-: ${netDisplay}</td>
                                                </tr>
                                            `;
                                            }).join('')}
                                        </table>
                                    `}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
            },

            renderRoundScores() {
                if (!this.currentRoundId) {
                    document.getElementById('roundTable').innerHTML = '<tr><td class="empty-state">No round selected.</td></tr>';
                    return;
                }

                const l = this.league;
                const round = l.rounds.find(r => r.id === this.currentRoundId);
                const holes = l.course.holes;
                const scores = l.scores[this.currentRoundId] || {};

                const playerScores = l.players.map(player => {
                    const ps = scores[player.id] || {};
                    let gross = 0;
                    let holesPlayed = 0;
                    let totalPar = 0;

                    for (let h = 1; h <= holes; h++) {
                        if (ps[h]) {
                            gross += ps[h];
                            holesPlayed++;
                            totalPar += l.course.pars[h-1] || 4;
                        }
                    }

                    return {
                        id: player.id,
                        name: player.name,
                        handicap: player.handicap,
                        gross,
                        net: gross - (player.handicap || 0),
                        holesPlayed,
                        toPar: gross - totalPar,
                        submitted: ps.submitted,
                        scores: ps
                    };
                }).sort((a, b) => {
                    if (a.holesPlayed === 0 && b.holesPlayed === 0) return 0;
                    if (a.holesPlayed === 0) return 1;
                    if (b.holesPlayed === 0) return -1;
                    return a.gross - b.gross;
                });

                document.getElementById('roundTable').innerHTML = `
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Player</th>
                            <th>To Par</th>
                            <th>Gross</th>
                            <th>Thru</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${playerScores.map((s, i) => `
                            <tr onclick="standings.toggleExpand('round-${s.id}')" style="cursor: pointer;">
                                <td class="position ${i < 3 && s.holesPlayed > 0 ? 'pos-' + (i+1) : ''}">${s.holesPlayed > 0 ? i + 1 : '-'}</td>
                                <td>
                                    <span class="player-name">${s.name}</span>
                                    <span class="player-hcp">HCP: ${s.handicap}</span>
                                </td>
                                <td class="score-cell" style="color: ${s.toPar < 0 ? '#37b24a' : s.toPar > 0 ? '#f44336' : '#333'}">
                                    ${s.holesPlayed > 0 ? (s.toPar === 0 ? 'E' : (s.toPar > 0 ? '+' : '') + s.toPar) : '-'}
                                </td>
                                <td class="score-cell">${s.gross || '-'}</td>
                                <td class="thru-cell">${s.holesPlayed > 0 ? (s.holesPlayed === holes ? 'F' : s.holesPlayed) : '-'}</td>
                                <td class="${s.submitted ? 'status-finished' : 'status-playing'}">
                                    ${s.submitted ? '<i class="fas fa-check"></i>' : s.holesPlayed > 0 ? '<i class="fas fa-golf-ball"></i>' : '-'}
                                </td>
                            </tr>
                            <tr class="expand-row" id="round-${s.id}">
                                <td colspan="6">
                                    ${this.renderHoleByHole(s.scores, holes)}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
            },

            renderHoleByHole(scores, holes) {
                const l = this.league;
                let html = '<div class="hole-scores">';
                
                // Front 9
                for (let i = 1; i <= 9; i++) html += `<div class="h">${i}</div>`;
                html += '<div class="out">OUT</div>';
                
                for (let i = 1; i <= 9; i++) html += `<div class="p">${l.course.pars[i-1] || 4}</div>`;
                let frontPar = 0;
                for (let i = 0; i < 9; i++) frontPar += l.course.pars[i] || 4;
                html += `<div class="out">${frontPar}</div>`;
                
                let frontScore = 0;
                for (let i = 1; i <= 9; i++) {
                    const s = scores[i];
                    const p = l.course.pars[i-1] || 4;
                    if (s) frontScore += s;
                    const cls = s ? (s < p ? 'under' : s > p ? 'over' : '') : '';
                    html += `<div class="s ${cls}">${s || '-'}</div>`;
                }
                html += `<div class="out">${frontScore || '-'}</div>`;

                html += '</div>';

                if (holes > 9) {
                    html += '<div class="hole-scores" style="margin-top: 5px;">';
                    for (let i = 10; i <= 18; i++) html += `<div class="h">${i}</div>`;
                    html += '<div class="out">IN</div>';
                    
                    for (let i = 10; i <= 18; i++) html += `<div class="p">${l.course.pars[i-1] || 4}</div>`;
                    let backPar = 0;
                    for (let i = 9; i < 18; i++) backPar += l.course.pars[i] || 4;
                    html += `<div class="out">${backPar}</div>`;
                    
                    let backScore = 0;
                    for (let i = 10; i <= 18; i++) {
                        const s = scores[i];
                        const p = l.course.pars[i-1] || 4;
                        if (s) backScore += s;
                        const cls = s ? (s < p ? 'under' : s > p ? 'over' : '') : '';
                        html += `<div class="s ${cls}">${s || '-'}</div>`;
                    }
                    html += `<div class="out">${backScore || '-'}</div>`;
                    html += '</div>';
                    
                    html += `<div style="text-align: right; margin-top: 10px; font-weight: 600;">Total: ${(frontScore + backScore) || '-'}</div>`;
                }

                return html;
            },

            toggleExpand(id) {
                document.getElementById(id).classList.toggle('open');
            },

            refresh() {
                this.league = JSON.parse(localStorage.getItem('golfcove_league') || 'null');
                this.render();
            },

            startAutoRefresh() {
                this.refreshInterval = setInterval(() => this.refresh(), 15000);
            }
        };

        document.addEventListener('DOMContentLoaded', () => standings.init());
    </script>
</body>
</html>



