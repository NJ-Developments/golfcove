<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Cove - Billing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f6fa; min-height: 100vh; }
        
        /* Header - matches other Golf Cove pages */
        .header { background: #4a90a4; color: #fff; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; height: 60px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-left { display: flex; align-items: center; gap: 30px; }
        .header-logo { display: flex; align-items: center; gap: 10px; font-size: 1.3rem; font-weight: 700; }
        .header-logo img { height: 35px; }
        .header-nav { display: flex; gap: 5px; }
        .header-nav a { color: rgba(255,255,255,0.85); text-decoration: none; padding: 8px 15px; border-radius: 6px; font-size: 14px; font-weight: 500; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
        .header-nav a:hover { background: rgba(255,255,255,0.15); color: #fff; }
        .header-nav a.active { background: rgba(255,255,255,0.2); color: #fff; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .header-user { display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .current-time { font-size: 14px; font-weight: 600; opacity: 0.9; }
        
        /* Main Layout */
        .main-container { display: flex; height: calc(100vh - 60px); }
        
        /* Sidebar */
        .sidebar { width: 300px; background: #fff; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid #eee; }
        .sidebar-header h2 { font-size: 1.1rem; color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .sidebar-header h2 i { color: #4a90a4; }
        .search-box { position: relative; }
        .search-box input { width: 100%; padding: 10px 15px 10px 40px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; }
        .search-box i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999; }
        
        .sidebar-filters { padding: 15px 20px; border-bottom: 1px solid #eee; }
        .filter-group { margin-bottom: 10px; }
        .filter-group label { font-size: 0.8rem; color: #666; display: block; margin-bottom: 5px; }
        .filter-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
        
        .sidebar-stats { padding: 15px 20px; background: #f8f9fa; border-bottom: 1px solid #eee; }
        .stat-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.9rem; }
        .stat-row span:last-child { font-weight: 600; color: #4a90a4; }
        .stat-row.positive span:last-child { color: #27ae60; }
        .stat-row.negative span:last-child { color: #e74c3c; }
        
        .invoice-list { flex: 1; overflow-y: auto; }
        .invoice-item { padding: 15px 20px; border-bottom: 1px solid #eee; cursor: pointer; transition: background 0.2s; }
        .invoice-item:hover { background: #f5f6fa; }
        .invoice-item.active { background: #e8f4f8; border-left: 3px solid #4a90a4; }
        .invoice-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .invoice-number { font-weight: 600; color: #333; font-size: 0.95rem; }
        .invoice-status { font-size: 0.7rem; padding: 3px 8px; border-radius: 12px; font-weight: 600; text-transform: uppercase; }
        .invoice-status.paid { background: #d4edda; color: #155724; }
        .invoice-status.pending { background: #fff3cd; color: #856404; }
        .invoice-status.overdue { background: #f8d7da; color: #721c24; }
        .invoice-status.draft { background: #e2e3e5; color: #383d41; }
        .invoice-customer { font-size: 0.85rem; color: #666; margin-bottom: 5px; }
        .invoice-meta { display: flex; justify-content: space-between; font-size: 0.8rem; color: #999; }
        .invoice-amount { font-weight: 700; color: #333; }
        
        /* Content Area */
        .content-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .content-header { padding: 20px 25px; background: #fff; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .content-header h2 { font-size: 1.3rem; color: #333; }
        .header-actions { display: flex; gap: 10px; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
        .btn-primary { background: #4a90a4; color: #fff; }
        .btn-primary:hover { background: #3d7a8c; }
        .btn-success { background: #27ae60; color: #fff; }
        .btn-success:hover { background: #219a52; }
        .btn-warning { background: #f39c12; color: #fff; }
        .btn-warning:hover { background: #d68910; }
        .btn-danger { background: #e74c3c; color: #fff; }
        .btn-danger:hover { background: #c0392b; }
        .btn-secondary { background: #95a5a6; color: #fff; }
        .btn-secondary:hover { background: #7f8c8d; }
        .btn-outline { background: transparent; border: 1px solid #ddd; color: #666; }
        .btn-outline:hover { background: #f5f6fa; }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
        
        /* Tabs */
        .content-tabs { display: flex; background: #fff; border-bottom: 1px solid #eee; padding: 0 25px; }
        .tab-btn { padding: 15px 25px; border: none; background: none; cursor: pointer; font-size: 0.95rem; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s; }
        .tab-btn:hover { color: #333; }
        .tab-btn.active { color: #4a90a4; border-bottom-color: #4a90a4; font-weight: 600; }
        
        /* Tab Content */
        .tab-content { flex: 1; overflow-y: auto; padding: 25px; }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        
        /* Invoice Detail */
        .invoice-detail { background: #fff; border-radius: 12px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .invoice-detail-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #eee; }
        .invoice-brand { display: flex; align-items: center; gap: 15px; }
        .invoice-brand img { height: 50px; }
        .invoice-brand h3 { font-size: 1.5rem; color: #333; }
        .invoice-info { text-align: right; }
        .invoice-info h2 { font-size: 1.8rem; color: #4a90a4; margin-bottom: 5px; }
        .invoice-info p { color: #666; font-size: 0.9rem; }
        
        .invoice-parties { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .party-box h4 { font-size: 0.85rem; color: #999; text-transform: uppercase; margin-bottom: 10px; }
        .party-box p { color: #333; line-height: 1.6; }
        .party-box .name { font-weight: 600; font-size: 1.1rem; }
        
        .invoice-dates { display: flex; gap: 30px; margin-bottom: 30px; padding: 15px 20px; background: #f8f9fa; border-radius: 8px; }
        .date-item label { font-size: 0.75rem; color: #999; display: block; }
        .date-item span { font-weight: 600; color: #333; }
        
        /* Invoice Items Table */
        .invoice-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .invoice-table th { text-align: left; padding: 12px; background: #4a90a4; color: #fff; font-size: 0.85rem; font-weight: 600; }
        .invoice-table th:first-child { border-radius: 8px 0 0 0; }
        .invoice-table th:last-child { border-radius: 0 8px 0 0; text-align: right; }
        .invoice-table td { padding: 15px 12px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .invoice-table td:last-child { text-align: right; font-weight: 600; }
        .invoice-table tr:hover { background: #f8f9fa; }
        .item-desc { font-weight: 500; color: #333; }
        .item-detail { font-size: 0.8rem; color: #999; margin-top: 3px; }
        
        .invoice-summary { display: flex; justify-content: flex-end; }
        .summary-box { width: 300px; }
        .summary-row { display: flex; justify-content: space-between; padding: 10px 0; font-size: 0.95rem; }
        .summary-row.total { border-top: 2px solid #333; font-size: 1.2rem; font-weight: 700; margin-top: 10px; padding-top: 15px; }
        .summary-row.total .amount { color: #4a90a4; }
        
        .invoice-notes { margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        .invoice-notes h4 { font-size: 0.9rem; color: #666; margin-bottom: 10px; }
        .invoice-notes p { font-size: 0.85rem; color: #999; line-height: 1.6; }
        
        /* Summary Cards */
        .summary-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 25px; }
        .summary-card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .summary-card.highlight { background: linear-gradient(135deg, #4a90a4 0%, #3d7a8c 100%); color: #fff; }
        .summary-card h4 { font-size: 0.85rem; color: #999; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .summary-card.highlight h4 { color: rgba(255,255,255,0.8); }
        .summary-card .value { font-size: 1.8rem; font-weight: 700; color: #333; }
        .summary-card.highlight .value { color: #fff; }
        .summary-card .change { font-size: 0.8rem; color: #27ae60; margin-top: 5px; }
        .summary-card .change.negative { color: #e74c3c; }
        
        /* Recent Transactions */
        .recent-section { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .recent-section h3 { font-size: 1rem; color: #333; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .transaction-list { }
        .transaction-row { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .transaction-row:last-child { border-bottom: none; }
        .transaction-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
        .transaction-icon.income { background: #d4edda; color: #27ae60; }
        .transaction-icon.expense { background: #f8d7da; color: #e74c3c; }
        .transaction-details { flex: 1; }
        .transaction-details .name { font-weight: 600; color: #333; }
        .transaction-details .desc { font-size: 0.8rem; color: #999; }
        .transaction-amount { font-weight: 700; }
        .transaction-amount.positive { color: #27ae60; }
        .transaction-amount.negative { color: #e74c3c; }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: #fff; border-radius: 16px; width: 90%; max-width: 600px; max-height: 90vh; overflow: hidden; transform: scale(0.9); transition: transform 0.3s; }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal.large { max-width: 800px; }
        .modal-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 1.2rem; color: #333; }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999; }
        .modal-body { padding: 20px; max-height: 60vh; overflow-y: auto; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: #4a90a4; outline: none; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-row.three { grid-template-columns: 1fr 1fr 1fr; }
        
        /* Line Items Editor */
        .line-items { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
        .line-item-header { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 40px; gap: 10px; padding: 10px 15px; background: #f8f9fa; font-size: 0.8rem; font-weight: 600; color: #666; }
        .line-item-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 40px; gap: 10px; padding: 10px 15px; border-bottom: 1px solid #eee; align-items: center; }
        .line-item-row input { padding: 8px; font-size: 0.9rem; }
        .line-item-row .remove-btn { background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 1.1rem; }
        .add-line-btn { width: 100%; padding: 10px; background: none; border: none; color: #4a90a4; cursor: pointer; font-size: 0.9rem; }
        .add-line-btn:hover { background: #f8f9fa; }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state i { font-size: 4rem; margin-bottom: 15px; opacity: 0.3; }
        .empty-state p { font-size: 1rem; }
        
        /* Toast */
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 15px 25px; background: #333; color: #fff; border-radius: 8px; font-size: 0.9rem; opacity: 0; transform: translateY(20px); transition: all 0.3s; z-index: 9999; }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.success { background: #27ae60; }
        .toast.error { background: #e74c3c; }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .summary-cards { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .summary-cards { grid-template-columns: 1fr; }
        }
        
        /* Print Styles */
        @media print {
            .header, .sidebar, .content-tabs, .header-actions { display: none !important; }
            .content-area { margin: 0; }
            .invoice-detail { box-shadow: none; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <a href="index.html" class="header-logo" style="text-decoration:none; color:#fff;">
                <img src="images/golfCoveLogo6.png" alt="Golf Cove">
                <span>Golf Cove</span>
            </a>
            <nav class="header-nav">
                <a href="admin-pos.html"><i class="fas fa-calendar-alt"></i> Tee Sheet</a>
                <a href="admin-pos.html" onclick="localStorage.setItem('gc_page','fnb')"><i class="fas fa-utensils"></i> F&B</a>
                <a href="sales.html"><i class="fas fa-cash-register"></i> Sales</a>
                <a href="customers.html"><i class="fas fa-users"></i> Customers</a>
                <a href="billing.html" class="active"><i class="fas fa-file-invoice-dollar"></i> Billing</a>
            </nav>
        </div>
        <div class="header-right">
            <span class="current-time" id="currentTime">--:--</span>
            <div class="header-user">
                <i class="fas fa-user-circle" style="font-size: 24px;"></i>
                <span>Admin</span>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <!-- Sidebar: Invoice List -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-file-invoice-dollar"></i> Invoices</h2>
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="invoiceSearch" placeholder="Search invoices..." oninput="filterInvoices()">
                </div>
            </div>
            <div class="sidebar-filters">
                <div class="filter-group">
                    <label>Filter by Status</label>
                    <select id="filterStatus" onchange="filterInvoices()">
                        <option value="all">All Invoices</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="overdue">Overdue</option>
                        <option value="draft">Draft</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Date Range</label>
                    <select id="filterDate" onchange="filterInvoices()">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month" selected>This Month</option>
                        <option value="year">This Year</option>
                    </select>
                </div>
            </div>
            <div class="sidebar-stats">
                <div class="stat-row"><span>Total Invoiced</span><span id="statTotal">$0.00</span></div>
                <div class="stat-row positive"><span>Collected</span><span id="statPaid">$0.00</span></div>
                <div class="stat-row negative"><span>Outstanding</span><span id="statOutstanding">$0.00</span></div>
            </div>
            <div class="invoice-list" id="invoiceList">
                <!-- Invoice items rendered here -->
            </div>
        </aside>
        
        <!-- Main Content Area -->
        <main class="content-area">
            <div class="content-header">
                <h2 id="contentTitle">Billing Overview</h2>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="showRecurringBilling()"><i class="fas fa-sync"></i> Recurring</button>
                    <button class="btn btn-secondary" onclick="exportInvoices()"><i class="fas fa-download"></i> Export</button>
                    <button class="btn btn-primary" onclick="showModal('newInvoice')"><i class="fas fa-plus"></i> New Invoice</button>
                </div>
            </div>
            
            <div class="content-tabs">
                <button class="tab-btn active" onclick="switchTab('overview', this)">Overview</button>
                <button class="tab-btn" onclick="switchTab('invoices', this)">All Invoices</button>
                <button class="tab-btn" onclick="switchTab('recurring', this)">Recurring</button>
                <button class="tab-btn" onclick="switchTab('payments', this)">Payments</button>
            </div>
            
            <div class="tab-content">
                <!-- Overview Tab -->
                <div id="tab-overview" class="tab-panel active">
                    <div class="summary-cards">
                        <div class="summary-card highlight">
                            <h4><i class="fas fa-dollar-sign"></i> Total Revenue</h4>
                            <div class="value" id="totalRevenue">$0.00</div>
                            <div class="change"><i class="fas fa-arrow-up"></i> 12% from last month</div>
                        </div>
                        <div class="summary-card">
                            <h4><i class="fas fa-file-invoice"></i> Outstanding</h4>
                            <div class="value" id="outstandingAmount">$0.00</div>
                            <div class="change negative"><i class="fas fa-clock"></i> 5 pending invoices</div>
                        </div>
                        <div class="summary-card">
                            <h4><i class="fas fa-check-circle"></i> Paid This Month</h4>
                            <div class="value" id="paidThisMonth">$0.00</div>
                            <div class="change"><i class="fas fa-arrow-up"></i> 8% from last month</div>
                        </div>
                        <div class="summary-card">
                            <h4><i class="fas fa-exclamation-triangle"></i> Overdue</h4>
                            <div class="value" id="overdueAmount">$0.00</div>
                            <div class="change negative"><i class="fas fa-arrow-down"></i> 2 overdue invoices</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="recent-section">
                            <h3><i class="fas fa-history"></i> Recent Payments</h3>
                            <div class="transaction-list" id="recentPayments">
                                <!-- Rendered dynamically -->
                            </div>
                        </div>
                        <div class="recent-section">
                            <h3><i class="fas fa-clock"></i> Upcoming Due</h3>
                            <div class="transaction-list" id="upcomingDue">
                                <!-- Rendered dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Invoice Detail Tab -->
                <div id="tab-invoices" class="tab-panel">
                    <div id="invoiceDetail">
                        <div class="empty-state">
                            <i class="fas fa-file-invoice"></i>
                            <p>Select an invoice from the list to view details</p>
                        </div>
                    </div>
                </div>
                
                <!-- Recurring Tab -->
                <div id="tab-recurring" class="tab-panel">
                    <div class="recent-section">
                        <h3><i class="fas fa-sync"></i> Recurring Billing Schedules</h3>
                        <div id="recurringList">
                            <!-- Rendered dynamically -->
                        </div>
                    </div>
                </div>
                
                <!-- Payments Tab -->
                <div id="tab-payments" class="tab-panel">
                    <div class="recent-section">
                        <h3><i class="fas fa-credit-card"></i> Payment History</h3>
                        <table class="invoice-table" style="margin-top: 15px;">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Invoice</th>
                                    <th>Customer</th>
                                    <th>Method</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody id="paymentHistory">
                                <!-- Rendered dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- New Invoice Modal -->
    <div class="modal-overlay" id="newInvoiceModal">
        <div class="modal large">
            <div class="modal-header">
                <h3><i class="fas fa-file-invoice"></i> Create New Invoice</h3>
                <button class="modal-close" onclick="closeModal('newInvoice')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Customer *</label>
                        <select id="invoiceCustomer" required>
                            <option value="">Select Customer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Invoice Date *</label>
                        <input type="date" id="invoiceDate" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Due Date *</label>
                        <input type="date" id="invoiceDueDate" required>
                    </div>
                    <div class="form-group">
                        <label>Invoice Number</label>
                        <input type="text" id="invoiceNumber" placeholder="Auto-generated">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Line Items</label>
                    <div class="line-items">
                        <div class="line-item-header">
                            <span>Description</span>
                            <span>Qty</span>
                            <span>Rate</span>
                            <span>Amount</span>
                            <span></span>
                        </div>
                        <div id="lineItemsContainer">
                            <!-- Line items added here -->
                        </div>
                        <button type="button" class="add-line-btn" onclick="addLineItem()">
                            <i class="fas fa-plus"></i> Add Line Item
                        </button>
                    </div>
                </div>
                
                <div class="form-row" style="justify-content: flex-end;">
                    <div style="width: 250px;">
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="invoiceSubtotal">$0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Tax (8%)</span>
                            <span id="invoiceTax">$0.00</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span id="invoiceTotal">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="invoiceNotes" rows="3" placeholder="Add any notes or payment instructions..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('newInvoice')">Cancel</button>
                <button class="btn btn-secondary" onclick="saveDraft()"><i class="fas fa-save"></i> Save Draft</button>
                <button class="btn btn-primary" onclick="createInvoice()"><i class="fas fa-paper-plane"></i> Create & Send</button>
            </div>
        </div>
    </div>
    
    <!-- Record Payment Modal -->
    <div class="modal-overlay" id="recordPaymentModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-credit-card"></i> Record Payment</h3>
                <button class="modal-close" onclick="closeModal('recordPayment')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Amount *</label>
                    <input type="number" id="paymentAmount" step="0.01" placeholder="0.00" required>
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <select id="paymentMethod">
                        <option value="card">Credit/Debit Card</option>
                        <option value="cash">Cash</option>
                        <option value="check">Check</option>
                        <option value="bank">Bank Transfer</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Payment Date</label>
                    <input type="date" id="paymentDate">
                </div>
                <div class="form-group">
                    <label>Reference/Notes</label>
                    <input type="text" id="paymentReference" placeholder="Check #, Transaction ID, etc.">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('recordPayment')">Cancel</button>
                <button class="btn btn-success" onclick="recordPayment()"><i class="fas fa-check"></i> Record Payment</button>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>
    
    <script>
        // Sample data
        let invoices = [
            {
                id: 'INV-001',
                customer: { name: 'John Smith', email: 'john@email.com', phone: '(555) 123-4567', address: '123 Main St, City, ST 12345' },
                date: '2025-12-01',
                dueDate: '2025-12-15',
                status: 'pending',
                items: [
                    { description: 'Monthly Membership - Premium', qty: 1, rate: 149.99 },
                    { description: 'Simulator Session (2 hrs)', qty: 3, rate: 45.00 }
                ],
                tax: 0.08,
                notes: 'Thank you for your business!'
            },
            {
                id: 'INV-002',
                customer: { name: 'Sarah Johnson', email: 'sarah@email.com', phone: '(555) 234-5678', address: '456 Oak Ave, Town, ST 23456' },
                date: '2025-11-28',
                dueDate: '2025-12-12',
                status: 'paid',
                paidDate: '2025-12-05',
                paymentMethod: 'card',
                items: [
                    { description: 'Golf Lesson - 1 Hour', qty: 4, rate: 75.00 },
                    { description: 'Equipment Rental', qty: 1, rate: 25.00 }
                ],
                tax: 0.08,
                notes: ''
            },
            {
                id: 'INV-003',
                customer: { name: 'Mike Wilson', email: 'mike@email.com', phone: '(555) 345-6789', address: '789 Pine Rd, Village, ST 34567' },
                date: '2025-11-15',
                dueDate: '2025-11-30',
                status: 'overdue',
                items: [
                    { description: 'Annual Membership', qty: 1, rate: 1499.99 }
                ],
                tax: 0.08,
                notes: 'Payment overdue - please remit immediately'
            },
            {
                id: 'INV-004',
                customer: { name: 'Emily Davis', email: 'emily@email.com', phone: '(555) 456-7890', address: '321 Elm St, City, ST 45678' },
                date: '2025-12-05',
                dueDate: '2025-12-20',
                status: 'draft',
                items: [
                    { description: 'Private Event - 4 Hours', qty: 1, rate: 500.00 },
                    { description: 'Catering Package', qty: 20, rate: 35.00 }
                ],
                tax: 0.08,
                notes: 'Draft - awaiting event confirmation'
            },
            {
                id: 'INV-005',
                customer: { name: 'Robert Brown', email: 'robert@email.com', phone: '(555) 567-8901', address: '654 Maple Dr, Town, ST 56789' },
                date: '2025-12-08',
                dueDate: '2025-12-22',
                status: 'pending',
                items: [
                    { description: 'Simulator Session (1 hr)', qty: 5, rate: 35.00 },
                    { description: 'Drink Package', qty: 5, rate: 15.00 }
                ],
                tax: 0.08,
                notes: ''
            }
        ];
        
        let customers = [
            { id: 1, name: 'John Smith', email: 'john@email.com' },
            { id: 2, name: 'Sarah Johnson', email: 'sarah@email.com' },
            { id: 3, name: 'Mike Wilson', email: 'mike@email.com' },
            { id: 4, name: 'Emily Davis', email: 'emily@email.com' },
            { id: 5, name: 'Robert Brown', email: 'robert@email.com' }
        ];
        
        let selectedInvoice = null;
        let lineItemCount = 0;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateTime();
            setInterval(updateTime, 1000);
            renderInvoiceList();
            updateStats();
            renderOverview();
            populateCustomerDropdown();
            setDefaultDates();
            addLineItem(); // Add first line item
        });
        
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }
        
        function calculateInvoiceTotal(invoice) {
            const subtotal = invoice.items.reduce((sum, item) => sum + (item.qty * item.rate), 0);
            const tax = subtotal * invoice.tax;
            return { subtotal, tax, total: subtotal + tax };
        }
        
        function renderInvoiceList() {
            const list = document.getElementById('invoiceList');
            const searchTerm = document.getElementById('invoiceSearch').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            
            let filtered = invoices.filter(inv => {
                const matchesSearch = inv.id.toLowerCase().includes(searchTerm) || 
                                     inv.customer.name.toLowerCase().includes(searchTerm);
                const matchesStatus = statusFilter === 'all' || inv.status === statusFilter;
                return matchesSearch && matchesStatus;
            });
            
            list.innerHTML = filtered.map(inv => {
                const totals = calculateInvoiceTotal(inv);
                return `
                    <div class="invoice-item ${selectedInvoice?.id === inv.id ? 'active' : ''}" onclick="selectInvoice('${inv.id}')">
                        <div class="invoice-header">
                            <span class="invoice-number">${inv.id}</span>
                            <span class="invoice-status ${inv.status}">${inv.status}</span>
                        </div>
                        <div class="invoice-customer">${inv.customer.name}</div>
                        <div class="invoice-meta">
                            <span>Due: ${formatDate(inv.dueDate)}</span>
                            <span class="invoice-amount">$${totals.total.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function filterInvoices() {
            renderInvoiceList();
            updateStats();
        }
        
        function updateStats() {
            let total = 0, paid = 0, outstanding = 0;
            
            invoices.forEach(inv => {
                const totals = calculateInvoiceTotal(inv);
                total += totals.total;
                if (inv.status === 'paid') {
                    paid += totals.total;
                } else if (inv.status !== 'draft') {
                    outstanding += totals.total;
                }
            });
            
            document.getElementById('statTotal').textContent = `$${total.toFixed(2)}`;
            document.getElementById('statPaid').textContent = `$${paid.toFixed(2)}`;
            document.getElementById('statOutstanding').textContent = `$${outstanding.toFixed(2)}`;
            
            // Update overview cards
            document.getElementById('totalRevenue').textContent = `$${paid.toFixed(2)}`;
            document.getElementById('outstandingAmount').textContent = `$${outstanding.toFixed(2)}`;
            document.getElementById('paidThisMonth').textContent = `$${paid.toFixed(2)}`;
            
            const overdue = invoices.filter(i => i.status === 'overdue').reduce((sum, inv) => sum + calculateInvoiceTotal(inv).total, 0);
            document.getElementById('overdueAmount').textContent = `$${overdue.toFixed(2)}`;
        }
        
        function renderOverview() {
            // Recent payments
            const paidInvoices = invoices.filter(i => i.status === 'paid').slice(0, 5);
            document.getElementById('recentPayments').innerHTML = paidInvoices.map(inv => {
                const totals = calculateInvoiceTotal(inv);
                return `
                    <div class="transaction-row">
                        <div class="transaction-icon income"><i class="fas fa-check"></i></div>
                        <div class="transaction-details">
                            <div class="name">${inv.customer.name}</div>
                            <div class="desc">${inv.id} • ${formatDate(inv.paidDate || inv.date)}</div>
                        </div>
                        <div class="transaction-amount positive">+$${totals.total.toFixed(2)}</div>
                    </div>
                `;
            }).join('') || '<p style="color:#999;text-align:center;padding:20px;">No recent payments</p>';
            
            // Upcoming due
            const pendingInvoices = invoices.filter(i => i.status === 'pending' || i.status === 'overdue').slice(0, 5);
            document.getElementById('upcomingDue').innerHTML = pendingInvoices.map(inv => {
                const totals = calculateInvoiceTotal(inv);
                const isOverdue = inv.status === 'overdue';
                return `
                    <div class="transaction-row">
                        <div class="transaction-icon expense"><i class="fas fa-${isOverdue ? 'exclamation' : 'clock'}"></i></div>
                        <div class="transaction-details">
                            <div class="name">${inv.customer.name}</div>
                            <div class="desc">${inv.id} • Due: ${formatDate(inv.dueDate)}</div>
                        </div>
                        <div class="transaction-amount negative">$${totals.total.toFixed(2)}</div>
                    </div>
                `;
            }).join('') || '<p style="color:#999;text-align:center;padding:20px;">No pending invoices</p>';
        }
        
        function selectInvoice(id) {
            selectedInvoice = invoices.find(i => i.id === id);
            renderInvoiceList();
            renderInvoiceDetail();
            switchTab('invoices', document.querySelectorAll('.tab-btn')[1]);
        }
        
        function renderInvoiceDetail() {
            if (!selectedInvoice) return;
            
            const inv = selectedInvoice;
            const totals = calculateInvoiceTotal(inv);
            
            document.getElementById('invoiceDetail').innerHTML = `
                <div class="invoice-detail">
                    <div class="invoice-detail-header">
                        <div class="invoice-brand">
                            <img src="images/golfCoveLogo6.png" alt="Golf Cove">
                            <div>
                                <h3>Golf Cove</h3>
                                <p style="color:#666;font-size:0.9rem;">Premium Indoor Golf Experience</p>
                            </div>
                        </div>
                        <div class="invoice-info">
                            <h2>${inv.id}</h2>
                            <p>Status: <span class="invoice-status ${inv.status}" style="display:inline-block;">${inv.status}</span></p>
                        </div>
                    </div>
                    
                    <div class="invoice-parties">
                        <div class="party-box">
                            <h4>Bill To</h4>
                            <p class="name">${inv.customer.name}</p>
                            <p>${inv.customer.email}</p>
                            <p>${inv.customer.phone}</p>
                            <p>${inv.customer.address}</p>
                        </div>
                        <div class="party-box" style="text-align:right;">
                            <h4>From</h4>
                            <p class="name">Golf Cove</p>
                            <p>info@golfcove.com</p>
                            <p>(555) 000-0000</p>
                            <p>123 Golf Way, Bismarck, ND</p>
                        </div>
                    </div>
                    
                    <div class="invoice-dates">
                        <div class="date-item">
                            <label>Invoice Date</label>
                            <span>${formatDate(inv.date)}</span>
                        </div>
                        <div class="date-item">
                            <label>Due Date</label>
                            <span>${formatDate(inv.dueDate)}</span>
                        </div>
                        ${inv.paidDate ? `
                        <div class="date-item">
                            <label>Paid Date</label>
                            <span>${formatDate(inv.paidDate)}</span>
                        </div>
                        ` : ''}
                    </div>
                    
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Rate</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${inv.items.map(item => `
                                <tr>
                                    <td><span class="item-desc">${item.description}</span></td>
                                    <td>${item.qty}</td>
                                    <td>$${item.rate.toFixed(2)}</td>
                                    <td>$${(item.qty * item.rate).toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="invoice-summary">
                        <div class="summary-box">
                            <div class="summary-row">
                                <span>Subtotal</span>
                                <span>$${totals.subtotal.toFixed(2)}</span>
                            </div>
                            <div class="summary-row">
                                <span>Tax (${(inv.tax * 100).toFixed(0)}%)</span>
                                <span>$${totals.tax.toFixed(2)}</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total</span>
                                <span class="amount">$${totals.total.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${inv.notes ? `
                    <div class="invoice-notes">
                        <h4>Notes</h4>
                        <p>${inv.notes}</p>
                    </div>
                    ` : ''}
                    
                    <div style="margin-top:30px; display:flex; gap:10px; justify-content:flex-end;">
                        ${inv.status !== 'paid' ? `
                        <button class="btn btn-success" onclick="showModal('recordPayment')"><i class="fas fa-credit-card"></i> Record Payment</button>
                        ` : ''}
                        <button class="btn btn-secondary" onclick="emailInvoice('${inv.id}')"><i class="fas fa-envelope"></i> Email</button>
                        <button class="btn btn-outline" onclick="window.print()"><i class="fas fa-print"></i> Print</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteInvoice('${inv.id}')"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `;
        }
        
        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }
        
        function showModal(type) {
            document.getElementById(type + 'Modal').classList.add('active');
        }
        
        function closeModal(type) {
            document.getElementById(type + 'Modal').classList.remove('active');
        }
        
        function populateCustomerDropdown() {
            const select = document.getElementById('invoiceCustomer');
            select.innerHTML = '<option value="">Select Customer</option>' + 
                customers.map(c => `<option value="${c.id}">${c.name} (${c.email})</option>`).join('');
        }
        
        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceDate').value = today;
            
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 14);
            document.getElementById('invoiceDueDate').value = dueDate.toISOString().split('T')[0];
            document.getElementById('paymentDate').value = today;
        }
        
        function addLineItem() {
            lineItemCount++;
            const container = document.getElementById('lineItemsContainer');
            const row = document.createElement('div');
            row.className = 'line-item-row';
            row.id = `lineItem${lineItemCount}`;
            row.innerHTML = `
                <input type="text" placeholder="Description" class="line-desc">
                <input type="number" value="1" min="1" class="line-qty" onchange="updateInvoiceTotals()">
                <input type="number" value="0" step="0.01" class="line-rate" onchange="updateInvoiceTotals()">
                <span class="line-amount">$0.00</span>
                <button type="button" class="remove-btn" onclick="removeLineItem(${lineItemCount})"><i class="fas fa-times"></i></button>
            `;
            container.appendChild(row);
        }
        
        function removeLineItem(id) {
            const row = document.getElementById(`lineItem${id}`);
            if (row) {
                row.remove();
                updateInvoiceTotals();
            }
        }
        
        function updateInvoiceTotals() {
            let subtotal = 0;
            document.querySelectorAll('.line-item-row').forEach(row => {
                const qty = parseFloat(row.querySelector('.line-qty').value) || 0;
                const rate = parseFloat(row.querySelector('.line-rate').value) || 0;
                const amount = qty * rate;
                row.querySelector('.line-amount').textContent = `$${amount.toFixed(2)}`;
                subtotal += amount;
            });
            
            const tax = subtotal * 0.08;
            const total = subtotal + tax;
            
            document.getElementById('invoiceSubtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('invoiceTax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('invoiceTotal').textContent = `$${total.toFixed(2)}`;
        }
        
        function createInvoice() {
            const customerId = document.getElementById('invoiceCustomer').value;
            if (!customerId) {
                showToast('Please select a customer', 'error');
                return;
            }
            
            const items = [];
            document.querySelectorAll('.line-item-row').forEach(row => {
                const desc = row.querySelector('.line-desc').value;
                const qty = parseFloat(row.querySelector('.line-qty').value) || 0;
                const rate = parseFloat(row.querySelector('.line-rate').value) || 0;
                if (desc && qty > 0 && rate > 0) {
                    items.push({ description: desc, qty, rate });
                }
            });
            
            if (items.length === 0) {
                showToast('Please add at least one line item', 'error');
                return;
            }
            
            const customer = customers.find(c => c.id == customerId);
            const newInvoice = {
                id: `INV-${String(invoices.length + 1).padStart(3, '0')}`,
                customer: { 
                    name: customer.name, 
                    email: customer.email,
                    phone: '(555) 000-0000',
                    address: 'Address on file'
                },
                date: document.getElementById('invoiceDate').value,
                dueDate: document.getElementById('invoiceDueDate').value,
                status: 'pending',
                items: items,
                tax: 0.08,
                notes: document.getElementById('invoiceNotes').value
            };
            
            invoices.unshift(newInvoice);
            renderInvoiceList();
            updateStats();
            renderOverview();
            closeModal('newInvoice');
            showToast('Invoice created successfully!', 'success');
            
            // Reset form
            document.getElementById('invoiceCustomer').value = '';
            document.getElementById('invoiceNotes').value = '';
            document.getElementById('lineItemsContainer').innerHTML = '';
            lineItemCount = 0;
            addLineItem();
            setDefaultDates();
        }
        
        function saveDraft() {
            showToast('Invoice saved as draft', 'success');
            closeModal('newInvoice');
        }
        
        function recordPayment() {
            if (!selectedInvoice) return;
            
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            selectedInvoice.status = 'paid';
            selectedInvoice.paidDate = document.getElementById('paymentDate').value;
            selectedInvoice.paymentMethod = document.getElementById('paymentMethod').value;
            
            renderInvoiceList();
            renderInvoiceDetail();
            updateStats();
            renderOverview();
            closeModal('recordPayment');
            showToast('Payment recorded successfully!', 'success');
        }
        
        function emailInvoice(id) {
            showToast(`Invoice ${id} sent via email`, 'success');
        }
        
        function deleteInvoice(id) {
            if (confirm('Are you sure you want to delete this invoice?')) {
                invoices = invoices.filter(i => i.id !== id);
                selectedInvoice = null;
                renderInvoiceList();
                updateStats();
                renderOverview();
                document.getElementById('invoiceDetail').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-invoice"></i>
                        <p>Select an invoice from the list to view details</p>
                    </div>
                `;
                showToast('Invoice deleted', 'success');
            }
        }
        
        function exportInvoices() {
            showToast('Exporting invoices...', 'success');
        }
        
        function showRecurringBilling() {
            switchTab('recurring', document.querySelectorAll('.tab-btn')[2]);
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
