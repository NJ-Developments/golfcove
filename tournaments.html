<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>League Standings - Golf Cove</title>
    <meta name="description" content="View live league standings, scores, and weekly results from Golf Cove leagues.">
    <link rel="icon" type="image/png" href="images/golfcovelogo.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        /* Hero Banner */
        .league-hero {
            background: linear-gradient(135deg, rgba(26,26,26,0.92) 0%, rgba(55,178,74,0.88) 100%), 
                        url('images/gallery-1.jpg') center/cover;
            padding: 100px 20px 70px;
            text-align: center;
            color: #fff;
            position: relative;
            overflow: hidden;
        }
        .league-hero::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to top, rgba(0,0,0,0.3), transparent);
        }
        .league-hero h1 {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 12px;
            text-shadow: 0 4px 12px rgba(0,0,0,0.5);
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
        }
        .league-hero .season-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .join-league-btn {
            display: inline-block;
            background: #fff;
            color: #37b24a;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 15px;
            font-weight: 600;
            text-decoration: none;
            margin-bottom: 15px;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .join-league-btn:hover {
            background: #37b24a;
            color: #fff;
            transform: translateY(-2px);
        }
        .join-league-btn i { margin-right: 8px; }
        .league-hero .stats-grid {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-top: 40px;
            position: relative;
            z-index: 1;
        }
        .league-hero .stat {
            text-align: center;
            position: relative;
        }
        .league-hero .stat::before {
            content: '';
            position: absolute;
            inset: -10px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            z-index: -1;
        }
        .league-hero .stat-num {
            font-size: 56px;
            font-weight: 900;
            line-height: 1;
            background: linear-gradient(135deg, #fff, #d4f4dd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .league-hero .stat-label {
            font-size: 13px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
            margin-top: 8px;
        }

        /* Live Banner */
        .live-banner {
            background: linear-gradient(90deg, #ff6b6b, #ee5a5a);
            color: #fff;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 900px;
            margin: -30px auto 30px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(238,90,90,0.4);
            position: relative;
            z-index: 10;
        }
        .live-banner .live-dot {
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            margin-right: 12px;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.9); }
        }
        .live-banner .info {
            display: flex;
            align-items: center;
            font-weight: 600;
            font-size: 16px;
        }
        .live-banner .count {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
        }

        /* Main Container */
        .league-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px 80px;
        }

        /* Standings Card */
        .standings-card {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 8px 40px rgba(0,0,0,0.12);
            overflow: hidden;
            margin-bottom: 40px;
            border: 1px solid rgba(55,178,74,0.1);
        }
        .standings-header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
            padding: 30px 35px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }
        .standings-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #37b24a, #2d9440, #37b24a);
        }
        .standings-header h2 {
            font-size: 24px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            letter-spacing: -0.3px;
        }
        .standings-header .trophy {
            font-size: 32px;
            filter: drop-shadow(0 2px 8px rgba(255,215,0,0.5));
        }

        /* Controls */
        .controls-panel {
            padding: 25px 30px;
            background: linear-gradient(to bottom, #f8fafb 0%, #f1f3f5 100%);
            border-bottom: 2px solid #e9ecef;
        }
        .controls-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            margin-bottom: 18px;
        }
        .controls-row:last-child { margin-bottom: 0; }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #fff;
            padding: 4px 16px 4px 4px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .filter-group label {
            font-size: 12px;
            font-weight: 700;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .filter-group label i {
            color: #37b24a;
        }
        .filter-select {
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            background: transparent;
            min-width: 160px;
            cursor: pointer;
            color: #333;
        }
        .filter-select:focus {
            outline: 2px solid #37b24a;
            outline-offset: 2px;
        }

        .view-toggle {
            display: flex;
            background: #fff;
            border-radius: 10px;
            padding: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .view-btn {
            padding: 11px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            color: #666;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .view-btn.active {
            background: linear-gradient(135deg, #37b24a 0%, #2d9440 100%);
            color: #fff;
            box-shadow: 0 4px 12px rgba(55,178,74,0.4);
            transform: translateY(-1px);
        }
        .view-btn:hover:not(.active) {
            background: #f0f0f0;
            color: #37b24a;
        }

        .export-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 11px 20px;
            background: linear-gradient(135deg, #217346 0%, #1a5c38 100%);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            margin-left: auto;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 3px 10px rgba(33,115,70,0.3);
        }
        .export-btn:hover {
            background: linear-gradient(135deg, #1a5c38 0%, #145229 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(33,115,70,0.4);
        }
        .export-btn i {
            font-size: 15px;
        }

        /* Table */
        .standings-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        .standings-table th {
            background: linear-gradient(to bottom, #f8fafb 0%, #f1f3f5 100%);
            padding: 18px 20px;
            text-align: left;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #555;
            border-bottom: 3px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .standings-table th.highlight {
            background: linear-gradient(135deg, #37b24a 0%, #2d9440 100%);
            color: #fff;
            box-shadow: 0 2px 8px rgba(55,178,74,0.2);
        }
        .standings-table td {
            padding: 20px;
            border-bottom: 1px solid #f5f5f5;
            font-size: 15px;
            font-weight: 500;
        }
        .standings-table tbody tr {
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .standings-table tbody tr:hover {
            background: linear-gradient(to right, #f8fff9, #ffffff);
            transform: scale(1.01);
            box-shadow: 0 2px 12px rgba(55,178,74,0.08);
        }
        .standings-table tbody tr:active {
            transform: scale(0.99);
        }

        /* Position Badges */
        .pos-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            font-weight: 800;
            font-size: 15px;
            position: relative;
            transition: transform 0.2s;
        }
        .standings-table tbody tr:hover .pos-badge {
            transform: scale(1.1) rotate(-5deg);
        }
        .pos-1 { 
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); 
            color: #fff; 
            box-shadow: 0 4px 15px rgba(255,215,0,0.5), inset 0 1px 0 rgba(255,255,255,0.3);
            border: 2px solid rgba(255,255,255,0.4);
        }
        .pos-2 { 
            background: linear-gradient(135deg, #E8E8E8 0%, #A8A8A8 100%); 
            color: #fff; 
            box-shadow: 0 4px 12px rgba(192,192,192,0.4), inset 0 1px 0 rgba(255,255,255,0.4);
            border: 2px solid rgba(255,255,255,0.3);
        }
        .pos-3 { 
            background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%); 
            color: #fff; 
            box-shadow: 0 4px 12px rgba(205,127,50,0.4), inset 0 1px 0 rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.2);
        }
        .pos-other { 
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%); 
            color: #666; 
            font-weight: 700;
            border: 2px solid #e0e0e0;
        }

        .player-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .player-name {
            font-weight: 700;
            color: #1a1a1a;
            font-size: 15px;
            letter-spacing: -0.2px;
        }
        .player-team {
            font-size: 12px;
            color: #37b24a;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .player-team::before {
            content: 'üë•';
            font-size: 10px;
        }
        .player-hcp {
            color: #999;
            font-size: 12px;
            font-weight: 500;
        }

        .score-cell {
            font-weight: 800;
            font-size: 20px;
            letter-spacing: -0.5px;
        }
        .score-cell.net { 
            color: #37b24a; 
            background: linear-gradient(135deg, #e8f5ea 0%, #f0f9f1 100%);
            padding: 6px 12px;
            border-radius: 8px;
            display: inline-block;
        }
        .score-cell.gross { 
            color: #1a1a1a;
            font-weight: 700;
        }
        
        /* Trend indicators */
        .trend-up { 
            color: #37b24a; 
            font-weight: 900; 
            font-size: 20px;
            filter: drop-shadow(0 2px 4px rgba(55,178,74,0.3));
        }
        .trend-down { 
            color: #e74c3c; 
            font-weight: 900; 
            font-size: 20px;
            filter: drop-shadow(0 2px 4px rgba(231,76,60,0.3));
        }
        .trend-flat { 
            color: #95a5a6; 
            font-weight: 700;
            font-size: 18px;
        }
        
        /* To-par styling */
        .to-par { 
            font-weight: 700; 
            font-size: 16px;
            padding: 4px 10px;
            border-radius: 6px;
            display: inline-block;
        }
        .to-par.over { 
            color: #e74c3c; 
            background: rgba(231,76,60,0.08);
        }
        .to-par.under { 
            color: #37b24a; 
            background: rgba(55,178,74,0.08);
        }
        .to-par.even { 
            color: #333; 
            background: rgba(0,0,0,0.05);
        }
        
        /* Stats summary in expanded row */
        .stats-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #e8f5ea 0%, #f0f9f1 100%);
            border-radius: 12px;
            margin-bottom: 15px;
            font-size: 14px;
            border-left: 4px solid #37b24a;
            box-shadow: 0 2px 8px rgba(55,178,74,0.1);
        }
        .stats-summary span { 
            color: #555; 
            font-weight: 500;
        }
        .stats-summary strong { 
            color: #37b24a; 
            font-weight: 700;
            font-size: 16px;
        }

        /* Expand Row */
        .expand-row {
            display: none;
            background: linear-gradient(to bottom, #fafbfc 0%, #f5f6f7 100%);
            border-top: 2px solid #e0e0e0;
        }
        .expand-row.open { 
            display: table-row;
            animation: expandRow 0.3s ease;
        }
        @keyframes expandRow {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .expand-row td {
            padding: 25px !important;
        }
        .round-breakdown {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        .round-chip {
            background: #fff;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            padding: 14px 18px;
            font-size: 13px;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
        }
        .round-chip:hover {
            border-color: #37b24a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(55,178,74,0.15);
        }
        .round-chip .week { 
            font-weight: 700; 
            color: #1a1a1a;
            font-size: 14px;
            margin-bottom: 6px;
        }
        .round-chip .scores { 
            color: #666; 
            font-size: 12px;
            font-weight: 500;
        }
        .round-chip .net-val { 
            color: #37b24a; 
            font-weight: 700;
            font-size: 13px;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 80px 30px;
        }
        .empty-state i {
            font-size: 64px;
            color: #ddd;
            margin-bottom: 20px;
        }
        .empty-state h2 {
            color: #333;
            margin-bottom: 10px;
        }
        .empty-state p {
            color: #888;
            margin-bottom: 30px;
        }

        /* Action Buttons */
        .action-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 40px;
        }
        .league-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 16px 32px;
            background: linear-gradient(135deg, #37b24a 0%, #2d9440 100%);
            color: #fff;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(55,178,74,0.3);
            position: relative;
            overflow: hidden;
        }
        .league-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .league-btn:hover::before {
            width: 300px;
            height: 300px;
        }
        .league-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(55,178,74,0.4);
        }
        .league-btn i {
            font-size: 18px;
            position: relative;
            z-index: 1;
        }
        .league-btn span {
            position: relative;
            z-index: 1;
        }
        .league-btn:hover {
            background: #2d9440;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(55,178,74,0.3);
        }
        .league-btn-outline {
            background: transparent;
            border: 2px solid #37b24a;
            color: #37b24a;
        }
        .league-btn-outline:hover {
            background: #37b24a;
            color: #fff;
        }

        /* Admin Link */
        .admin-footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }
        .admin-footer a {
            color: #999;
            text-decoration: none;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: color 0.2s;
        }
        .admin-footer a:hover { color: #37b24a; }

        /* Refresh indicator */
        .refresh-note {
            text-align: center;
            color: #999;
            font-size: 12px;
            margin-top: 20px;
        }
        .refresh-note i { margin-right: 5px; }

        /* No league setup - full page state */
        .setup-prompt {
            min-height: 60vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }
        .setup-card {
            text-align: center;
            background: #fff;
            padding: 60px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            max-width: 500px;
        }
        .setup-card .icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #37b24a, #2d9440);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
        }
        .setup-card .icon i {
            font-size: 40px;
            color: #fff;
        }
        .setup-card h2 {
            font-size: 28px;
            margin-bottom: 15px;
            color: #333;
        }
        .setup-card p {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .league-hero { padding: 60px 20px 50px; }
            .league-hero h1 { font-size: 32px; }
            .hero-subtitle { font-size: 16px; }
            .hero-dates { font-size: 13px; }
            .league-hero .stats-grid { gap: 30px; flex-wrap: wrap; }
            .league-hero .stat-num { font-size: 42px; }
            .controls-row { flex-direction: column; align-items: stretch; gap: 15px; }
            .filter-group { justify-content: space-between; }
            .view-toggle { justify-content: center; width: 100%; }
            .view-btn { flex: 1; }
            .export-btn { margin: 0; justify-content: center; width: 100%; }
            .standings-table th { padding: 14px 12px; font-size: 10px; }
            .standings-table td { padding: 16px 12px; font-size: 14px; }
            .pos-badge { width: 34px; height: 34px; font-size: 13px; }
            .player-name { font-size: 14px; }
            .score-cell { font-size: 18px; }
            .score-cell.net { padding: 5px 10px; }
            .standings-header { padding: 22px 20px; }
            .standings-header h2 { font-size: 20px; }
            .controls-panel { padding: 20px; }
            .round-chip { padding: 12px 15px; }
            .league-btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <a href="tel:2033905994"><i class="fas fa-phone"></i> 203.390.5994</a>
                <a href="https://maps.google.com/?q=336+State+Street,+North+Haven,+CT+06473" target="_blank"><i class="fas fa-map-marker-alt"></i> 336 STATE STREET, NORTH HAVEN, CT</a>
            </div>
            <div class="top-bar-right">
                <div class="social-links">
                    <a href="https://www.facebook.com/golfcove/" target="_blank"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.instagram.com/golfcovect/" target="_blank"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-main">
            <div class="logo">
                <a href="index.html">
                    <img src="images/golfCoveLogo6.png" alt="Golf Cove Logo" width="200" height="75">
                </a>
            </div>
            <nav class="main-nav" id="mainNav">
                <ul class="nav-menu">
                    <li><a href="pricing.html">Pricing</a></li>
                    <li><a href="memberships.html">Memberships</a></li>
                    <li class="dropdown">
                        <a href="lessons-leagues.html">Lessons & Leagues <i class="fas fa-chevron-down"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="lessons-leagues.html">Lessons & Leagues</a></li>
                            <li><a href="pinseeker.html">PinSeeker at Golf Cove</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="private-events.html">Private Events <i class="fas fa-chevron-down"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="private-events.html">Private Events</a></li>
                            <li><a href="concierge.html">The Cove Concierge</a></li>
                        </ul>
                    </li>
                    <li><a href="multisport.html">MultiSport Arcade</a></li>
                    <li><a href="gift-cards.html">Gift Cards</a></li>
                    <li><a href="tournaments.html" class="active">Tournaments</a></li>
                    <li><a href="menu.html">Menu</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="https://918booking.com/emb-bookings?course=7" class="btn-book" target="_blank">RESERVE A ROOM</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle Menu">
                <span></span><span></span><span></span>
            </button>
        </div>
    </header>

    <main id="app">
        <!-- Content loaded by JS -->
    </main>

    <!-- Footer -->
    <footer>
        <div class="footer-simple">
            <div class="footer-social-center">
                <a href="https://www.facebook.com/golfcove/" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.instagram.com/golfcovect/" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            </div>
            <p class="footer-social-text">Please visit our facebook and instagram pages frequently for events, updates and promotions!</p>
            <p class="footer-address"><a href="https://maps.google.com/?q=336+State+Street,+North+Haven,+CT+06473" target="_blank">336 State Street, North Haven, CT 06473</a> | Phone: <a href="tel:2033905994">203.390.5994</a></p>
            <p class="footer-copyright">¬© 2025 Golf Cove | <a href="contact.html">Contact Us</a> | <a href="sitemap.html">Site Map</a></p>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB8SH5Eh7OhIFLUkL2hjZS23uXkCsDJXGc",
            authDomain: "golfcove.firebaseapp.com",
            databaseURL: "https://golfcove-default-rtdb.firebaseio.com",
            projectId: "golfcove",
            storageBucket: "golfcove.firebasestorage.app",
            messagingSenderId: "284762891644",
            appId: "1:284762891644:web:424223b102f08a230f70f9"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const leagueRef = db.ref('league');
        
        let currentView = 'cumulative-net';
        let currentTeamFilter = '';
        let cachedLeague = null;
        let cachedStandings = null;

        // Default demo league shown when no league exists
        const defaultLeague = {
            name: 'Golf Cove League',
            season: 'Winter 2025',
            course: { name: 'Golf Cove', holes: 18, pars: Array(18).fill(4) },
            teams: [{ id: 't1', name: 'Demo Team' }],
            players: [
                { id: 'p1', name: 'Javi', teamId: 't1', handicap: 10 }
            ],
            rounds: [],
            scores: {}
        };

        function init() {
            const app = document.getElementById('app');
            app.innerHTML = '<div style="text-align:center;padding:60px;"><i class="fas fa-spinner fa-spin fa-2x" style="color:#37b24a;"></i><p style="margin-top:15px;color:#666;">Loading standings...</p></div>';
            
            // Timeout fallback - if Firebase doesn't respond in 5 seconds, show default
            const timeout = setTimeout(() => {
                console.log('Firebase timeout - using default league');
                renderLeague(defaultLeague);
            }, 5000);
            
            // Listen for real-time updates from Firebase
            leagueRef.on('value', (snapshot) => {
                clearTimeout(timeout);
                console.log('Firebase connected! Data:', snapshot.val());
                let league = snapshot.val();
                
                // Use default league if none exists
                if (!league) {
                    league = defaultLeague;
                } else {
                    // Ensure arrays exist (Firebase returns undefined for empty arrays)
                    league.players = league.players || [];
                    league.rounds = league.rounds || [];
                    league.teams = league.teams || [];
                    league.scores = league.scores || {};
                }
                
                renderLeague(league);
            }, (error) => {
                clearTimeout(timeout);
                console.error('Firebase error:', error);
                // Fallback to default league on error
                renderLeague(defaultLeague);
            });
        }
        
        function renderLeague(league) {
            const app = document.getElementById('app');
            
            cachedLeague = league;
            cachedStandings = calculateStandings(league);
            const hasPlayers = (league.players || []).length > 0;

            // Check for active round
            const activeRound = (league.rounds || []).find(r => !r.finalized);
            let roundInfoHTML = '';
            
            if (activeRound) {
                const startDate = new Date(activeRound.startDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const endDate = new Date(activeRound.endDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                roundInfoHTML = `
                    <div class="hero-subtitle">${activeRound.name}</div>
                    <div class="hero-dates">${startDate} - ${endDate}</div>
                    <a href="#schedule" class="view-schedule-btn" onclick="alert('Full schedule coming soon!'); return false;"><i class="fas fa-calendar"></i> View Full Schedule</a>
                `;
            }

            app.innerHTML = `
                <div class="league-hero">
                    <h1>üèÜ ${league.name}</h1>
                    <div class="season-badge"><i class="fas fa-calendar-alt"></i> ${league.season}</div>
                    ${roundInfoHTML}
                    <a href="score.html" class="join-league-btn"><i class="fas fa-user-plus"></i> Join League / Enter Score</a>
                    <div class="stats-grid">
                        <div class="stat">
                            <div class="stat-num">${league.teams?.length || 0}</div>
                            <div class="stat-label">Teams</div>
                        </div>
                        <div class="stat">
                            <div class="stat-num">${(league.players || []).length}</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat">
                            <div class="stat-num">${(league.rounds || []).length}</div>
                            <div class="stat-label">Rounds</div>
                        </div>
                    </div>
                </div>

                <div class="league-container">
                    <div class="standings-card">
                        <div class="standings-header">
                            <h2><span class="trophy">üèÜ</span> Leaderboard</h2>
                        </div>

                        ${hasPlayers ? `
                        <div class="controls-panel">
                            <div class="controls-row">
                                <div class="filter-group">
                                    <label><i class="fas fa-filter"></i> Team:</label>
                                    <select class="filter-select" id="teamFilter" onchange="filterByTeam(this.value)">
                                        <option value="">All Players</option>
                                        ${(league.teams || []).map(t => `<option value="${t.id}">${t.name}</option>`).join('')}
                                    </select>
                                </div>
                                <div class="view-toggle">
                                    <button class="view-btn active" data-view="cumulative-net">Net</button>
                                    <button class="view-btn" data-view="cumulative-gross">Gross</button>
                                    <button class="view-btn" data-view="by-round">By Week</button>
                                </div>
                                <button class="export-btn" onclick="exportToExcel()">
                                    <i class="fas fa-file-excel"></i> Export
                                </button>
                            </div>
                        </div>
                        ` : ''}

                        <div id="standingsContent">
                            ${hasPlayers ? renderTable(cachedStandings, league, 'cumulative-net') : `
                                <div class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <h2>No Players Yet</h2>
                                    <p>Be the first to join the league!</p>
                                </div>
                            `}
                        </div>
                    </div>

                    <div class="action-row">
                        <a href="score.html" class="league-btn"><i class="fas fa-pencil-alt"></i> Enter My Score</a>
                    </div>

                    <div class="admin-footer">
                        <a href="league-admin.html"><i class="fas fa-cog"></i> League Admin</a>
                    </div>

                    <div class="refresh-note">
                        <i class="fas fa-sync-alt"></i> Auto-refreshes every 30 seconds
                    </div>
                </div>
            `;

            // Attach view toggle handlers
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => setView(btn.dataset.view));
            });
        }

        function calculateStandings(league) {
            const holes = league.course?.holes || 18;
            const frontNine = Math.min(9, holes);
            const players = league.players || [];
            const rounds = league.rounds || [];
            const coursePar = (league.course?.pars || []).reduce((a, b) => a + b, 0) || (holes * 4);
            
            return players.map(player => {
                let totalGross = 0, totalOut = 0, totalIn = 0, roundsPlayed = 0;
                let roundDetails = [];
                let bestGross = null, worstGross = null, bestNet = null;
                let allGross = [], allNet = [];

                rounds.forEach(round => {
                    const ps = league.scores?.[round.id]?.[player.id];
                    if (ps && ps.submitted) {
                        let gross = 0, out = 0, inScore = 0;
                        let holesPlayed = 0;
                        
                        for (let h = 1; h <= frontNine; h++) {
                            const score = ps[h];
                            if (score && score > 0) {
                                out += score; gross += score; holesPlayed++;
                            }
                        }
                        for (let h = frontNine + 1; h <= holes; h++) {
                            const score = ps[h];
                            if (score && score > 0) {
                                inScore += score; gross += score; holesPlayed++;
                            }
                        }
                        
                        // Only count rounds where player actually played (at least 50% of holes)
                        if (holesPlayed >= Math.ceil(holes / 2)) {
                            const net = gross - (player.handicap || 0);
                            totalGross += gross; totalOut += out; totalIn += inScore; roundsPlayed++;
                            roundDetails.push({ name: round.name, date: round.date, out, in: inScore, gross, net, holesPlayed });
                            
                            allGross.push(gross);
                            allNet.push(net);
                            if (bestGross === null || gross < bestGross) bestGross = gross;
                            if (worstGross === null || gross > worstGross) worstGross = gross;
                            if (bestNet === null || net < bestNet) bestNet = net;
                        }
                    }
                });

                const totalNet = totalGross - ((player.handicap || 0) * roundsPlayed);
                const avgGross = roundsPlayed > 0 ? Math.round((totalGross / roundsPlayed) * 10) / 10 : null;
                const avgNet = roundsPlayed > 0 ? Math.round((totalNet / roundsPlayed) * 10) / 10 : null;
                const toPar = roundsPlayed > 0 ? totalGross - (coursePar * roundsPlayed) : null;
                
                // Calculate trend (last 3 rounds vs previous 3)
                let trend = null;
                if (allNet.length >= 2) {
                    const recent = allNet.slice(-Math.min(3, allNet.length));
                    const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;
                    if (allNet.length >= 4) {
                        const older = allNet.slice(-6, -3);
                        if (older.length > 0) {
                            const olderAvg = older.reduce((a, b) => a + b, 0) / older.length;
                            trend = olderAvg - recentAvg; // positive = improving
                        }
                    }
                }
                
                return {
                    id: player.id, name: player.name, teamId: player.teamId || null,
                    handicap: player.handicap || 0, totalOut, totalIn, totalGross, totalNet,
                    roundsPlayed, roundDetails, bestGross, worstGross, bestNet, avgGross, avgNet,
                    toPar, trend, coursePar
                };
            });
        }

        function filterByTeam(teamId) {
            currentTeamFilter = teamId;
            updateStandings();
        }

        function updateStandings() {
            let filtered = cachedStandings;
            if (currentTeamFilter) filtered = cachedStandings.filter(s => s.teamId === currentTeamFilter);
            document.getElementById('standingsContent').innerHTML = renderTable(filtered, cachedLeague, currentView);
        }

        function setView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.view === view));
            updateStandings();
        }

        function sortStandings(standings, view) {
            return [...standings].sort((a, b) => {
                if (a.roundsPlayed === 0) return 1;
                if (b.roundsPlayed === 0) return -1;
                return view === 'cumulative-gross' ? a.totalGross - b.totalGross : a.totalNet - b.totalNet;
            });
        }

        function renderTable(standings, league, view = 'cumulative-net') {
            const sorted = sortStandings(standings, view);
            const holes = league.course?.holes || 18;
            const has18 = holes >= 18;
            
            const getTeamName = (teamId) => (league.teams || []).find(t => t.id === teamId)?.name || '';

            let headers, renderRow;
            
            // Helper for trend arrow
            const getTrendIcon = (trend) => {
                if (trend === null) return '';
                if (trend > 1) return '<span class="trend-up" title="Improving">‚Üë</span>';
                if (trend < -1) return '<span class="trend-down" title="Declining">‚Üì</span>';
                return '<span class="trend-flat" title="Steady">‚Üí</span>';
            };
            
            const formatToPar = (toPar) => {
                if (toPar === null) return '-';
                if (toPar === 0) return 'E';
                return toPar > 0 ? `+${toPar}` : toPar;
            };

            if (view === 'cumulative-gross') {
                headers = `<th style="width:50px">#</th><th>Player</th><th>Rounds</th><th>Best</th><th>Avg</th><th class="highlight">Total</th>`;
                renderRow = (s, posDisplay, posNum) => `
                    <td><span class="pos-badge ${posNum && posNum <= 3 ? 'pos-' + posNum : 'pos-other'}">${posDisplay || '-'}</span></td>
                    <td><div class="player-info"><span class="player-name">${s.name}</span>${s.teamId ? `<span class="player-team">${getTeamName(s.teamId)}</span>` : ''}</div></td>
                    <td>${s.roundsPlayed}</td>
                    <td>${s.bestGross || '-'}</td>
                    <td>${s.avgGross || '-'}</td>
                    <td><span class="score-cell gross">${s.roundsPlayed > 0 ? s.totalGross : '-'}</span></td>
                `;
            } else if (view === 'by-round') {
                const roundHeaders = (league.rounds || []).map(r => `<th>${r.name.replace('Week ', 'W')}</th>`).join('');
                headers = `<th style="width:50px">#</th><th>Player</th>${roundHeaders}<th class="highlight">Net</th>`;
                renderRow = (s, posDisplay, posNum) => {
                    const cells = (league.rounds || []).map(r => {
                        const rd = s.roundDetails.find(d => d.name === r.name);
                        return `<td style="${rd ? '' : 'color:#ccc'}">${rd ? rd.net : '-'}</td>`;
                    }).join('');
                    return `
                        <td><span class="pos-badge ${posNum && posNum <= 3 ? 'pos-' + posNum : 'pos-other'}">${posDisplay || '-'}</span></td>
                        <td><div class="player-info"><span class="player-name">${s.name}</span>${s.teamId ? `<span class="player-team">${getTeamName(s.teamId)}</span>` : ''}</div></td>
                        ${cells}
                        <td><span class="score-cell net">${s.roundsPlayed > 0 ? s.totalNet : '-'}</span></td>
                    `;
                };
            } else {
                headers = `<th style="width:50px">#</th><th>Player</th><th>HCP</th><th>Rnds</th><th>Best</th><th>Avg</th><th>To Par</th><th class="highlight">Net</th><th></th>`;
                renderRow = (s, posDisplay, posNum) => `
                    <td><span class="pos-badge ${posNum && posNum <= 3 ? 'pos-' + posNum : 'pos-other'}">${posDisplay || '-'}</span></td>
                    <td><div class="player-info"><span class="player-name">${s.name}</span>${s.teamId ? `<span class="player-team">${getTeamName(s.teamId)}</span>` : ''}</div></td>
                    <td>${s.handicap}</td>
                    <td>${s.roundsPlayed}</td>
                    <td>${s.bestNet || '-'}</td>
                    <td>${s.avgNet || '-'}</td>
                    <td class="to-par ${s.toPar !== null ? (s.toPar > 0 ? 'over' : s.toPar < 0 ? 'under' : 'even') : ''}">${formatToPar(s.toPar)}</td>
                    <td><span class="score-cell net">${s.roundsPlayed > 0 ? s.totalNet : '-'}</span></td>
                    <td>${getTrendIcon(s.trend)}</td>
                `;
            }

            // Calculate positions with tie handling
            const getPosition = (sorted, index, view) => {
                if (sorted[index].roundsPlayed === 0) return null;
                
                const scoreKey = view === 'cumulative-gross' ? 'totalGross' : 'totalNet';
                const currentScore = sorted[index][scoreKey];
                
                // Find first player with this score
                for (let i = 0; i < index; i++) {
                    if (sorted[i].roundsPlayed > 0 && sorted[i][scoreKey] === currentScore) {
                        // Same position as earlier player with same score
                        return getPosition(sorted, i, view);
                    }
                }
                
                // Count how many players with scores are before this one
                let pos = 1;
                for (let i = 0; i < index; i++) {
                    if (sorted[i].roundsPlayed > 0) pos++;
                }
                return pos;
            };

            return `
                <table class="standings-table">
                    <thead><tr>${headers}</tr></thead>
                    <tbody>
                        ${sorted.map((s, i) => {
                            const pos = getPosition(sorted, i, view);
                            const isTied = pos !== null && sorted.filter((x, j) => j !== i && x.roundsPlayed > 0 && 
                                (view === 'cumulative-gross' ? x.totalGross : x.totalNet) === (view === 'cumulative-gross' ? s.totalGross : s.totalNet)
                            ).length > 0;
                            const posDisplay = pos ? (isTied ? `T${pos}` : pos) : null;
                            return `
                                <tr onclick="toggleDetails('${s.id}')">${renderRow(s, posDisplay, pos)}</tr>
                                <tr class="expand-row" id="details-${s.id}">
                                    <td colspan="10">
                                        <div class="round-breakdown">
                                            ${s.roundDetails.length > 0 ? `
                                                <div class="stats-summary">
                                                    <span><strong>Best:</strong> ${s.bestGross}</span>
                                                    <span><strong>Worst:</strong> ${s.worstGross}</span>
                                                    <span><strong>Avg:</strong> ${s.avgGross}</span>
                                                    ${s.trend !== null ? `<span><strong>Trend:</strong> ${s.trend > 0 ? '‚Üë Improving' : s.trend < 0 ? '‚Üì Declining' : '‚Üí Steady'}</span>` : ''}
                                                </div>
                                                ${s.roundDetails.map(r => `
                                                <div class="round-chip">
                                                    <div class="week">${r.name}</div>
                                                    <div class="scores">${has18 ? `OUT ${r.out} ‚Ä¢ IN ${r.in} ‚Ä¢ ` : ''}Gross ${r.gross} ‚Üí <span class="net-val">Net ${r.net}</span></div>
                                                </div>
                                            `).join('')}` : '<span style="color:#999">No rounds played yet</span>'}
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        function toggleDetails(playerId) {
            document.getElementById('details-' + playerId)?.classList.toggle('open');
        }

        function exportToExcel() {
            if (!cachedLeague || !cachedStandings) return;
            const league = cachedLeague;
            const standings = sortStandings(cachedStandings, currentView);
            const scoreKey = currentView === 'cumulative-gross' ? 'totalGross' : 'totalNet';
            
            // Calculate positions with ties for export
            const getExportPos = (index) => {
                if (standings[index].roundsPlayed === 0) return '-';
                const currentScore = standings[index][scoreKey];
                for (let i = 0; i < index; i++) {
                    if (standings[i].roundsPlayed > 0 && standings[i][scoreKey] === currentScore) {
                        return getExportPos(i);
                    }
                }
                let pos = 1;
                for (let i = 0; i < index; i++) {
                    if (standings[i].roundsPlayed > 0) pos++;
                }
                const isTied = standings.some((x, j) => j !== index && x.roundsPlayed > 0 && x[scoreKey] === currentScore);
                return isTied ? `T${pos}` : pos;
            };
            
            let csv = [`${league.name} - ${league.season}`, `Exported: ${new Date().toLocaleDateString()}`, ''];
            csv.push(['Pos', 'Player', 'Team', 'HCP', 'Rounds', 'Gross', 'Net'].join(','));
            
            standings.forEach((s, i) => {
                const teamName = (league.teams || []).find(t => t.id === s.teamId)?.name || '';
                csv.push([getExportPos(i), `"${s.name}"`, `"${teamName}"`, s.handicap, s.roundsPlayed, s.totalGross || '-', s.totalNet || '-'].join(','));
            });
            
            const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${league.name.replace(/\s+/g, '_')}_Standings.csv`;
            link.click();
        }

        init();
        setInterval(init, 30000);
    </script>
</body>
</html>

